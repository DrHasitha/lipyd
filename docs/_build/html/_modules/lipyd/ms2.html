

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>lipyd.ms2 &mdash; lipyd 0.7.19 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> lipyd
          

          
          </a>

          
            
            
              <div class="version">
                0.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../source/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/modules.html">Reference manual</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">lipyd</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>lipyd.ms2</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for lipyd.ms2</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1">#</span>
<span class="c1">#  This file is part of the `lipyd` python module</span>
<span class="c1">#</span>
<span class="c1">#  Copyright (c) 2015-2018 - EMBL</span>
<span class="c1">#</span>
<span class="c1">#  File author(s): Dénes Türei (turei.denes@gmail.com)</span>
<span class="c1">#</span>
<span class="c1">#  This code is not for public use.</span>
<span class="c1">#  Please do not redistribute.</span>
<span class="c1">#  For permission please contact me.</span>
<span class="c1">#</span>
<span class="c1">#  Website: http://www.ebi.ac.uk/~denes</span>
<span class="c1">#</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">future.utils</span> <span class="k">import</span> <span class="n">iteritems</span>
<span class="kn">from</span> <span class="nn">past.builtins</span> <span class="k">import</span> <span class="n">xrange</span><span class="p">,</span> <span class="nb">range</span><span class="p">,</span> <span class="n">reduce</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">imp</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="k">import</span> <span class="n">Namespace</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">lipyd.common</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">lipyd.mgf</span> <span class="k">as</span> <span class="nn">mgf</span>
<span class="kn">import</span> <span class="nn">lipyd.mz</span> <span class="k">as</span> <span class="nn">mzmod</span>
<span class="kn">import</span> <span class="nn">lipyd.session</span> <span class="k">as</span> <span class="nn">session</span>
<span class="kn">import</span> <span class="nn">lipyd.settings</span> <span class="k">as</span> <span class="nn">settings</span>
<span class="kn">import</span> <span class="nn">lipyd.lookup</span> <span class="k">as</span> <span class="nn">lookup</span>
<span class="kn">import</span> <span class="nn">lipyd.fragdb</span> <span class="k">as</span> <span class="nn">fragdb</span>
<span class="kn">import</span> <span class="nn">lipyd.moldb</span> <span class="k">as</span> <span class="nn">moldb</span>
<span class="kn">import</span> <span class="nn">lipyd.lipproc</span> <span class="k">as</span> <span class="nn">lipproc</span>


<span class="n">ChainFragment</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span>
    <span class="s1">&#39;ChainFragment&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="s1">&#39;fragtype&#39;</span><span class="p">,</span> <span class="s1">&#39;chaintype&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;intensity&#39;</span><span class="p">]</span>
<span class="p">)</span>


<div class="viewcode-block" id="MS2Identity"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Identity">[docs]</a><span class="k">class</span> <span class="nc">MS2Identity</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span>
        <span class="s1">&#39;MS2IdentityBase&#39;</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="s1">&#39;max_score&#39;</span><span class="p">,</span> <span class="s1">&#39;score_pct&#39;</span><span class="p">,</span>
            <span class="s1">&#39;hg&#39;</span><span class="p">,</span> <span class="s1">&#39;chainsum&#39;</span><span class="p">,</span> <span class="s1">&#39;chains&#39;</span><span class="p">,</span> <span class="s1">&#39;details&#39;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)):</span>
    
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">max_score</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">score_pct</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">hg</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">chainsum</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">chains</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">details</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">MS2Identity</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">score</span><span class="p">,</span>
            <span class="n">max_score</span><span class="p">,</span>
            <span class="n">score_pct</span><span class="p">,</span>
            <span class="n">hg</span><span class="p">,</span>
            <span class="n">chainsum</span> <span class="o">=</span> <span class="n">chainsum</span><span class="p">,</span>
            <span class="n">chains</span> <span class="o">=</span> <span class="n">chains</span><span class="p">,</span>
            <span class="n">details</span> <span class="o">=</span> <span class="n">details</span><span class="p">,</span>
        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">lipproc</span><span class="o">.</span><span class="n">full_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span> <span class="k">else</span>
            <span class="n">lipproc</span><span class="o">.</span><span class="n">summary_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chainsum</span><span class="p">)</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="MS2Identity.summary"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Identity.summary">[docs]</a>    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_pct</span></div>
    
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">MS2Identity</span><span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hg</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">hg</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chainsum</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">chainsum</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chains</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">chains</span>
        <span class="p">)</span></div>


<span class="n">ChainIdentificationDetails</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span>
    <span class="s1">&#39;ChainIdentificationDetails&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;fragtype&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">ChainIdentificationDetails</span><span class="o">.</span><span class="fm">__new__</span><span class="o">.</span><span class="vm">__defaults__</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>


<div class="viewcode-block" id="mz_sorted"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.mz_sorted">[docs]</a><span class="k">class</span> <span class="nc">mz_sorted</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">scan</span> <span class="o">=</span> <span class="n">scan</span>
    
    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">sort_mz</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extyp</span><span class="p">,</span> <span class="n">exval</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">sort_intensity</span><span class="p">()</span></div>


<div class="viewcode-block" id="intensity_sorted"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.intensity_sorted">[docs]</a><span class="k">class</span> <span class="nc">intensity_sorted</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">scan</span> <span class="o">=</span> <span class="n">scan</span>
    
    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">sort_intensity</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extyp</span><span class="p">,</span> <span class="n">exval</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">sort_mz</span><span class="p">()</span></div>


<div class="viewcode-block" id="ScanBase"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.ScanBase">[docs]</a><span class="k">class</span> <span class="nc">ScanBase</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">mzs</span><span class="p">,</span>
            <span class="n">ionmode</span><span class="p">,</span>
            <span class="n">precursor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">intensities</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">tolerance</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">scan_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span> <span class="o">=</span> <span class="n">tolerance</span> <span class="ow">or</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ms2_tolerance&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sorted_by</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mzs</span> <span class="o">=</span> <span class="n">mzs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ionmode</span> <span class="o">=</span> <span class="n">ionmode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adducts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">intensities</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span>
            <span class="n">intensities</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precursor</span> <span class="o">=</span> <span class="n">precursor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_id</span> <span class="o">=</span> <span class="n">scan_id</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mzs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">mzs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intensities</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">annotate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalize_intensities</span><span class="p">()</span>
        
        <span class="k">with</span> <span class="n">mz_sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">iisort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intensities</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">irank</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imzsort</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sorted_by</span> <span class="o">=</span> <span class="s1">&#39;intensities&#39;</span>
    
<div class="viewcode-block" id="ScanBase.reload"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.ScanBase.reload">[docs]</a>    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">modname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">fromlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">modname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">imp</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__class__&#39;</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span></div>
    
    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">)</span>
    
<div class="viewcode-block" id="ScanBase.sort_mz"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.ScanBase.sort_mz">[docs]</a>    <span class="k">def</span> <span class="nf">sort_mz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sorts the scan by m/z values ascending.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_by</span> <span class="o">==</span> <span class="s1">&#39;mzs&#39;</span><span class="p">:</span>
            
            <span class="k">return</span>
            
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;imzsort&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_by</span> <span class="o">==</span> <span class="s1">&#39;intensities&#39;</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imzsort</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            
            <span class="n">isort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">isort</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sorted_by</span> <span class="o">=</span> <span class="s1">&#39;mzs&#39;</span></div>
    
<div class="viewcode-block" id="ScanBase.sort_intensity"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.ScanBase.sort_intensity">[docs]</a>    <span class="k">def</span> <span class="nf">sort_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sorts the scan by intensities descending.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_by</span> <span class="o">==</span> <span class="s1">&#39;intensities&#39;</span><span class="p">:</span>
            
            <span class="k">return</span>
            
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;iisort&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_by</span> <span class="o">==</span> <span class="s1">&#39;mzs&#39;</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iisort</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            
            <span class="n">isort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intensities</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">isort</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sorted_by</span> <span class="o">=</span> <span class="s1">&#39;intensities&#39;</span></div>
    
<div class="viewcode-block" id="ScanBase.sort"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.ScanBase.sort">[docs]</a>    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isort</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies sorted indices to the scan.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span><span class="p">[</span><span class="n">isort</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mzs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">[</span><span class="n">isort</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;irank&#39;</span><span class="p">,</span> <span class="s1">&#39;annot&#39;</span><span class="p">,</span> <span class="s1">&#39;inorm&#39;</span><span class="p">):</span>
            
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
                
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)[</span><span class="n">isort</span><span class="p">])</span>
        
        <span class="k">for</span> <span class="n">ad</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adducts</span><span class="p">):</span>
            
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;annot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;annot&#39;</span><span class="p">][</span><span class="n">isort</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="ScanBase.annotate"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.ScanBase.annotate">[docs]</a>    <span class="k">def</span> <span class="nf">annotate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Annotates the fragments in the scan with identities provided by</span>
<span class="sd">        the fragment database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">annot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_annot</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="ScanBase.get_annot"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.ScanBase.get_annot">[docs]</a>    <span class="k">def</span> <span class="nf">get_annot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">precursor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tolerance</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns array of annotations.</span>
<span class="sd">        Makes it possible to use different precursor or tolerance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">precursor</span> <span class="o">=</span> <span class="n">precursor</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">precursor</span>
        <span class="n">tolerance</span> <span class="o">=</span> <span class="n">tolerance</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span>
        
        <span class="n">annotator</span> <span class="o">=</span> <span class="n">fragdb</span><span class="o">.</span><span class="n">FragmentAnnotator</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ionmode</span><span class="p">,</span>
            <span class="n">precursor</span><span class="p">,</span>
            <span class="n">tolerance</span> <span class="o">=</span> <span class="n">tolerance</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">annotator</span><span class="p">))</span> <span class="c1"># this is array</span></div>
                                         <span class="c1"># only to be sortable</span>
    
<div class="viewcode-block" id="ScanBase.normalize_intensities"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.ScanBase.normalize_intensities">[docs]</a>    <span class="k">def</span> <span class="nf">normalize_intensities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a vector of normalized intensities i.e. divides intensities</span>
<span class="sd">        by their maximum.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">imax</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inorm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">imax</span></div></div>


<div class="viewcode-block" id="Scan"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan">[docs]</a><span class="k">class</span> <span class="nc">Scan</span><span class="p">(</span><span class="n">ScanBase</span><span class="p">):</span>
    
    <span class="n">method_hg</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;fa_neg_1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;FA&#39;</span><span class="p">,</span> <span class="p">()),</span>
    <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">mzs</span><span class="p">,</span>
            <span class="n">ionmode</span><span class="p">,</span>
            <span class="n">precursor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">intensities</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ms1_records</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">scan_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">tolerance</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ms1_tolerance</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">rt</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        
        <span class="n">ScanBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">mzs</span><span class="p">,</span>
            <span class="n">ionmode</span><span class="p">,</span>
            <span class="n">precursor</span><span class="p">,</span>
            <span class="n">intensities</span><span class="p">,</span>
            <span class="n">tolerance</span> <span class="o">=</span> <span class="n">tolerance</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="c1"># get some settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ms1_tolerance</span> <span class="o">=</span> <span class="n">ms1_tolerance</span> <span class="ow">or</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ms1_tolerance&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_ratio_g</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;even_chain_fragment_intensity_ratios_gl_gpl&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_ratio_s</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;even_chain_fragment_intensity_ratios_sl&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iratio_logbase</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;chain_fragment_instensity_ratios_logbase&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chain_details</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ms2_scan_chain_details&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">ms1_records</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">precursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="c1"># do the database lookup if not provided,</span>
            <span class="c1"># this is not efficient but makes possible</span>
            <span class="c1"># to easily use standalone `Scan` instances</span>
            <span class="c1"># for testing and such</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ms1_records</span> <span class="o">=</span> <span class="n">moldb</span><span class="o">.</span><span class="n">adduct_lookup</span><span class="p">(</span>
                <span class="n">precursor</span><span class="p">,</span> <span class="n">ionmode</span><span class="p">,</span> <span class="n">tolerance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms1_tolerance</span>
            <span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            
            <span class="c1"># even if precursor is None, we end up with an empty list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ms1_records</span> <span class="o">=</span> <span class="n">ms1_records</span> <span class="ow">or</span> <span class="p">{}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_id</span> <span class="o">=</span> <span class="n">scan_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="n">sample</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rt</span> <span class="o">=</span> <span class="n">rt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
    
<div class="viewcode-block" id="Scan.from_mgf"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.from_mgf">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_mgf</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">fname</span><span class="p">,</span>
            <span class="n">scan_id</span><span class="p">,</span>
            <span class="n">ionmode</span><span class="p">,</span>
            <span class="n">precursor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">mgf_charge</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
        
        <span class="n">mgfreader</span> <span class="o">=</span> <span class="n">mgf</span><span class="o">.</span><span class="n">MgfReader</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">charge</span> <span class="o">=</span> <span class="n">mgf_charge</span><span class="p">)</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="n">mgfreader</span><span class="o">.</span><span class="n">scan_by_id</span><span class="p">(</span><span class="n">scan_id</span><span class="p">)</span>
        
        <span class="n">precursor</span> <span class="o">=</span> <span class="n">precursor</span> <span class="ow">or</span> <span class="n">mgfreader</span><span class="o">.</span><span class="n">precursor_by_id</span><span class="p">(</span><span class="n">scan_id</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">sc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
                <span class="n">mzs</span> <span class="o">=</span> <span class="n">sc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">intensities</span> <span class="o">=</span> <span class="n">sc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">ionmode</span> <span class="o">=</span> <span class="n">ionmode</span><span class="p">,</span>
                <span class="n">precursor</span> <span class="o">=</span> <span class="n">precursor</span><span class="p">,</span>
                <span class="n">scan_id</span> <span class="o">=</span> <span class="n">scan_id</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.reload"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.reload">[docs]</a>    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">modname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">fromlist</span><span class="o">=</span><span class="p">[</span><span class="n">modname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">imp</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__class__&#39;</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.print_scan"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.print_scan">[docs]</a>    <span class="k">def</span> <span class="nf">print_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints the list of fragments as an annotated table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_str</span><span class="p">())</span></div>
    
<div class="viewcode-block" id="Scan.show"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints the scan table to standard output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_str</span><span class="p">())</span></div>
    
<div class="viewcode-block" id="Scan.scan_str"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.scan_str">[docs]</a>    <span class="k">def</span> <span class="nf">scan_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the scan table as string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">lindent</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">12</span>
        
        <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>
                <span class="n">lindent</span><span class="p">,</span>
                <span class="s1">&#39;Frag. m/z&#39;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span>
                <span class="s1">&#39;Intensity&#39;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span>
                <span class="s1">&#39;Identity&#39;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">36</span><span class="p">),</span>
                <span class="s1">&#39;NL mass&#39;</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
            <span class="p">)),</span>
            <span class="n">lindent</span><span class="p">,</span>
            <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">*</span> <span class="mi">6</span>
        <span class="p">)</span>
        
        <span class="n">table</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>
            <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>
                <span class="n">lindent</span><span class="p">,</span>
                <span class="s1">&#39;</span><span class="si">%12.4f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;</span><span class="si">%10u</span><span class="s1">&#39;</span>   <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">ann</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">%12.4f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">(</span><span class="n">mz</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">precursor</span> <span class="k">else</span>
                    <span class="s1">&#39;NA&#39;</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mz</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ann</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">else</span>
                <span class="p">(</span><span class="n">Namespace</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">),)</span>
            <span class="p">)</span>
        <span class="p">))</span>
        
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="fm">__str__</span><span class="p">(),</span>
            <span class="n">header</span><span class="p">,</span>
            <span class="n">table</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.html_table"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.html_table">[docs]</a>    <span class="k">def</span> <span class="nf">html_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="c1"># TODO</span>
        <span class="k">pass</span></div>
    
<div class="viewcode-block" id="Scan.nl"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.nl">[docs]</a>    <span class="k">def</span> <span class="nf">nl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For m/z returns the corresponding neutral loss m/z.</span>
<span class="sd">        If precursor ion mass is unknown returns `numpy.nan`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">adduct</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">precursor</span> <span class="o">-</span> <span class="n">mz</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">precursor</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            
        <span class="k">else</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">adduct</span><span class="p">(</span><span class="n">adduct</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">adducts</span><span class="p">[</span><span class="n">adduct</span><span class="p">][</span><span class="s1">&#39;fake_precursor&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">mz</span></div>
    
<div class="viewcode-block" id="Scan.full_list_str"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.full_list_str">[docs]</a>    <span class="k">def</span> <span class="nf">full_list_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns list of fragments as single string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%u</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">ann</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span>
                    <span class="k">if</span> <span class="n">ann</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span>
                <span class="s1">&#39;Unknown (</span><span class="si">%.03f</span><span class="s1">) (</span><span class="si">%u</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ann</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">else</span>
                <span class="p">(</span><span class="kc">None</span><span class="p">,)</span>
            <span class="p">)</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.most_abundant_mz"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.most_abundant_mz">[docs]</a>    <span class="k">def</span> <span class="nf">most_abundant_mz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the m/z of the fragment with highest intensity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- Most abundant m/z is </span><span class="si">%.03f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="Scan.mz_match"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.mz_match">[docs]</a>    <span class="k">def</span> <span class="nf">mz_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz_detected</span><span class="p">,</span> <span class="n">mz</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests if two m/z&#39;s can be accepted to be equal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="n">lookup</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">mz_detected</span><span class="p">,</span> <span class="n">mz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.mz_lookup"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.mz_lookup">[docs]</a>    <span class="k">def</span> <span class="nf">mz_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the index of the closest m/z value</span>
<span class="sd">        detected in the scan if it is within the</span>
<span class="sd">        range of tolerance, otherwise None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_mz</span><span class="p">()</span>
        
        <span class="n">imz</span> <span class="o">=</span> <span class="n">lookup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">,</span> <span class="n">mz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imzsort</span><span class="p">[</span><span class="n">imz</span><span class="p">]</span> <span class="k">if</span> <span class="n">imz</span> <span class="k">else</span> <span class="kc">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_intensity</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">i</span></div>
    
<div class="viewcode-block" id="Scan.has_mz"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.has_mz">[docs]</a>    <span class="k">def</span> <span class="nf">has_mz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if an m/z exists in this scan.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_lookup</span><span class="p">(</span><span class="n">mz</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- m/z </span><span class="si">%.03f</span><span class="s1"> occures in this scan? -- </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">mz</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="Scan.has_nl"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.has_nl">[docs]</a>    <span class="k">def</span> <span class="nf">has_nl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nl</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if a neutral loss exists in this scan.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">(</span><span class="n">nl</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- neutral loss of </span><span class="si">%.03f</span><span class="s1"> occures in &#39;</span>
                <span class="s1">&#39;this scan? Looked up m/z </span><span class="si">%.03f</span><span class="s1"> - </span><span class="si">%.03f</span><span class="s1"> = </span><span class="si">%.03f</span><span class="s1"> -- </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">nl</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">precursor</span><span class="p">,</span>
                    <span class="n">nl</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">(</span><span class="n">nl</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="Scan.fragment_by_name"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.fragment_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">fragment_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the index of a fragment by its name.</span>
<span class="sd">        Returns `None` if the fragment does not exist in the scan.</span>
<span class="sd">        Returns `False` if the fragment name could not be found in</span>
<span class="sd">        the database.</span>
<span class="sd">        </span>
<span class="sd">        The lookup still goes by m/z, the name first looked up in the</span>
<span class="sd">        fragment database and the scan searched for the corresponding m/z.</span>
<span class="sd">        The name makes if obvious if this is a charged fragment or a neutral</span>
<span class="sd">        loss, hence it is not necessary to provide this information.</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">        :param str name:</span>
<span class="sd">            Fragment full name as used in the database 2nd column,</span>
<span class="sd">            e.g. `PE [P+E] (140.0118)`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">frag</span> <span class="o">=</span> <span class="n">fragdb</span><span class="o">.</span><span class="n">by_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ionmode</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">frag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">frag</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nl_lookup</span><span class="p">(</span><span class="n">frag</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">)</span>
                
            <span class="k">else</span><span class="p">:</span>
                
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_lookup</span><span class="p">(</span><span class="n">frag</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="k">return</span> <span class="kc">False</span></div>
    
<div class="viewcode-block" id="Scan.has_fragment"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.has_fragment">[docs]</a>    <span class="k">def</span> <span class="nf">has_fragment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if a fragment exists in this scan by its name.</span>
<span class="sd">        </span>
<span class="sd">        Returns bool or `None` if fragment name could not be found</span>
<span class="sd">        in the database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragment_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="kc">False</span> <span class="k">else</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>
    
<div class="viewcode-block" id="Scan.nl_lookup"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.nl_lookup">[docs]</a>    <span class="k">def</span> <span class="nf">nl_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nl</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Looks up if a neutral loss exists in this scan and returns its index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">(</span><span class="n">nl</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="Scan.most_abundant_fragment_is"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.most_abundant_fragment_is">[docs]</a>    <span class="k">def</span> <span class="nf">most_abundant_fragment_is</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if the fragment name is the highest abundant.</span>
<span class="sd">        Returns `None` if the fragment name could not be</span>
<span class="sd">        found in the database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">frag</span> <span class="o">=</span> <span class="n">fragdb</span><span class="o">.</span><span class="n">by_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ionmode</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">frag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="n">mz</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">(</span><span class="n">frag</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">frag</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span>
                <span class="n">frag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
            
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mz</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.fragment_among_most_abundant"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.fragment_among_most_abundant">[docs]</a>    <span class="k">def</span> <span class="nf">fragment_among_most_abundant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if the fragment is among the top `n`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">frag</span> <span class="o">=</span> <span class="n">fragdb</span><span class="o">.</span><span class="n">by_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ionmode</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">frag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="n">mz</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">(</span><span class="n">frag</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">frag</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span>
                <span class="n">frag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
            
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_among_most_abundant</span><span class="p">(</span><span class="n">mz</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.fragment_percent_of_most_abundant"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.fragment_percent_of_most_abundant">[docs]</a>    <span class="k">def</span> <span class="nf">fragment_percent_of_most_abundant</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">percent</span> <span class="o">=</span> <span class="mf">80.0</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if a fragment has at least certain percent of intensity</span>
<span class="sd">        compared to the highest peak.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">frag</span> <span class="o">=</span> <span class="n">fragdb</span><span class="o">.</span><span class="n">by_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ionmode</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">frag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="n">mz</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">(</span><span class="n">frag</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">frag</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span>
                <span class="n">frag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
            
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_percent_of_most_abundant</span><span class="p">(</span><span class="n">mz</span><span class="p">,</span> <span class="n">percent</span> <span class="o">=</span> <span class="n">percent</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.most_abundant_mz_is"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.most_abundant_mz_is">[docs]</a>    <span class="k">def</span> <span class="nf">most_abundant_mz_is</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if the m/z with the highest intensity is `mz`.</span>
<span class="sd">        Returns `None` if the fragment name could not be</span>
<span class="sd">        found in the database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">most_abundant_mz</span><span class="p">(),</span> <span class="n">mz</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- Is m/z </span><span class="si">%.03f</span><span class="s1"> the most abundant one? -- </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">mz</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="Scan.mz_among_most_abundant"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.mz_among_most_abundant">[docs]</a>    <span class="k">def</span> <span class="nf">mz_among_most_abundant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if an m/z is among the most aboundant `n` fragments</span>
<span class="sd">        in a spectrum.</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">        :param float mz:</span>
<span class="sd">            The m/z value.</span>
<span class="sd">        :param int n:</span>
<span class="sd">            The number of most abundant fragments considered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_mz</span><span class="p">()</span>
        
        <span class="n">i</span> <span class="o">=</span> <span class="n">lookup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">irank</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">],</span> <span class="c1"># intensity rank &lt; n</span>
            <span class="n">mz</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span>
        <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_intensity</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- m/z </span><span class="si">%.03f</span><span class="s1"> is among the </span><span class="si">%u</span><span class="s1"> most abundant? -- </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">mz</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>
    
<div class="viewcode-block" id="Scan.nl_among_most_abundant"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.nl_among_most_abundant">[docs]</a>    <span class="k">def</span> <span class="nf">nl_among_most_abundant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nl</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if a neutral loss corresponds to one of the</span>
<span class="sd">        most aboundant `n` fragments in a spectrum.</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">        :param float nl:</span>
<span class="sd">            The mass of the neutral loss.</span>
<span class="sd">        :param int n:</span>
<span class="sd">            The number of most abundant fragments considered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_among_most_abundant</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">(</span><span class="n">nl</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">),</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- neutral loss </span><span class="si">%.03f</span><span class="s1"> is among &#39;</span>
                <span class="s1">&#39;the </span><span class="si">%u</span><span class="s1"> most abundant? -- </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">nl</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="Scan.get_intensity"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.get_intensity">[docs]</a>    <span class="k">def</span> <span class="nf">get_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the relative intensity of a fragment ion from its m/z.</span>
<span class="sd">        Value is `None` if m/z does not present.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_lookup</span><span class="p">(</span><span class="n">mz</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inorm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="kc">None</span></div>
    
<div class="viewcode-block" id="Scan.get_nl_intensity"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.get_nl_intensity">[docs]</a>    <span class="k">def</span> <span class="nf">get_nl_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nl</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the relative intensity of a neutral loss fragment ion.</span>
<span class="sd">        Value is `None` if neutral loss does not present.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intensity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">(</span><span class="n">nl</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="Scan.mz_percent_of_most_abundant"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.mz_percent_of_most_abundant">[docs]</a>    <span class="k">def</span> <span class="nf">mz_percent_of_most_abundant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz</span><span class="p">,</span> <span class="n">percent</span> <span class="o">=</span> <span class="mf">80.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if an m/z has at least certain percent of intensity</span>
<span class="sd">        compared to the most intensive fragment.</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">        :param float mz:</span>
<span class="sd">            The m/z value.</span>
<span class="sd">        :param float percent:</span>
<span class="sd">            The threshold in percent of the highest intensity.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intensity</span><span class="p">(</span><span class="n">mz</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">percent</span> <span class="o">/</span> <span class="mf">100.</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- m/z </span><span class="si">%.03f</span><span class="s1"> has abundance at least </span><span class="si">%.01f</span><span class="s1"> </span><span class="si">%%</span><span class="s1"> of&#39;</span>
                <span class="s1">&#39; the highest abundance? -- </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">mz</span><span class="p">,</span> <span class="n">percent</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="Scan.match_chtype"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.match_chtype">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">match_chtype</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">accepted</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Matches strings or strings to set of strings, optionally negative.</span>
<span class="sd">        Calls `match_chattr` with `typ = basestring`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">match_chattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">accepted</span><span class="p">,</span> <span class="n">typ</span> <span class="o">=</span> <span class="n">basestring</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.match_chattr"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.match_chattr">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">match_chattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">accepted</span><span class="p">,</span> <span class="n">typ</span> <span class="o">=</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">        :param int value:</span>
<span class="sd">            The actual value.</span>
<span class="sd">        :param int,set accepted:</span>
<span class="sd">            A single value or a set of values to match against.</span>
<span class="sd">            Negative match is possible by providing a tuple with `False`</span>
<span class="sd">            as it&#39;s first element and the set of not acceptable values</span>
<span class="sd">            as the second element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">accepted</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>
            <span class="c1"># simple match</span>
            <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">accepted</span><span class="p">,</span> <span class="n">typ</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">==</span> <span class="n">accepted</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span>
                <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">accepted</span><span class="p">,</span> <span class="n">typ</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="c1"># multiple values</span>
                    <span class="n">value</span> <span class="ow">in</span> <span class="n">accepted</span> <span class="ow">or</span> <span class="p">(</span>
                        <span class="c1"># negation</span>
                        <span class="nb">hasattr</span><span class="p">(</span><span class="n">accepted</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">)</span> <span class="ow">and</span>
                        <span class="n">accepted</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span>
                        <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">accepted</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.match_annot"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.match_annot">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">match_annot</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">annot</span><span class="p">,</span>
            <span class="n">frag_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">chain_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">c</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">u</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests a fragment annotation against criteria of fragment type,</span>
<span class="sd">        chain type, carbon count and unsaturation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="nb">all</span><span class="p">((</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">match_chattr</span><span class="p">(</span><span class="n">annot</span><span class="o">.</span><span class="n">fragtype</span><span class="p">,</span> <span class="n">frag_type</span><span class="p">,</span> <span class="n">typ</span> <span class="o">=</span> <span class="n">basestring</span><span class="p">),</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">match_chattr</span><span class="p">(</span><span class="n">annot</span><span class="o">.</span><span class="n">chaintype</span><span class="p">,</span> <span class="n">chain_type</span><span class="p">,</span> <span class="n">typ</span> <span class="o">=</span> <span class="n">basestring</span><span class="p">),</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">match_chattr</span><span class="p">(</span><span class="n">annot</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">match_chattr</span><span class="p">(</span><span class="n">annot</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="n">u</span><span class="p">),</span>
        <span class="p">))</span></div>
    
<div class="viewcode-block" id="Scan.highest_fragment_by_chain_type"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.highest_fragment_by_chain_type">[docs]</a>    <span class="k">def</span> <span class="nf">highest_fragment_by_chain_type</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">head</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">frag_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">chain_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">c</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">u</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the highest instensity fragment matching a particular</span>
<span class="sd">        chain type.</span>
<span class="sd">        Returns fragment index or `None` if no such fragment exists.</span>
<span class="sd">        </span>
<span class="sd">        Arguments passed to `chain_fragment_type_is`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">frags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragments_by_chain_type</span><span class="p">(</span>
            <span class="n">head</span> <span class="o">=</span> <span class="n">head</span><span class="p">,</span>
            <span class="n">frag_type</span> <span class="o">=</span> <span class="n">frag_type</span><span class="p">,</span>
            <span class="n">chain_type</span> <span class="o">=</span> <span class="n">chain_type</span><span class="p">,</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            
            <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">frags</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            
            <span class="k">return</span> <span class="kc">None</span></div>
    
<div class="viewcode-block" id="Scan.fragments_by_chain_type"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.fragments_by_chain_type">[docs]</a>    <span class="k">def</span> <span class="nf">fragments_by_chain_type</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">head</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">frag_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">chain_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">c</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">u</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collects fragments matching a particular chain type.</span>
<span class="sd">        Yields indices.</span>
<span class="sd">        Arguments passed to `chain_fragment_type_is`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">head</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">)</span> <span class="k">if</span> <span class="n">head</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">min</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">head</span><span class="p">):</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_fragment_type_is</span><span class="p">(</span>
                <span class="n">i</span><span class="p">,</span>
                <span class="n">frag_type</span> <span class="o">=</span> <span class="n">frag_type</span><span class="p">,</span>
                <span class="n">chain_type</span> <span class="o">=</span> <span class="n">chain_type</span><span class="p">,</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="p">,</span>
                <span class="n">return_annot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">,</span>
            <span class="p">):</span>
                
                <span class="k">yield</span> <span class="n">i</span></div>
    
<div class="viewcode-block" id="Scan.chain_fragment_type_among_most_abundant"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.chain_fragment_type_among_most_abundant">[docs]</a>    <span class="k">def</span> <span class="nf">chain_fragment_type_among_most_abundant</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">frag_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">chain_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">c</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">u</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if a particular type of aliphatic chain fragment can be</span>
<span class="sd">        found among the `n` highest intensity fragments.</span>
<span class="sd">        </span>
<span class="sd">        Arguments passed to `chain_fragment_type_is`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fragments_by_chain_type</span><span class="p">(</span>
                <span class="n">head</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span>
                <span class="n">frag_type</span> <span class="o">=</span> <span class="n">frag_type</span><span class="p">,</span>
                <span class="n">chain_type</span> <span class="o">=</span> <span class="n">chain_type</span><span class="p">,</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="p">,</span>
                <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)))</span></div>
    
<div class="viewcode-block" id="Scan.chain_fragment_type_is"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.chain_fragment_type_is">[docs]</a>    <span class="k">def</span> <span class="nf">chain_fragment_type_is</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">i</span><span class="p">,</span>
            <span class="n">frag_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">chain_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">c</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">u</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">return_annot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if an aliphatic chain fragment is a specified type. The type</span>
<span class="sd">        should be the string representation of the fragment,</span>
<span class="sd">        e.g. `FA-O` for fatty acid minus oxygen fragments.</span>
<span class="sd">        </span>
<span class="sd">        Returns bool or fragment annotations if `return_annot = True`.</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">        :param int i:</span>
<span class="sd">            Index of the fragment.</span>
<span class="sd">        :param bool return_annot:</span>
<span class="sd">            Return iterator with the matching fragment annotations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">):</span>
            
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="n">annot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annot</span> <span class="k">if</span> <span class="n">adduct</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">adduct_annot</span><span class="p">(</span><span class="n">adduct</span><span class="p">)</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="nb">any</span><span class="p">((</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">match_annot</span><span class="p">(</span><span class="n">an</span><span class="p">,</span> <span class="n">frag_type</span><span class="p">,</span> <span class="n">chain_type</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">an</span> <span class="ow">in</span> <span class="n">annot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="p">))</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            
            <span class="n">criteria</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">frag_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">criteria</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;of type `</span><span class="si">%s</span><span class="s1">`&#39;</span> <span class="o">%</span> <span class="n">frag_type</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">chain_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">criteria</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;of chain type `</span><span class="si">%s</span><span class="s1">`&#39;</span> <span class="o">%</span> <span class="n">chain_type</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">criteria</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;with carbon count of %a&#39;</span> <span class="o">%</span> <span class="n">c</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">criteria</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;with unsaturation of %a&#39;</span> <span class="o">%</span> <span class="n">u</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- Fragment #</span><span class="si">%u</span><span class="s1"> (</span><span class="si">%.03f</span><span class="s1">): &#39;</span>
                <span class="s1">&#39;is it a fragment </span><span class="si">%s</span><span class="s1">? -- </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">i</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mz</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39; and &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">criteria</span><span class="p">),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">return_annot</span><span class="p">:</span>
            
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">an</span>
                <span class="k">for</span> <span class="n">an</span> <span class="ow">in</span> <span class="n">annot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_annot</span><span class="p">(</span><span class="n">an</span><span class="p">,</span> <span class="n">frag_type</span><span class="p">,</span> <span class="n">chain_type</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="Scan.chains_of_type"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.chains_of_type">[docs]</a>    <span class="k">def</span> <span class="nf">chains_of_type</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">chain_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">frag_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">c</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">u</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">yield_annot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates chain fragments matching certain criteria.</span>
<span class="sd">        Yields fragment indices or indices with annotations.</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">        :param bool yield_annot:</span>
<span class="sd">            Yield tuples of indices and annotations instead of indices only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">)):</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_fragment_type_is</span><span class="p">(</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="p">,</span>
                <span class="n">chain_type</span> <span class="o">=</span> <span class="n">chain_type</span><span class="p">,</span>
                <span class="n">frag_type</span> <span class="o">=</span> <span class="n">frag_type</span><span class="p">,</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="p">,</span>
                <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">,</span>
            <span class="p">):</span>
                
                <span class="k">if</span> <span class="n">yield_annot</span><span class="p">:</span>
                    
                    <span class="k">for</span> <span class="n">annot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_fragment_type_is</span><span class="p">(</span>
                        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="p">,</span>
                        <span class="n">chain_type</span> <span class="o">=</span> <span class="n">chain_type</span><span class="p">,</span>
                        <span class="n">frag_type</span> <span class="o">=</span> <span class="n">frag_type</span><span class="p">,</span>
                        <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span>
                        <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="p">,</span>
                        <span class="n">return_annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">,</span>
                    <span class="p">):</span>
                        
                        <span class="k">yield</span> <span class="n">i</span><span class="p">,</span> <span class="n">annot</span>
                    
                <span class="k">else</span><span class="p">:</span>
                    
                    <span class="k">yield</span> <span class="n">i</span></div>
    
<div class="viewcode-block" id="Scan.has_chain_fragment_type"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.has_chain_fragment_type">[docs]</a>    <span class="k">def</span> <span class="nf">has_chain_fragment_type</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">chain_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">frag_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">c</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">u</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if at least one fragment matches certain criteria.</span>
<span class="sd">        Arguments passed to `chain_fragment_type_is`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">highest_fragment_by_chain_type</span><span class="p">(</span>
            <span class="n">chain_type</span> <span class="o">=</span> <span class="n">chain_type</span><span class="p">,</span>
            <span class="n">frag_type</span> <span class="o">=</span> <span class="n">frag_type</span><span class="p">,</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">,</span>
        <span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>
    
<div class="viewcode-block" id="Scan.matching_chain_combinations"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.matching_chain_combinations">[docs]</a>    <span class="k">def</span> <span class="nf">matching_chain_combinations</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">head</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">intensity_threshold</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">expected_intensities</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">no_intensity_check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">chain_param</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides a way to see if specific chain combinations exist.</span>
<span class="sd">        The database record defines the chain layout of the molecule.</span>
<span class="sd">        Further arguments are passed to `chain_combinations`.</span>
<span class="sd">        The `chain_param` tuple contains dicts to match against chain</span>
<span class="sd">        fragments. All of these dicts must match at least one fragment</span>
<span class="sd">        identification. Only combinations matching all criteria yielded.</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">        :param lipproc.LipidRecord record:</span>
<span class="sd">            A lipid database record matching the MS1 m/z.</span>
<span class="sd">        :param int head:</span>
<span class="sd">            Consider only the n most intensive fragments.</span>
<span class="sd">        :param float intensity_threshold:</span>
<span class="sd">            Consider only fragments with intensity higher than threshold.</span>
<span class="sd">            Relative to highest fragment, between 0 and 1.</span>
<span class="sd">        :param expected_intensities:</span>
<span class="sd">            See at `intensity_ratios`.</span>
<span class="sd">        :param bool no_intensity_check:</span>
<span class="sd">            Completely skip checking intensity ratios.</span>
<span class="sd">        :param tuple chain_param:</span>
<span class="sd">            Tuple of dicts. Each dict contains criteria for one chain moiety.</span>
<span class="sd">            Keys can be `chain_type`, `frag_type`, `c` and `u`.</span>
<span class="sd">            These can be single str or int values or sets of multiple</span>
<span class="sd">            values. If omitted or `None` any value will pass the filter.</span>
<span class="sd">            An empty tuple which is the default value will pass through</span>
<span class="sd">            everything, this is equivalent with calling `chain_combinations`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">param</span> <span class="ow">or</span>
                <span class="n">param</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">in</span> <span class="p">{</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">}</span> <span class="ow">and</span>
                    <span class="n">value</span> <span class="o">==</span> <span class="n">param</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">in</span> <span class="p">{</span><span class="nb">set</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">}</span> <span class="ow">and</span>
                    <span class="n">value</span> <span class="ow">in</span> <span class="n">param</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">record</span><span class="o">.</span><span class="n">chainsum</span> <span class="ow">and</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">chainsum</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">chain_param</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="p">):</span>
            
            <span class="n">chain_param</span> <span class="o">=</span> <span class="n">chain_param</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">chainsum</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">chains</span><span class="p">,</span> <span class="n">details</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_combinations</span><span class="p">(</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">head</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">intensity_threshold</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">expected_intensities</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">no_intensity_check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">frag_types</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">fragment_details</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">,</span>
        <span class="p">):</span>
            
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">chain_param</span> <span class="ow">or</span>
                <span class="nb">all</span><span class="p">((</span>
                    <span class="ow">not</span> <span class="n">param</span> <span class="ow">or</span>
                    <span class="nb">any</span><span class="p">((</span>
                        <span class="nb">all</span><span class="p">((</span>
                            <span class="n">match</span><span class="p">(</span><span class="s1">&#39;chain_type&#39;</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">ch</span><span class="o">.</span><span class="n">typ</span><span class="p">),</span>
                            <span class="n">match</span><span class="p">(</span><span class="s1">&#39;frag_type&#39;</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">details</span><span class="o">.</span><span class="n">fragtype</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                            <span class="n">match</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">ch</span><span class="o">.</span><span class="n">c</span><span class="p">),</span>
                            <span class="n">match</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">ch</span><span class="o">.</span><span class="n">u</span><span class="p">),</span>
                        <span class="p">))</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chains</span><span class="p">)</span>
                    <span class="p">))</span>
                    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">chain_param</span>
                <span class="p">))</span>
            <span class="p">):</span>
                
                <span class="k">yield</span> <span class="n">chains</span><span class="p">,</span> <span class="n">details</span></div>
    
<div class="viewcode-block" id="Scan.has_chain_combination"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.has_chain_combination">[docs]</a>    <span class="k">def</span> <span class="nf">has_chain_combination</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">head</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">intensity_threshold</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">expected_intensities</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">no_intensity_check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">chain_param</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if a certain chain combination exists in the scan.</span>
<span class="sd">        </span>
<span class="sd">        Arguments passed to `matching_chain_combinations`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">ccomb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matching_chain_combinations</span><span class="p">(</span>
            <span class="n">record</span> <span class="o">=</span> <span class="n">record</span><span class="p">,</span>
            <span class="n">head</span> <span class="o">=</span> <span class="n">head</span><span class="p">,</span>
            <span class="n">intensity_threshold</span> <span class="o">=</span> <span class="n">intensity_threshold</span><span class="p">,</span>
            <span class="n">expected_intensities</span> <span class="o">=</span> <span class="n">expected_intensities</span><span class="p">,</span>
            <span class="n">no_intensity_check</span> <span class="o">=</span> <span class="n">no_intensity_check</span><span class="p">,</span>
            <span class="n">chain_param</span> <span class="o">=</span> <span class="n">chain_param</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            
            <span class="n">_</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">ccomb</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="kc">True</span>
            
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            
            <span class="k">return</span> <span class="kc">False</span></div>
    
    <span class="k">def</span> <span class="nf">_matching_chain_pairs</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">chain_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">frag_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">c</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">u</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">partner_chain_types</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">partner_frag_types</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">count_only</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        
        <span class="c1"># small caching of constraint matching</span>
        <span class="n">type_pos</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">def</span> <span class="nf">get_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frag_type</span><span class="p">):</span>
            
            <span class="k">if</span> <span class="n">frag_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">type_pos</span><span class="p">:</span>
                
                <span class="n">type_pos</span><span class="p">[</span><span class="n">frag_type</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions_for_frag_type</span><span class="p">(</span>
                    <span class="n">record</span><span class="p">,</span> <span class="n">frag_type</span>
                <span class="p">)</span>
            
            <span class="k">return</span> <span class="n">type_pos</span><span class="p">[</span><span class="n">frag_type</span><span class="p">]</span>
        <span class="c1"># ##</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">iannot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains_of_type</span><span class="p">(</span>
            <span class="n">chain_type</span> <span class="o">=</span> <span class="n">chain_type</span><span class="p">,</span>
            <span class="n">frag_type</span> <span class="o">=</span> <span class="n">frag_type</span><span class="p">,</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="p">,</span>
            <span class="n">yield_annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">,</span>
        <span class="p">):</span>
            
            <span class="n">partner_c</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">chainsum</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">annot</span><span class="o">.</span><span class="n">c</span>
            <span class="n">partner_u</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">chainsum</span><span class="o">.</span><span class="n">u</span> <span class="o">-</span> <span class="n">annot</span><span class="o">.</span><span class="n">u</span>
            
            <span class="k">if</span> <span class="n">partner_c</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">partner_u</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                
                <span class="k">continue</span>
            
            <span class="n">pos_i</span> <span class="o">=</span> <span class="n">get_positions</span><span class="p">(</span><span class="n">iannot</span><span class="o">.</span><span class="n">fragtype</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">jannot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains_of_type</span><span class="p">(</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">partner_c</span><span class="p">,</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">partner_u</span><span class="p">,</span>
                <span class="n">yield_annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">,</span>
            <span class="p">):</span>
                
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">partner_chain_types</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>
                    <span class="n">jannot</span><span class="o">.</span><span class="n">chaintype</span> <span class="ow">in</span> <span class="n">partner_chain_types</span>
                <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">partner_frag_types</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>
                    <span class="n">jannot</span><span class="o">.</span><span class="n">fragtype</span> <span class="ow">in</span> <span class="n">partner_frag_types</span>
                <span class="p">):</span>
                    
                    <span class="n">pos_j</span> <span class="o">=</span> <span class="n">get_positions</span><span class="p">(</span><span class="n">jannot</span><span class="o">.</span><span class="n">fragtype</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="ow">not</span> <span class="n">pos_i</span> <span class="ow">or</span>
                        <span class="ow">not</span> <span class="n">pos_j</span> <span class="ow">or</span> <span class="p">(</span>
                            <span class="nb">len</span><span class="p">(</span><span class="n">pos_i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>
                            <span class="nb">len</span><span class="p">(</span><span class="n">pos_j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>
                            <span class="ow">not</span> <span class="n">pos_i</span> <span class="o">-</span> <span class="n">pos_j</span>
                        <span class="p">)</span>
                    <span class="p">):</span>
                        
                        <span class="k">continue</span>
                    
                    <span class="k">yield</span> <span class="p">(</span>
                        <span class="n">lipproc</span><span class="o">.</span><span class="n">Chain</span><span class="p">(</span>
                            
                        <span class="p">)</span>
                    <span class="p">)</span>
    
<div class="viewcode-block" id="Scan.positions_for_frag_type"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.positions_for_frag_type">[docs]</a>    <span class="k">def</span> <span class="nf">positions_for_frag_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">frag_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the possible chain positions for a record and a fragment type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># constraints for the fragment type</span>
        <span class="n">constr</span> <span class="o">=</span> <span class="n">fragdb</span><span class="o">.</span><span class="n">constraints</span><span class="p">(</span><span class="n">frag_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ionmode</span><span class="p">)</span>
        <span class="c1"># set of possible positions of the chain</span>
        <span class="c1"># which this fragment originates from</span>
        <span class="k">return</span> <span class="n">lipproc</span><span class="o">.</span><span class="n">match_constraints</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">constr</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="Scan.is_chain"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.is_chain">[docs]</a>    <span class="k">def</span> <span class="nf">is_chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a fragment has an aliphatic chain.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">annot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adduct_annot</span><span class="p">(</span><span class="n">adduct</span><span class="p">)</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">an</span><span class="o">.</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">an</span> <span class="ow">in</span> <span class="n">annot</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1"> -- Fragment #</span><span class="si">%u</span><span class="s1"> (</span><span class="si">%.03f</span><span class="s1">)&#39;</span>
                <span class="s1">&#39;has an aliphatic chain? -- </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">i</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="Scan.is_chain_type"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.is_chain_type">[docs]</a>    <span class="k">def</span> <span class="nf">is_chain_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;FA&#39;</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if a fragment might origin from a certain aliphatic</span>
<span class="sd">        chain type (e.g. `FA` -- fatty acyl, `FAL` -- fatty alkyl,</span>
<span class="sd">        `Sph` -- sphingosin base).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_fragment_type_is</span><span class="p">(</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">chain_type</span> <span class="o">=</span> <span class="n">typ</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.is_fa"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.is_fa">[docs]</a>    <span class="k">def</span> <span class="nf">is_fa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if a fragment origins from a fatty acyl moiety.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_chain_type</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.is_fal"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.is_fal">[docs]</a>    <span class="k">def</span> <span class="nf">is_fal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if a fragment origins from a fatty alkyl moiety.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_chain_type</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;FAL&#39;</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.is_sph"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.is_sph">[docs]</a>    <span class="k">def</span> <span class="nf">is_sph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if a fragment origins from a shpingosin backbone.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_chain_type</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;Sph&#39;</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.is_type"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.is_type">[docs]</a>    <span class="k">def</span> <span class="nf">is_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if a fragment is a certain type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_fragment_type_is</span><span class="p">(</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">frag_type</span> <span class="o">=</span> <span class="n">typ</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.annot_by_type"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.annot_by_type">[docs]</a>    <span class="k">def</span> <span class="nf">annot_by_type</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">i</span><span class="p">,</span>
            <span class="n">chain_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">frag_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the annotations matching certain types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">annot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adduct_annot</span><span class="p">(</span><span class="n">adduct</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="n">an</span>
            <span class="k">for</span> <span class="n">an</span> <span class="ow">in</span> <span class="n">annot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">match_chtype</span><span class="p">(</span><span class="n">an</span><span class="o">.</span><span class="n">chaintype</span><span class="p">,</span> <span class="n">chain_type</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">match_chtype</span><span class="p">(</span><span class="n">an</span><span class="o">.</span><span class="n">fragtype</span><span class="p">,</span>  <span class="n">frag_type</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.cu_by_type"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.cu_by_type">[docs]</a>    <span class="k">def</span> <span class="nf">cu_by_type</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">i</span><span class="p">,</span>
            <span class="n">chain_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">frag_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns `(carbon count, unsaturation)` tuples for fragment `i`</span>
<span class="sd">        considering only the the requested chain types and fragment types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">u</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">annot_by_type</span><span class="p">(</span>
                <span class="n">i</span><span class="p">,</span>
                <span class="n">chain_type</span> <span class="o">=</span> <span class="n">chain_type</span><span class="p">,</span>
                <span class="n">frag_type</span> <span class="o">=</span> <span class="n">frag_type</span><span class="p">,</span>
                <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>
    
    <span class="k">def</span> <span class="nf">_build_chain_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annot</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds a list of chains which facilitates the anlysis of chain</span>
<span class="sd">        combinations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">annot</span> <span class="o">=</span> <span class="n">annot</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">annot</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">annot</span>
        
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="n">ChainFragment</span><span class="p">(</span>
                <span class="n">a</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">fragtype</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">chaintype</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">aa</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">annot</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">aa</span>
            <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">c</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="Scan.build_chain_list"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.build_chain_list">[docs]</a>    <span class="k">def</span> <span class="nf">build_chain_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rebuild</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">rebuild</span> <span class="ow">and</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;chain_list&#39;</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">chain_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_chain_list</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="Scan.chain_among_most_abundant"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.chain_among_most_abundant">[docs]</a>    <span class="k">def</span> <span class="nf">chain_among_most_abundant</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">head</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">chain_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">frag_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">c</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">u</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">min_mass</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">skip_non_chains</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns `True` if the defined type of chain fragment can be found</span>
<span class="sd">        among the most abundant fragments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1"> -- Checking for certain type of chain among the top &#39;</span>
                <span class="s1">&#39;</span><span class="si">%u</span><span class="s1"> fragments.&#39;</span> <span class="o">%</span> <span class="n">head</span>
            <span class="p">)</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="nb">any</span><span class="p">((</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chain_fragment_type_is</span><span class="p">(</span>
                <span class="n">i</span><span class="p">,</span>
                <span class="n">frag_type</span> <span class="o">=</span> <span class="n">frag_type</span><span class="p">,</span>
                <span class="n">chain_type</span> <span class="o">=</span> <span class="n">chain_type</span><span class="p">,</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="p">,</span>
                <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="n">xrange</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_non_chains</span> <span class="k">else</span>
                <span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">))</span>
                            <span class="k">if</span> <span class="p">(</span>
                                <span class="ow">not</span> <span class="n">skip_non_chains</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_chain</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                            <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                                <span class="n">min_mass</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_mass</span>
                            <span class="p">)</span>
                    <span class="p">),</span>
                    <span class="n">head</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">))</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1"> -- Checked certain type of chain among the top &#39;</span>
                <span class="s1">&#39;</span><span class="si">%u</span><span class="s1"> fragments. -- </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="Scan.get_most_abundant_chain"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.get_most_abundant_chain">[docs]</a>    <span class="k">def</span> <span class="nf">get_most_abundant_chain</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">head</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">frag_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">chain_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">c</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">u</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Looks up the most abundant fatty acid fragment of the given type.</span>
<span class="sd">        Returns the fragment index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_fragment_type_is</span><span class="p">(</span>
                <span class="n">i</span><span class="p">,</span>
                <span class="n">frag_type</span> <span class="o">=</span> <span class="n">frag_type</span><span class="p">,</span>
                <span class="n">chain_type</span> <span class="o">=</span> <span class="n">chain_type</span><span class="p">,</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="p">,</span>
                <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">,</span>
            <span class="p">):</span>
                
                <span class="k">return</span> <span class="n">i</span></div>
    
<div class="viewcode-block" id="Scan.chain_percent_of_most_abundant"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.chain_percent_of_most_abundant">[docs]</a>    <span class="k">def</span> <span class="nf">chain_percent_of_most_abundant</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">percent</span><span class="p">,</span>
            <span class="n">frag_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">chain_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">c</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">u</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if a certain chain present with an abundance at least the</span>
<span class="sd">        given percent of the most abundant fragment.</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">        :param float percent:</span>
<span class="sd">            Percentage, between 0 and 100.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="nb">any</span><span class="p">((</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chain_among_most_abundant</span><span class="p">(</span>
                <span class="n">i</span><span class="p">,</span>
                <span class="n">frag_type</span> <span class="o">=</span> <span class="n">frag_type</span><span class="p">,</span>
                <span class="n">chain_type</span> <span class="o">=</span> <span class="n">chain_type</span><span class="p">,</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="p">,</span>
                <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span>
            <span class="n">itertools</span><span class="o">.</span><span class="n">takewhile</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">inorm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">percent</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">,</span>
                <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="p">))</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="Scan.mz_most_abundant_fold"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.mz_most_abundant_fold">[docs]</a>    <span class="k">def</span> <span class="nf">mz_most_abundant_fold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz</span><span class="p">,</span> <span class="n">fold</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if an m/z is the most abundant fragment</span>
<span class="sd">        and it has at least a certain fold higher intensity</span>
<span class="sd">        than any other fragment.</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">        :param float mz:</span>
<span class="sd">            The m/z value.</span>
<span class="sd">        :param float fold:</span>
<span class="sd">            The m/z must be this times higher than any other.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">most_abundant_mz_is</span><span class="p">(</span><span class="n">mz</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mzs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">fold</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- m/z </span><span class="si">%.03f</span><span class="s1"> is at least </span><span class="si">%u</span><span class="s1"> times higher than &#39;</span>
                <span class="s1">&#39;any other? -- </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mz</span><span class="p">,</span> <span class="n">fold</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="Scan.cer_fa_test"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.cer_fa_test">[docs]</a>    <span class="k">def</span> <span class="nf">cer_fa_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i_fa</span><span class="p">,</span> <span class="n">i_sph</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chain_fragment_type_is</span><span class="p">(</span>
                <span class="n">i_fa</span><span class="p">,</span>
                <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;FA+C2+NH2-O&#39;</span><span class="p">,</span>
                <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">,</span>
            <span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chain_fragment_type_id</span><span class="p">(</span>
                <span class="n">i_sph</span><span class="p">,</span>
                <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-C2H4-NH2-H2O&#39;</span><span class="p">,</span>
                <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">,</span>
            <span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span><span class="p">[</span><span class="n">i_fa</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span><span class="p">[</span><span class="n">i_sph</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.has_chain_combinations"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.has_chain_combinations">[docs]</a>    <span class="k">def</span> <span class="nf">has_chain_combinations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rec</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls `chain_combinations` only to check if at least one</span>
<span class="sd">        conbination explicitely confirmed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">ccomb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_combinations</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            
            <span class="n">_</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">ccomb</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="kc">True</span>
            
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            
            <span class="k">return</span> <span class="kc">False</span></div>
    
<div class="viewcode-block" id="Scan.chain_combinations"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.chain_combinations">[docs]</a>    <span class="k">def</span> <span class="nf">chain_combinations</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">rec</span><span class="p">,</span>
            <span class="n">head</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">intensity_threshold</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">expected_intensities</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">no_intensity_check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">frag_types</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">fragment_details</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds all combinations of chain derived fragments matching the</span>
<span class="sd">        total carbon count and unsaturation in a database record.</span>
<span class="sd">        </span>
<span class="sd">        Yields tuple of chains (`lipproc.Chain` objects).</span>
<span class="sd">        </span>
<span class="sd">        Arguments not listed here explained at `frags_for_positions`.</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">        :param lipproc.LipidRecord rec:</span>
<span class="sd">            The database record to match against.</span>
<span class="sd">        :param bool no_intensity_check:</span>
<span class="sd">            Completely skip checking intensity ratios.</span>
<span class="sd">        :param float intensity_threshold:</span>
<span class="sd">            Only fragments with intensities above this threshold will be</span>
<span class="sd">            considered. Intensities relative to the highest, between 0 and 1.</span>
<span class="sd">        :param tuple frag_types:</span>
<span class="sd">            See at `frags_for_positions`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rec</span><span class="o">.</span><span class="n">chains</span><span class="p">:</span>
            
            <span class="k">return</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">build_chain_list</span><span class="p">()</span>
        
        <span class="n">chainsum</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span> <span class="ow">or</span> <span class="n">lipproc</span><span class="o">.</span><span class="n">sum_chains</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">chains</span><span class="p">)</span>
        
        <span class="n">frags_for_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frags_for_positions</span><span class="p">(</span>
            <span class="n">rec</span><span class="p">,</span>
            <span class="n">head</span> <span class="o">=</span> <span class="n">head</span><span class="p">,</span>
            <span class="n">intensity_threshold</span> <span class="o">=</span> <span class="n">intensity_threshold</span><span class="p">,</span>
            <span class="n">frag_types</span> <span class="o">=</span> <span class="n">frag_types</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frags_for_position</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="o">.</span><span class="n">typ</span><span class="p">):</span>
            <span class="c1"># if one or more chains have no corresponding fragment</span>
            <span class="c1"># we do not yield anything;</span>
            <span class="c1"># for finding missing those chains `missing_chains`</span>
            <span class="c1"># can be used</span>
            <span class="k">return</span>
        
        <span class="c1"># iterate all combinations</span>
        <span class="k">for</span> <span class="n">frag_comb</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="o">*</span><span class="p">(</span>
                <span class="c1"># making a sorted list of lists from the dict</span>
                <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span>
                <span class="nb">sorted</span><span class="p">(</span><span class="n">frags_for_position</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="p">):</span>
            
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">sum</span><span class="p">(</span><span class="n">frag</span><span class="o">.</span><span class="n">c</span> <span class="k">for</span> <span class="n">frag</span> <span class="ow">in</span> <span class="n">frag_comb</span><span class="p">)</span> <span class="o">==</span> <span class="n">chainsum</span><span class="o">.</span><span class="n">c</span> <span class="ow">and</span>
                <span class="nb">sum</span><span class="p">(</span><span class="n">frag</span><span class="o">.</span><span class="n">u</span> <span class="k">for</span> <span class="n">frag</span> <span class="ow">in</span> <span class="n">frag_comb</span><span class="p">)</span> <span class="o">==</span> <span class="n">chainsum</span><span class="o">.</span><span class="n">u</span>
            <span class="p">):</span>
                
                <span class="k">if</span> <span class="p">(</span>
                    <span class="c1"># bypass intensity check</span>
                    <span class="n">no_intensity_check</span> <span class="ow">or</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_intensity_check</span><span class="p">(</span>
                        <span class="n">frag_comb</span><span class="p">,</span> <span class="n">chainsum</span><span class="p">,</span> <span class="n">expected_intensities</span>
                    <span class="p">)</span>
                <span class="p">):</span>
                    
                    <span class="c1"># now all conditions satisfied:</span>
                    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains_frag_comb</span><span class="p">(</span>
                        <span class="n">frag_comb</span><span class="p">,</span> <span class="n">chainsum</span><span class="p">,</span> <span class="n">details</span> <span class="o">=</span> <span class="n">fragment_details</span>
                    <span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.frags_for_positions"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.frags_for_positions">[docs]</a>    <span class="k">def</span> <span class="nf">frags_for_positions</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">rec</span><span class="p">,</span>
            <span class="n">head</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">intensity_threshold</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">frag_types</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the possible fragments for each positions (sn1, sn2 in</span>
<span class="sd">        glycerophospholipids, sphingosine base and N-acyl in sphingolipids,</span>
<span class="sd">        etc).</span>
<span class="sd">        </span>
<span class="sd">        :param int head:</span>
<span class="sd">            If `None` or `numpy.inf` all fragment ions will be considered,</span>
<span class="sd">            otherwise only the first most aboundant until the number `head`.</span>
<span class="sd">        :param float intensity_threshold:</span>
<span class="sd">            Only fragments with intensities above this threshold will be</span>
<span class="sd">            considered. Intensities relative to the highest, between 0 and 1.</span>
<span class="sd">        :param tuple frag_types:</span>
<span class="sd">            Limit the query to certain fragment types in addition to</span>
<span class="sd">            built in fragment constraints and other criteria.</span>
<span class="sd">            A tuple of tuples with fragment type names can be provided</span>
<span class="sd">            each for one position with None values where default fragment</span>
<span class="sd">            types should be used. E.g. `((&#39;FA_mH&#39;, &#39;Lyso_PA&#39;), None)` means</span>
<span class="sd">            the chain in first position might be found as fatty acid minus</span>
<span class="sd">            hydrogen fragment or lysophosphatidic acid fragment, while the</span>
<span class="sd">            second position could be anything allowed by the built in</span>
<span class="sd">            constraints.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">frags_for_position</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        
        <span class="n">chain_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adduct_chain_list</span><span class="p">(</span><span class="n">adduct</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">frag</span> <span class="ow">in</span> <span class="n">chain_list</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">head</span> <span class="ow">and</span> <span class="n">frag</span><span class="o">.</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">head</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inorm</span><span class="p">[</span><span class="n">frag</span><span class="o">.</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">intensity_threshold</span>
            <span class="p">):</span>
                
                <span class="k">break</span>
            
            <span class="n">chpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions_for_frag_type</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">frag</span><span class="o">.</span><span class="n">fragtype</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">ci</span> <span class="ow">in</span> <span class="n">chpos</span><span class="p">:</span>
                
                <span class="k">if</span> <span class="p">(</span>
                    <span class="c1"># frag_types constraints</span>
                    <span class="ow">not</span> <span class="n">frag_types</span> <span class="ow">or</span>
                    <span class="ow">not</span> <span class="n">frag_types</span><span class="p">[</span><span class="n">ci</span><span class="p">]</span> <span class="ow">or</span>
                    <span class="n">frag</span><span class="o">.</span><span class="n">fragtype</span> <span class="ow">in</span> <span class="n">frag_types</span><span class="p">[</span><span class="n">ci</span><span class="p">]</span>
                <span class="p">):</span>
                    
                    <span class="n">frags_for_position</span><span class="p">[</span><span class="n">ci</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frag</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">frags_for_position</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.intensity_ratios"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.intensity_ratios">[docs]</a>    <span class="k">def</span> <span class="nf">intensity_ratios</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">intensities</span><span class="p">,</span>
            <span class="n">frag_indices</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">logbase</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if the ratio of a list of intensities fits the one in</span>
<span class="sd">        `expected` or is more or less even if `expected` is `None`.</span>
<span class="sd">        </span>
<span class="sd">        :param list intensities:</span>
<span class="sd">            List of intensities.</span>
<span class="sd">        :param list expected:</span>
<span class="sd">            List with expected intensity proportions. E.g. `[1, 1, 2]`</span>
<span class="sd">            means the third ion is twice higher intense than the 2 others.</span>
<span class="sd">        :param int logbase:</span>
<span class="sd">            The fold difference tolerance when comparing intensities.</span>
<span class="sd">            E.g. if this is 2, then an almost twice less or more intense</span>
<span class="sd">            ion will considered to have similar intensity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">logbase</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;chain_fragment_instensity_ratios_logbase&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">intensities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            
            <span class="k">return</span> <span class="kc">True</span>
        
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">intensities</span><span class="p">):</span>
            
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Negative intensity value encountered&#39;</span>
                <span class="s1">&#39;(sample=</span><span class="si">%s</span><span class="s1">, ion mode=</span><span class="si">%s</span><span class="s1">, scan=</span><span class="si">%u</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ionmode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_id</span>
                <span class="p">)</span>
            <span class="p">)</span>
        
        <span class="n">frag_indices</span> <span class="o">=</span> <span class="n">frag_indices</span> <span class="ow">or</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intensities</span><span class="p">)))</span>
        <span class="c1"># to know if one fragment contributes more than one times;</span>
        <span class="c1"># intensities divided by the times the fragment is incident</span>
        <span class="n">cntr</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="n">frag_indices</span><span class="p">)</span>
        
        <span class="c1"># by default expecting more or less equal intensities</span>
        <span class="k">if</span> <span class="n">expected</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">intensities</span><span class="p">)</span>
        
        <span class="c1"># intensities corrected by the expected and the counts</span>
        <span class="n">intcorr</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ins</span> <span class="o">/</span> <span class="n">expected</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">cntr</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ins</span><span class="p">),</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">intensities</span><span class="p">),</span> <span class="n">frag_indices</span><span class="p">)</span>
        <span class="p">]</span>
        
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">all</span><span class="p">((</span>
                <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">co</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">logbase</span><span class="p">)</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">co</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">logbase</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">co</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">intcorr</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="p">))</span>
        <span class="p">)</span></div>
    
    <span class="k">def</span> <span class="nf">_intensity_check</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">frag_comb</span><span class="p">,</span>
            <span class="n">chainsum</span><span class="p">,</span>
            <span class="n">expected_intensities</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs the chain intensity ratio check according to settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="p">(</span>
                <span class="c1"># need to check intensity ratios</span>
                <span class="p">(</span><span class="n">chainsum</span><span class="o">.</span><span class="n">typ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Sph&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_ratio_s</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">chainsum</span><span class="o">.</span><span class="n">typ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Sph&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_ratio_g</span><span class="p">)</span> <span class="ow">or</span>
                <span class="n">expected_intensities</span>
            <span class="p">)</span> <span class="ow">or</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">intensity_ratios</span><span class="p">(</span>
                <span class="c1"># intensity ratios are ok</span>
                <span class="n">intensities</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">intensity</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">frag_comb</span><span class="p">),</span>
                <span class="n">frag_indices</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">i</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">frag_comb</span><span class="p">),</span>
                <span class="n">expected</span> <span class="o">=</span> <span class="n">expected_intensities</span><span class="p">,</span>
                <span class="n">logbase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iratio_logbase</span>
            <span class="p">)</span>
        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_chains_frag_comb</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">frag_comb</span><span class="p">,</span>
            <span class="n">chainsum</span><span class="p">,</span>
            <span class="n">details</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">missing_position</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">missing_chain</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a tuple of chains from a fragment annotation combination</span>
<span class="sd">        and a database record chain summary object.</span>
<span class="sd">        </span>
<span class="sd">        Potentially includes a missing chain which does not yield any</span>
<span class="sd">        fragment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># boolean: whether we provide details or not</span>
        <span class="n">details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_details</span> <span class="k">if</span> <span class="n">details</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">details</span>
        
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">tuple</span><span class="p">(</span>
                <span class="n">lipproc</span><span class="o">.</span><span class="n">Chain</span><span class="p">(</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">frag_comb</span><span class="p">[</span><span class="n">ifrag</span><span class="p">]</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
                    <span class="n">u</span> <span class="o">=</span> <span class="n">frag_comb</span><span class="p">[</span><span class="n">ifrag</span><span class="p">]</span><span class="o">.</span><span class="n">u</span><span class="p">,</span>
                    <span class="n">typ</span> <span class="o">=</span> <span class="n">frag_comb</span><span class="p">[</span><span class="n">ifrag</span><span class="p">]</span><span class="o">.</span><span class="n">chaintype</span><span class="p">,</span>
                    <span class="n">attr</span> <span class="o">=</span> <span class="n">lipproc</span><span class="o">.</span><span class="n">ChainAttr</span><span class="p">(</span>
                        <span class="c1"># take the sphingosine base type</span>
                        <span class="c1"># from the chainsum of the record</span>
                        <span class="n">sph</span> <span class="o">=</span> <span class="n">chainsum</span><span class="o">.</span><span class="n">attr</span><span class="p">[</span><span class="n">ichain</span><span class="p">]</span><span class="o">.</span><span class="n">sph</span><span class="p">,</span>
                        <span class="n">ether</span> <span class="o">=</span> <span class="n">frag_comb</span><span class="p">[</span><span class="n">ifrag</span><span class="p">]</span><span class="o">.</span><span class="n">chaintype</span> <span class="o">==</span> <span class="s1">&#39;FAL&#39;</span><span class="p">,</span>
                        <span class="n">oh</span> <span class="o">=</span> <span class="n">chainsum</span><span class="o">.</span><span class="n">attr</span><span class="p">[</span><span class="n">ichain</span><span class="p">]</span><span class="o">.</span><span class="n">oh</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">ifrag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span>
                <span class="n">missing_chain</span>
                <span class="c1"># chain indices and fragment indices</span>
                <span class="k">for</span> <span class="n">ichain</span><span class="p">,</span> <span class="n">ifrag</span> <span class="ow">in</span> <span class="n">iterator_insert</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">chainsum</span><span class="p">),</span>
                    <span class="n">missing_position</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="n">ChainIdentificationDetails</span><span class="p">(</span>
                <span class="n">rank</span>     <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                    <span class="n">frag_comb</span><span class="p">[</span><span class="n">ifrag</span><span class="p">]</span><span class="o">.</span><span class="n">i</span>
                    <span class="k">if</span> <span class="n">ifrag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="k">for</span> <span class="n">ichain</span><span class="p">,</span> <span class="n">ifrag</span> <span class="ow">in</span> <span class="n">iterator_insert</span><span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">chainsum</span><span class="p">),</span>
                        <span class="n">missing_position</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">),</span>
                <span class="n">i</span>        <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">inorm</span><span class="p">[</span><span class="n">frag_comb</span><span class="p">[</span><span class="n">ifrag</span><span class="p">]</span><span class="o">.</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">ifrag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="k">for</span> <span class="n">ichain</span><span class="p">,</span> <span class="n">ifrag</span> <span class="ow">in</span> <span class="n">iterator_insert</span><span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">chainsum</span><span class="p">),</span>
                        <span class="n">missing_position</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">),</span>
                <span class="n">fragtype</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                    <span class="n">frag_comb</span><span class="p">[</span><span class="n">ifrag</span><span class="p">]</span><span class="o">.</span><span class="n">fragtype</span>
                    <span class="k">if</span> <span class="n">ifrag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="k">for</span> <span class="n">ichain</span><span class="p">,</span> <span class="n">ifrag</span> <span class="ow">in</span> <span class="n">iterator_insert</span><span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">chainsum</span><span class="p">),</span>
                        <span class="n">missing_position</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">),</span>
            <span class="p">)</span> <span class="k">if</span> <span class="n">details</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="Scan.missing_chain"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.missing_chain">[docs]</a>    <span class="k">def</span> <span class="nf">missing_chain</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">rec</span><span class="p">,</span>
            <span class="n">missing_position</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">head</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">intensity_threshold</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">expected_intensities</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">no_intensity_check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">frag_types</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds &#39;&#39;missing&#39;&#39; chains i.e. which could complement the chains</span>
<span class="sd">        identified among the fragments to fit the species in the record.</span>
<span class="sd">        </span>
<span class="sd">        Yields tuples with first element a tuple of identified chains and</span>
<span class="sd">        as second element the missing chain.</span>
<span class="sd">        </span>
<span class="sd">        Works a similar way to `chain_combinations`.</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">        :param int missing_position:</span>
<span class="sd">            Position of the missing chain. 0, 1, 2 are sn1, sn2 and sn3</span>
<span class="sd">            positions on glycerol, 0 and 1 are sphingosine base and</span>
<span class="sd">            N-acyl in sphingolipids, respectively.</span>
<span class="sd">            By default is 1 (sn2 or N-acyl).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">chain_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adduct_chain_list</span><span class="p">(</span><span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">)</span>
        
        <span class="n">chainsum</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span> <span class="ow">or</span> <span class="n">lipproc</span><span class="o">.</span><span class="n">sum_chains</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">chains</span><span class="p">)</span>
        
        <span class="n">frags_for_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frags_for_positions</span><span class="p">(</span>
            <span class="n">rec</span><span class="p">,</span>
            <span class="n">head</span> <span class="o">=</span> <span class="n">head</span><span class="p">,</span>
            <span class="n">intensity_threshold</span> <span class="o">=</span> <span class="n">intensity_threshold</span><span class="p">,</span>
            <span class="n">frag_types</span> <span class="o">=</span> <span class="n">frag_types</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">missing_position</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="o">.</span><span class="n">typ</span><span class="p">):</span>
            
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;No chain known at position </span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">missing_position</span>
            <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">missing_position</span> <span class="ow">in</span> <span class="n">frags_for_position</span><span class="p">:</span>
            
            <span class="n">chains_at_missing</span> <span class="o">=</span> <span class="n">frags_for_position</span><span class="p">[</span><span class="n">missing_position</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">frags_for_position</span><span class="p">[</span><span class="n">missing_position</span><span class="p">]</span>
            
        <span class="k">else</span><span class="p">:</span>
            
            <span class="n">chains_at_missing</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># iterate all combinations</span>
        <span class="k">for</span> <span class="n">frag_comb</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="o">*</span><span class="p">(</span>
                <span class="c1"># making a sorted list of lists from the dict</span>
                <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span>
                <span class="nb">sorted</span><span class="p">(</span><span class="n">iteritems</span><span class="p">(</span><span class="n">frags_for_position</span><span class="p">),</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="p">):</span>
            
            <span class="c1"># if more than one chain missing</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">frag_comb</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                
                <span class="k">continue</span>
            
            <span class="n">missing_c</span> <span class="o">=</span> <span class="n">chainsum</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">frag</span><span class="o">.</span><span class="n">c</span> <span class="k">for</span> <span class="n">frag</span> <span class="ow">in</span> <span class="n">frag_comb</span><span class="p">)</span>
            <span class="n">missing_u</span> <span class="o">=</span> <span class="n">chainsum</span><span class="o">.</span><span class="n">u</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">frag</span><span class="o">.</span><span class="n">u</span> <span class="k">for</span> <span class="n">frag</span> <span class="ow">in</span> <span class="n">frag_comb</span><span class="p">)</span>
            
            <span class="c1"># do not yield impossible values</span>
            <span class="k">if</span> <span class="n">missing_c</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">missing_u</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">missing_u</span> <span class="o">&gt;</span> <span class="n">missing_c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                
                <span class="k">continue</span>
            
            <span class="k">if</span> <span class="p">(</span>
                <span class="c1"># bypass intensity check</span>
                <span class="n">no_intensity_check</span> <span class="ow">or</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_intensity_check</span><span class="p">(</span>
                    <span class="n">frag_comb</span><span class="p">,</span> <span class="n">chainsum</span><span class="p">,</span> <span class="n">expected_intensities</span>
                <span class="p">)</span>
            <span class="p">):</span>
                
                <span class="n">missing_chain</span> <span class="o">=</span> <span class="n">lipproc</span><span class="o">.</span><span class="n">Chain</span><span class="p">(</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">missing_c</span><span class="p">,</span>
                    <span class="n">u</span> <span class="o">=</span> <span class="n">missing_u</span><span class="p">,</span>
                    <span class="n">typ</span> <span class="o">=</span> <span class="n">chainsum</span><span class="o">.</span><span class="n">typ</span><span class="p">[</span><span class="n">missing_position</span><span class="p">],</span>
                    <span class="n">attr</span> <span class="o">=</span> <span class="n">chainsum</span><span class="o">.</span><span class="n">attr</span><span class="p">[</span><span class="n">missing_position</span><span class="p">]</span>
                <span class="p">)</span>
                
                <span class="c1"># now all conditions satisfied:</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chains_frag_comb</span><span class="p">(</span>
                    <span class="n">frag_comb</span><span class="p">,</span>
                    <span class="n">chainsum</span><span class="p">,</span>
                    <span class="n">missing_position</span> <span class="o">=</span> <span class="n">missing_position</span><span class="p">,</span>
                    <span class="n">missing_chain</span> <span class="o">=</span> <span class="n">missing_chain</span><span class="p">,</span>
                <span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.cu_complete"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.cu_complete">[docs]</a>    <span class="k">def</span> <span class="nf">cu_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chainsum</span><span class="p">,</span> <span class="n">chain</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the carbon count and unsaturation needed to complete</span>
<span class="sd">        the `chain` or `c` and `u` to fit the `chainsum`.</span>
<span class="sd">        </span>
<span class="sd">        Returns tuple of c and u.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="ow">or</span> <span class="n">chain</span><span class="o">.</span><span class="n">c</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">u</span> <span class="ow">or</span> <span class="n">chain</span><span class="o">.</span><span class="n">u</span>
        
        <span class="k">return</span> <span class="n">chainsum</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">c</span><span class="p">,</span> <span class="n">chainsum</span><span class="o">.</span><span class="n">u</span> <span class="o">-</span> <span class="n">u</span></div>
    
<div class="viewcode-block" id="Scan.iterrecords"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.iterrecords">[docs]</a>    <span class="k">def</span> <span class="nf">iterrecords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adducts</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates MS1 records.</span>
<span class="sd">        Yields tuple of adduct type and record.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">for</span> <span class="n">add</span><span class="p">,</span> <span class="n">recs</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms1_records</span><span class="p">):</span>
            
            <span class="k">if</span> <span class="n">adducts</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">add</span> <span class="ow">in</span> <span class="n">adducts</span><span class="p">:</span>
                
                <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">recs</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    
                    <span class="k">yield</span> <span class="n">add</span><span class="p">,</span> <span class="n">rec</span></div>
    
<div class="viewcode-block" id="Scan.records_by_type"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.records_by_type">[docs]</a>    <span class="k">def</span> <span class="nf">records_by_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headgroup</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(),</span> <span class="n">adducts</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates MS1 database records with a certain headgroup and subtype.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">sub</span>
                <span class="k">if</span> <span class="nb">type</span> <span class="p">(</span><span class="n">sub</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">set</span> <span class="k">else</span>
            <span class="nb">set</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="k">else</span>
            <span class="nb">set</span><span class="p">([</span><span class="n">sub</span><span class="p">])</span>
        <span class="p">)</span>
        
        <span class="k">for</span> <span class="n">add</span><span class="p">,</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterrecords</span><span class="p">(</span><span class="n">adducts</span> <span class="o">=</span> <span class="n">adducts</span><span class="p">):</span>
            
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">hg</span> <span class="ow">and</span> <span class="n">rec</span><span class="o">.</span><span class="n">hg</span><span class="o">.</span><span class="n">main</span> <span class="o">==</span> <span class="n">headgroup</span> <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">hg</span><span class="o">.</span><span class="n">sub</span><span class="p">)</span> <span class="o">==</span> <span class="n">sub</span><span class="p">:</span>
                
                <span class="k">yield</span> <span class="n">rec</span></div>
    
<div class="viewcode-block" id="Scan.first_record"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.first_record">[docs]</a>    <span class="k">def</span> <span class="nf">first_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headgroup</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(),</span> <span class="n">adducts</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the first MS1 database record matching headgroup and subtype.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">recbytyp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records_by_type</span><span class="p">(</span>
            <span class="n">headgroup</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="n">sub</span><span class="p">,</span> <span class="n">adducts</span> <span class="o">=</span> <span class="n">adducts</span>
        <span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            
            <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">recbytyp</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            
            <span class="k">return</span> <span class="kc">None</span></div>
    
<div class="viewcode-block" id="Scan.identify"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.identify">[docs]</a>    <span class="k">def</span> <span class="nf">identify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adducts</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">for</span> <span class="n">add</span><span class="p">,</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterrecords</span><span class="p">(</span><span class="n">adducts</span><span class="p">):</span>
            
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">hg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                
                <span class="k">continue</span>
            
            <span class="n">rec_str</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">summary_str</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">rec_str</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">rec</span><span class="o">.</span><span class="n">hg</span> <span class="ow">in</span> <span class="n">idmethods</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ionmode</span><span class="p">]:</span>
                
                <span class="n">method</span> <span class="o">=</span> <span class="n">idmethods</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ionmode</span><span class="p">][</span><span class="n">rec</span><span class="o">.</span><span class="n">hg</span><span class="p">]</span>
                
                <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">add</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;[M+H]+&#39;</span><span class="p">,</span> <span class="s1">&#39;[M-H]-&#39;</span><span class="p">}</span> <span class="k">else</span> <span class="n">add</span>
                
                <span class="n">result</span><span class="p">[</span><span class="n">rec_str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                    <span class="n">method</span><span class="p">(</span>
                        <span class="n">record</span> <span class="o">=</span> <span class="n">rec</span><span class="p">,</span>
                        <span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="p">,</span>
                        <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">,</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">identify</span><span class="p">()</span>
                <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
    <span class="c1">#</span>
    <span class="c1"># Sphingolipids</span>
    <span class="c1">#</span>
    
<div class="viewcode-block" id="Scan.cer1p_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.cer1p_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">cer1p_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is a Ceramide-1-phosphate.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - GLTPD1 - 616.47</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - The most abundant fragment is 78.9591 metaphosphate.</span>
<span class="sd">      - If 96.9696 phosphate present adds to the score.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">most_abundant_mz_is</span><span class="p">(</span><span class="mf">78.95905658</span><span class="p">):</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">96.96962158</span><span class="p">):</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="Scan.hexcer_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.hexcer_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">hexcer_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is a Hexosyl-Ceramide.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - GLTP - 744.5627</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - Hexose fragments 71.0115, 89.0220 and 101.0219 must present.</span>
<span class="sd">      </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">mz</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_among_most_abundant</span><span class="p">(</span><span class="n">mz</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">10</span><span class="p">),</span>
                   <span class="c1"># these are 3 fragments found at GLTP</span>
                   <span class="p">[</span><span class="mf">71.0115000</span><span class="p">,</span> <span class="mf">89.0220000</span><span class="p">,</span> <span class="mf">101.021900</span><span class="p">])):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="Scan.hexceroh_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.hexceroh_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">hexceroh_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is a Hexosyl-Ceramide-OH</span>
<span class="sd">        (&#39;t&#39;). This method is the same as `hexcer_neg_1`.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - GLTP - 760.557</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - Hexose fragments 71.0115, 89.0220 and 101.0219 must present.</span>
<span class="sd">      </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hexcer_neg_1</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="Scan.sm_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.sm_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">sm_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is a Sphingomyeline.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - GLTPD1 - 745.55</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - Must have a neutral loss of CH3+COOH (60.0211).</span>
<span class="sd">      - Phosphate+choline-CH3 fragment 168.0431 must be present.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_among_most_abundant</span><span class="p">(</span><span class="mf">168.0431206</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_nl</span><span class="p">(</span><span class="mf">60.02113</span><span class="p">):</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="Scan.sph1p_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.sph1p_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">sph1p_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is a Spingosine-1-phosphate.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - Only observed in standard.</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - Phosphate 78.9590 must be present.</span>
<span class="sd">      </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">78.95905658</span><span class="p">):</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="Scan.cer_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.cer_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">cer_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is Ceramide.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - SEC14L1 - 582.509</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - A Ceramide backbone fragment must be among the 2 most abundant.</span>
<span class="sd">      - Ceramide backbone fragments lighter by N or C2N but same carbon</span>
<span class="sd">          count and unsaturation add to the score.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_among_most_abundant</span><span class="p">(</span><span class="s1">&#39;CerFA&#39;</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            <span class="n">fattya</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations</span><span class="p">(</span><span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">fa_h_ccs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matching_fa_frags_of_type</span><span class="p">(</span><span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="s1">&#39;CerFA(&#39;</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">fa_h_cc</span> <span class="ow">in</span> <span class="n">fa_h_ccs</span><span class="p">:</span>
                
                <span class="k">for</span> <span class="n">fa_other</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s1">&#39;[CerFA-N(C</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">)-]-&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;[CerFA-C2N(C</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">)-]-&#39;</span><span class="p">]:</span>
                    
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frag_name_present</span><span class="p">(</span><span class="n">fa_other</span> <span class="o">%</span> <span class="n">fa_h_cc</span><span class="p">):</span>
                        
                        <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="Scan.cerp_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.cerp_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">cerp_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is a Ceramide-1-phosphate.</span>
<span class="sd">        Gives similar result as Sphingosine-1-phosphate.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - GLTPD1 - 616.47</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - The most abundant fragment must be 78.9591 metaphosphate.</span>
<span class="sd">      - Presence of 96.9696 phosphate increase the score.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">most_abundant_mz_is</span><span class="p">(</span><span class="mf">78.95905658</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">96.96962158</span><span class="p">):</span>
                
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="Scan.cerp_pos_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.cerp_pos_1">[docs]</a>    <span class="k">def</span> <span class="nf">cerp_pos_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a positive mode MS2 spectrum is a Ceramide-1-phosphate.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - GLTPD1 + 728.59, 590.45, 702.58, 618.430, 616.415, 640.409</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - A sphingosine fragment with double H2O loss must be among the three</span>
<span class="sd">        highest abundant fragments.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_among_most_abundant</span><span class="p">(</span><span class="s1">&#39;-H2O-H2O+]+&#39;</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="Scan.adduct"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.adduct">[docs]</a>    <span class="k">def</span> <span class="nf">adduct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adduct</span><span class="p">,</span> <span class="n">reset</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a copy of the current scan assuming that the precursor</span>
<span class="sd">        is a certain adduct. The precursor will be converted to [M+H]+</span>
<span class="sd">        or [M-H]- adduct and neutral losses will be calculated accordingly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">adduct</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">adducts</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">reset</span><span class="p">:</span>
            
            <span class="k">return</span>
        
        <span class="n">ad2ex</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ad2ex&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ionmode</span><span class="p">][</span><span class="n">adduct</span><span class="p">]</span>
        <span class="n">ex2ad</span> <span class="o">=</span> <span class="s1">&#39;remove_h&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ionmode</span> <span class="o">==</span> <span class="s1">&#39;neg&#39;</span> <span class="k">else</span> <span class="s1">&#39;add_h&#39;</span>
        
        <span class="n">fake_precursor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">getattr</span><span class="p">(</span>
                <span class="n">mzmod</span><span class="o">.</span><span class="n">Mz</span><span class="p">(</span>
                    <span class="nb">getattr</span><span class="p">(</span>
                        <span class="n">mzmod</span><span class="o">.</span><span class="n">Mz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precursor</span><span class="p">),</span>
                        <span class="n">ad2ex</span>
                    <span class="p">)()</span>
                <span class="p">),</span>
                <span class="n">ex2ad</span>
            <span class="p">)()</span>
        <span class="p">)</span>
        
        <span class="n">annot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_annot</span><span class="p">(</span><span class="n">fake_precursor</span><span class="p">)</span>
        
        <span class="n">chain_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_chain_list</span><span class="p">(</span><span class="n">annot</span> <span class="o">=</span> <span class="n">annot</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">adducts</span><span class="p">[</span><span class="n">adduct</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;fake_precursor&#39;</span><span class="p">:</span> <span class="n">fake_precursor</span><span class="p">,</span>
            <span class="s1">&#39;annot&#39;</span><span class="p">:</span> <span class="n">annot</span><span class="p">,</span>
            <span class="s1">&#39;chain_list&#39;</span><span class="p">:</span> <span class="n">chain_list</span><span class="p">,</span>
        <span class="p">}</span></div>
    
<div class="viewcode-block" id="Scan.adduct_annot"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.adduct_annot">[docs]</a>    <span class="k">def</span> <span class="nf">adduct_annot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the annotations for a certain adduct.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">adduct_data</span><span class="p">(</span><span class="s1">&#39;annot&#39;</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.adduct_chain_list"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.adduct_chain_list">[docs]</a>    <span class="k">def</span> <span class="nf">adduct_chain_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the chain list for a certain adduct.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">adduct_data</span><span class="p">(</span><span class="s1">&#39;chain_list&#39;</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="n">adduct</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Scan.adduct_data"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Scan.adduct_data">[docs]</a>    <span class="k">def</span> <span class="nf">adduct_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">adduct</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">adduct</span><span class="p">(</span><span class="n">adduct</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">adducts</span><span class="p">[</span><span class="n">adduct</span><span class="p">][</span><span class="n">name</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="AbstractMS2Identifier"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.AbstractMS2Identifier">[docs]</a><span class="k">class</span> <span class="nc">AbstractMS2Identifier</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="n">class_methods</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">subclass_methods</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">adduct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">explicit_and_implicit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">must_have_chains</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="n">missing_chain_args</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rec</span> <span class="o">=</span> <span class="n">record</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scn</span> <span class="o">=</span> <span class="n">scan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span> <span class="o">=</span> <span class="n">adduct</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">missing_chains</span> <span class="k">if</span> <span class="n">missing_chains</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span>
            <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">chainsum</span><span class="p">)))</span> <span class="c1"># any chain can be missing</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chain_comb_args</span> <span class="o">=</span> <span class="n">chain_comb_args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">missing_chain_args</span> <span class="o">=</span> <span class="n">missing_chain_args</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_comb_args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explicit_and_implicit</span> <span class="o">=</span> <span class="n">explicit_and_implicit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">must_have_chains</span> <span class="o">=</span> <span class="n">must_have_chains</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">scores</span> <span class="o">=</span> <span class="p">{}</span>
    
<div class="viewcode-block" id="AbstractMS2Identifier.identify"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.AbstractMS2Identifier.identify">[docs]</a>    <span class="k">def</span> <span class="nf">identify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">hg</span><span class="p">:</span>
            
            <span class="k">return</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">confirm_class</span><span class="p">()</span>
        
        <span class="n">chains_confirmed</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="k">for</span> <span class="n">chains</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">confirm_chains_explicit</span><span class="p">():</span>
            
            <span class="k">yield</span> <span class="n">MS2Identity</span><span class="p">(</span>
                <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">percent_score</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">hg</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="p">,</span>
                <span class="n">chains</span> <span class="o">=</span> <span class="n">chains</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">details</span> <span class="o">=</span> <span class="n">chains</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="n">chains_confirmed</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">chains_confirmed</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">explicit_and_implicit</span><span class="p">:</span>
            
            <span class="k">for</span> <span class="n">chains</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">confirm_chains_implicit</span><span class="p">():</span>
                
                <span class="k">yield</span> <span class="n">MS2Identity</span><span class="p">(</span>
                    <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">percent_score</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">hg</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="p">,</span>
                    <span class="n">chains</span> <span class="o">=</span> <span class="n">chains</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">details</span> <span class="o">=</span> <span class="n">chains</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">)</span>
                
                <span class="n">chains_confirmed</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">chains_confirmed</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">must_have_chains</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">:</span>
            
            <span class="k">yield</span> <span class="n">MS2Identity</span><span class="p">(</span>
                <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">percent_score</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">hg</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="p">,</span>
                <span class="n">chains</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">details</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span></div>
    
<div class="viewcode-block" id="AbstractMS2Identifier.percent_score"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.AbstractMS2Identifier.percent_score">[docs]</a>    <span class="k">def</span> <span class="nf">percent_score</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the score as a percentage of the maximum possible score.</span>
<span class="sd">        </span>
<span class="sd">        Zero maximum score means something is wrong, then it returns 200.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">*</span> <span class="mf">100.</span><span class="p">)),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="k">else</span>
            <span class="mi">200</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="AbstractMS2Identifier.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.AbstractMS2Identifier.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        In this base class pass through everything.</span>
<span class="sd">        Most of the subclasses should override this.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">hg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">hg</span><span class="o">.</span><span class="n">main</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_methods</span><span class="p">:</span>
            
            <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">class_methods</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">hg</span><span class="o">.</span><span class="n">main</span><span class="p">]</span>
            <span class="p">)()</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="n">score</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">+=</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="AbstractMS2Identifier.confirm_subclass"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.AbstractMS2Identifier.confirm_subclass">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_subclass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">subclasses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">hg</span><span class="o">.</span><span class="n">sub</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;empty&#39;</span><span class="p">,)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">hg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">subclasses</span><span class="p">:</span>
                
                <span class="k">if</span> <span class="n">sub</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scores</span> <span class="ow">and</span> <span class="n">sub</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclass_methods</span><span class="p">:</span>
                    
                    <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">subclass_methods</span><span class="p">[</span><span class="n">sub</span><span class="p">]</span>
                    <span class="p">)()</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">scores</span><span class="p">[</span><span class="n">sub</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="n">score</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">+=</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="AbstractMS2Identifier.confirm_chains_explicit"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.AbstractMS2Identifier.confirm_chains_explicit">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_chains_explicit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">chain_comb_args</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="AbstractMS2Identifier.confirm_chains_implicit"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.AbstractMS2Identifier.confirm_chains_implicit">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_chains_implicit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">for</span> <span class="n">missing</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_chains</span><span class="p">:</span>
            
            <span class="k">for</span> <span class="n">chain_comb</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">missing_chain</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span>
                <span class="n">missing_position</span> <span class="o">=</span> <span class="n">missing</span><span class="p">,</span>
                <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">missing_chain_args</span>
            <span class="p">):</span>
                
                <span class="k">yield</span> <span class="n">chain_comb</span></div>
    
<div class="viewcode-block" id="AbstractMS2Identifier.matching_chain_combinations"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.AbstractMS2Identifier.matching_chain_combinations">[docs]</a>    <span class="k">def</span> <span class="nf">matching_chain_combinations</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">chain_param1</span><span class="p">,</span>
            <span class="n">chain_param2</span><span class="p">,</span>
            <span class="n">score_method</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ccomb</span><span class="p">:</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ccomb</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
        <span class="p">):</span>
        
        <span class="n">ccomb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">matching_chain_combinations</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span>
                <span class="n">chain_param</span> <span class="o">=</span> <span class="p">(</span><span class="n">chain_param1</span><span class="p">,</span> <span class="n">chain_param2</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">))</span>
        
        <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span> <span class="o">=</span> <span class="n">score_method</span><span class="p">(</span><span class="n">ccomb</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="n">score</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">+=</span> <span class="n">score</span></div>
    
<div class="viewcode-block" id="AbstractMS2Identifier.check_lyso"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.AbstractMS2Identifier.check_lyso">[docs]</a>    <span class="k">def</span> <span class="nf">check_lyso</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">score_threshold</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether the this mass has been identified in the database</span>
<span class="sd">        as a lyso species and calls the corresponding lyso identification</span>
<span class="sd">        method.</span>
<span class="sd">        </span>
<span class="sd">        Returns ``True`` if the score from the lyso is larger than</span>
<span class="sd">        ``score_threshold``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">rec_lyso</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">first_record</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">hg</span><span class="o">.</span><span class="n">main</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,))</span>
        
        <span class="k">if</span> <span class="n">rec_lyso</span><span class="p">:</span>
            
            <span class="n">lyso_hg</span> <span class="o">=</span> <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span>
                <span class="n">main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">hg</span><span class="o">.</span><span class="n">main</span><span class="p">,</span>
                <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,),</span>
            <span class="p">)</span>
            <span class="n">lyso</span> <span class="o">=</span> <span class="n">idmethods</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">ionmode</span><span class="p">][</span><span class="n">lyso_hg</span><span class="p">](</span><span class="n">rec_lyso</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="p">)</span>
            <span class="n">lyso</span><span class="o">.</span><span class="n">confirm_class</span><span class="p">()</span>
            
            <span class="k">return</span> <span class="n">lyso</span><span class="o">.</span><span class="n">score</span> <span class="o">&gt;</span> <span class="n">score_threshold</span>
        
        <span class="k">return</span> <span class="kc">False</span></div></div>


<span class="c1">#</span>
<span class="c1"># Lipid identification methods</span>
<span class="c1">#</span>

<span class="c1">#</span>
<span class="c1"># Fatty acids</span>
<span class="c1">#</span>

<div class="viewcode-block" id="FA_Negative"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.FA_Negative">[docs]</a><span class="k">class</span> <span class="nc">FA_Negative</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a negative mode MS2 spectrum is a fatty acid.</span>
<span class="sd">    Here we only check if the most abundant fragment is the</span>
<span class="sd">    fatty acid itself.</span>

<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - in vitro FABP1 -</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - The most abundant fragment must be a fatty acid which matches</span>
<span class="sd">      the carbon count and the unsaturation of the whole molecule.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;head&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;frag_types&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="mi">0</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;FA-H&#39;</span><span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="FA_Negative.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.FA_Negative.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">10</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_among_most_abundant</span><span class="p">(</span>
                <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;FA-H&#39;</span><span class="p">,</span>
                <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
                <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="o">.</span><span class="n">u</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="mi">10</span></div></div>


<div class="viewcode-block" id="FA_Positive"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.FA_Positive">[docs]</a><span class="k">class</span> <span class="nc">FA_Positive</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a positive mode MS2 spectrum is a fatty acid.</span>
<span class="sd">    Here we only check if the most abundant fragment is the</span>
<span class="sd">    fatty acid itself.</span>

<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - Not known</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - The most abundant fragment must be a fatty acid which matches</span>
<span class="sd">      the carbon count and the unsaturation of the whole molecule.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;head&#39;</span><span class="p">:</span> <span class="mi">1</span>
            <span class="p">}</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="FA_Positive.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.FA_Positive.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">10</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_among_most_abundant</span><span class="p">(</span>
                <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;FA+H&#39;</span><span class="p">,</span>
                <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
                <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="o">.</span><span class="n">u</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="mi">10</span></div></div>

<span class="c1">#</span>
<span class="c1"># Glycerolipids</span>
<span class="c1">#</span>

<div class="viewcode-block" id="DAG_Positive"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.DAG_Positive">[docs]</a><span class="k">class</span> <span class="nc">DAG_Positive</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a positive mode MS2 spectrum is a DAG.</span>

<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - in vivo: SEC14L2 + 584.52</span>
<span class="sd">    - in vitro: BNIP2 + 770.67</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - Combination of fatty acid fragments among the 10 most abundant</span>
<span class="sd">      fragments must match the expected carbon count and unsaturation.</span>
<span class="sd">    - If these are among the 5 highest fragments the score is higher.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="DAG_Positive.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.DAG_Positive.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">6</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">4</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="mi">6</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">2</span></div></div>


<div class="viewcode-block" id="DAG_Negative"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.DAG_Negative">[docs]</a><span class="k">class</span> <span class="nc">DAG_Negative</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a negative mode MS2 spectrum is a DAG.</span>

<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - We don&#39;t have yet.</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - Combination of fatty acid fragments among the 10 most abundant</span>
<span class="sd">      fragments must match the expected carbon count and unsaturation.</span>
<span class="sd">    - If these are among the 5 highest fragments the score is higher.</span>
<span class="sd">    </span>
<span class="sd">    (Same as in positive ionmode.)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="DAG_Negative.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.DAG_Negative.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">6</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">4</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="mi">6</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">2</span></div></div>


<div class="viewcode-block" id="TAG_Positive"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.TAG_Positive">[docs]</a><span class="k">class</span> <span class="nc">TAG_Positive</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a positive mode MS2 spectrum is a TAG.</span>

<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - STARD11 + 818.7187</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - Combination of fatty acid fragments must match the expected</span>
<span class="sd">      carbon count and unsaturation.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="TAG_Positive.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.TAG_Positive.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">10</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="mi">15</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="mi">7</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span></div></div>


<div class="viewcode-block" id="TAG_Negative"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.TAG_Negative">[docs]</a><span class="k">class</span> <span class="nc">TAG_Negative</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a negative mode MS2 spectrum is a TAG.</span>

<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - We don&#39;t have yet.</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - Combination of fatty acid fragments must match the</span>
<span class="sd">      expected carbon count and unsaturation.</span>
<span class="sd">    </span>
<span class="sd">    (Same as in positive ionmode.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="TAG_Negative.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.TAG_Negative.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">5</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span></div></div>


<div class="viewcode-block" id="GL_Positive"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.GL_Positive">[docs]</a><span class="k">class</span> <span class="nc">GL_Positive</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generic class for identification of glycerolipids.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
    <span class="n">class_methods</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;DGTS&#39;</span><span class="p">:</span> <span class="s1">&#39;dgts&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DGCC&#39;</span><span class="p">:</span> <span class="s1">&#39;dgcc&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DGTA&#39;</span><span class="p">:</span> <span class="s1">&#39;dgts&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DGDG&#39;</span><span class="p">:</span> <span class="s1">&#39;dgdg&#39;</span><span class="p">,</span>
        <span class="s1">&#39;MGDG&#39;</span><span class="p">:</span> <span class="s1">&#39;mgdg&#39;</span><span class="p">,</span>
        <span class="s1">&#39;SQDG&#39;</span><span class="p">:</span> <span class="s1">&#39;sqdg&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    
<div class="viewcode-block" id="GL_Positive.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.GL_Positive.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">hg</span><span class="o">.</span><span class="n">main</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_methods</span><span class="p">:</span>
            
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_methods</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">hg</span><span class="o">.</span><span class="n">main</span><span class="p">])()</span></div>
    
<div class="viewcode-block" id="GL_Positive.dgts"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.GL_Positive.dgts">[docs]</a>    <span class="k">def</span> <span class="nf">dgts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">+=</span> <span class="mi">30</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;DGTS [G+TS] (236.1492)&#39;</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;DGTS [TS] (144.1019)&#39;</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_fragment_type</span><span class="p">(</span><span class="s1">&#39;NL FA-H2O&#39;</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">))</span> <span class="o">*</span> <span class="mi">10</span></div>
    
<div class="viewcode-block" id="GL_Positive.dgcc"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.GL_Positive.dgcc">[docs]</a>    <span class="k">def</span> <span class="nf">dgcc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">+=</span> <span class="mi">20</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PC/SM [Ch+H2O] (104.107)&#39;</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;DGCC [C2+Ch] (132.1388)&#39;</span><span class="p">):</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span></div>
    
<div class="viewcode-block" id="GL_Positive.sqdg"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.GL_Positive.sqdg">[docs]</a>    <span class="k">def</span> <span class="nf">sqdg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">+=</span> <span class="mi">10</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [Hexose+SO3+H2O+H] (NL 261.0280)&#39;</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span></div>
    
<div class="viewcode-block" id="GL_Positive.mgdg"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.GL_Positive.mgdg">[docs]</a>    <span class="k">def</span> <span class="nf">mgdg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">+=</span> <span class="mi">10</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[Hexose+H2O-H] (NL 197.07)&#39;</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span></div>
    
<div class="viewcode-block" id="GL_Positive.dgdg"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.GL_Positive.dgdg">[docs]</a>    <span class="k">def</span> <span class="nf">dgdg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">+=</span> <span class="mi">10</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [2xHexose+H2O-H] (NL 359.1190)&#39;</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span></div></div>


<div class="viewcode-block" id="GL_Negative"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.GL_Negative">[docs]</a><span class="k">class</span> <span class="nc">GL_Negative</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generic class for identification of glycerolipids.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="GL_Negative.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.GL_Negative.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">+=</span> <span class="mi">10</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combination</span><span class="p">(</span>
            <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span>
            <span class="n">chain_param</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;FA-H&#39;</span><span class="p">,</span> <span class="s1">&#39;FA-&#39;</span><span class="p">}},</span>
            <span class="p">)</span>
        <span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span></div></div>

<span class="c1">#</span>
<span class="c1"># Glycerophospholipids</span>
<span class="c1">#</span>

<div class="viewcode-block" id="PE_Negative"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PE_Negative">[docs]</a><span class="k">class</span> <span class="nc">PE_Negative</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a negative mode MS2 spectrum is Phosphatidylethanolamine.</span>

<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - GM2A - 714.507 and 716.523</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - The most abundant fragment is a fatty acid [M-H]- ion.</span>
<span class="sd">    - 140.0118 PE headgroup must be present.</span>
<span class="sd">    - Other headgroup ions 196.0380 and 178.0275 add to the score.</span>
<span class="sd">    - Lyso-PE and [M-H-CO2]- fatty acid fragments complementing the</span>
<span class="sd">      highest [M-H]- fatty acid increase the score.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="PE_Negative.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PE_Negative.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">+=</span> <span class="mi">11</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_fragment_type_is</span><span class="p">(</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">chain_type</span> <span class="o">=</span> <span class="s1">&#39;FA&#39;</span><span class="p">,</span>
                <span class="n">frag_type</span>  <span class="o">=</span> <span class="s1">&#39;FA-H&#39;</span>
            <span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PE [P+E] (140.0118)&#39;</span><span class="p">)</span>
        <span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PE [G+P+E-H2O] (196.0380)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PE [G+P+E] (178.0275)&#39;</span><span class="p">),</span>
            <span class="p">)))</span> <span class="o">*</span> <span class="mi">3</span>
            
            <span class="c1"># by default this returns max 6</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matching_chain_combinations</span><span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="s1">&#39;FA-H&#39;</span><span class="p">},</span>
                <span class="p">{</span><span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;LysoPE&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;LysoPEAlkyl&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;LysoPEAlkyl-H2O&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;FA-H2O-H&#39;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">)</span></div></div>


<div class="viewcode-block" id="PE_Positive"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PE_Positive">[docs]</a><span class="k">class</span> <span class="nc">PE_Positive</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a positive mode MS2 spectrum is a</span>
<span class="sd">    Phosphatidylethanolamine.</span>

<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - in vivo BPI + 718.536</span>
<span class="sd">    - Lyso-PE: in vitro FABP1 + 454.29</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - The PE headgroup neutral loss 141.0191 has the highest intensity.</span>
<span class="sd">    - If it is a Lyso-PE score will be zero.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="PE_Positive.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PE_Positive.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">20</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL PE [P+E] (NL 141.0191)&#39;</span><span class="p">):</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_lyso</span><span class="p">():</span>
                
                <span class="k">return</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PE [P+E] (142.0264)&#39;</span><span class="p">):</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">15</span></div></div>


<div class="viewcode-block" id="LysoPE_Positive"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.LysoPE_Positive">[docs]</a><span class="k">class</span> <span class="nc">LysoPE_Positive</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a positive mode MS2 spectrum is a</span>
<span class="sd">    Lysophosphatidylethanolamine.</span>

<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - in vitro FABP1 + 454.29</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - The PE headgroup neutral loss 141.0191 has the highest intensity.</span>
<span class="sd">    - A fatty acid-glycerol fragment should match the carbon count and</span>
<span class="sd">      unsaturation of the whole molecule.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="LysoPE_Positive.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.LysoPE_Positive.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">15</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL PE [P+E] (NL 141.0191)&#39;</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="mi">5</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PE [P+E] (142.0264)&#39;</span><span class="p">):</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">build_chain_list</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_list</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_fragment_type_is</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">i</span><span class="p">,</span>
                    <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;FA+Glycerol-OH&#39;</span><span class="p">,</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
                    <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="o">.</span><span class="n">u</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">):</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span></div></div>


<div class="viewcode-block" id="PC_Negative"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PC_Negative">[docs]</a><span class="k">class</span> <span class="nc">PC_Negative</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a negative mode MS2 spectrum is a Phosphatidylcholine.</span>

<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - BPI - 804.57 and 776.545</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - 168.0431 phosphate+choline-CH3 fragment must be present.</span>
<span class="sd">    - The highest abundant fragment must be a fatty acid [M-H]- fragment.</span>
<span class="sd">    - Lyso-PC fragments complementing the highest [M-H]- fatty acid</span>
<span class="sd">      increase the score.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="PC_Negative.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PC_Negative.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">17</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_fragment_type_is</span><span class="p">(</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">chain_type</span> <span class="o">=</span> <span class="s1">&#39;FA&#39;</span><span class="p">,</span>
                <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;FA-H&#39;</span>
            <span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PC/SM PO4+choline-CH3 (168.0431)&#39;</span><span class="p">)</span>
        <span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PE [G+P+E-H2O] (196.0380)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PE [G+P+E] (178.0275)&#39;</span><span class="p">),</span>
            <span class="p">)))</span> <span class="o">*</span> <span class="mi">3</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">matching_chain_combinations</span><span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="s1">&#39;FA-H&#39;</span><span class="p">},</span>
                <span class="p">{</span><span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="s1">&#39;LysoPC&#39;</span><span class="p">},</span>
                <span class="n">score_method</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ccomb</span><span class="p">:</span> <span class="p">((</span><span class="n">ccomb</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
            <span class="p">)</span></div></div>


<div class="viewcode-block" id="PC_Positive"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PC_Positive">[docs]</a><span class="k">class</span> <span class="nc">PC_Positive</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a positive mode MS2 spectrum is a Phosphatidylcholine.</span>

<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - BPI + 786.607</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - The most abundant fragment must be choline+phosphate 184.0733.</span>
<span class="sd">    - The 86.0964 ethyl-trimetylammonium must be present.</span>
<span class="sd">    - The most abundant fatty acid can not have the same carbon count</span>
<span class="sd">      and unsaturation as the whole molecule (then it is Lyso-PC).</span>
<span class="sd">    - Fragments 104.1069, 124.9998, 60.0808 and 58.0651 increase the</span>
<span class="sd">      score.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="n">must_have_chains</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="PC_Positive.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PC_Positive.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">13</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">fragment_percent_of_most_abundant</span><span class="p">(</span>
                <span class="s1">&#39;PC/SM [P+Ch] (184.0733)&#39;</span><span class="p">,</span> <span class="mf">10.0</span>
            <span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PC/SM [Ch] (86.096)&#39;</span><span class="p">)</span>
        <span class="p">):</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_lyso</span><span class="p">():</span>
                
                <span class="k">return</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PC/SM [Ch+H2O] (104.107)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PC/SM [P+Et] (124.9998)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PC/SM [N+3xCH3] (60.0808)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PC/SM [Ch-Et] (58.0651)&#39;</span><span class="p">),</span>
            <span class="p">)))</span> <span class="o">*</span> <span class="mi">2</span></div></div>


<div class="viewcode-block" id="LysoPC_Positive"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.LysoPC_Positive">[docs]</a><span class="k">class</span> <span class="nc">LysoPC_Positive</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a positive mode MS2 spectrum is a Lysophosphatidylcholine.</span>
<span class="sd">    </span>
<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - in vitro FABP1 + 522.36</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - Choline-phosphate 184.0733, ethyl-trimethylammonium 86.0964 and</span>
<span class="sd">      neutral loss 183.0660 must be present.</span>
<span class="sd">    - The latter neutral loss corresponds to a fatty acid+glycerol ion.</span>
<span class="sd">    - The carbon count and unsaturation of this fragment should match</span>
<span class="sd">      that of the whole molecule.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="n">must_have_chains</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="LysoPC_Positive.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.LysoPC_Positive.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">15</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">most_abundant_fragment_is</span><span class="p">(</span><span class="s1">&#39;PC/SM [P+Ch] (184.0733)&#39;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PC/SM [Ch] (86.096)&#39;</span><span class="p">)</span>
        <span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL PC/SM [P+Ch] (NL 183.066)&#39;</span><span class="p">):</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_fragment_type</span><span class="p">(</span>
                <span class="n">frag_type</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;FA+Glycerol-OH&#39;</span><span class="p">,</span> <span class="s1">&#39;NL FA-H2O&#39;</span><span class="p">},</span>
                <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
                <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="o">.</span><span class="n">u</span><span class="p">,</span>
            <span class="p">):</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span></div></div>


<div class="viewcode-block" id="PI_Negative"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PI_Negative">[docs]</a><span class="k">class</span> <span class="nc">PI_Negative</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a negative MS2 spectrum is Phosphatidylinositol.</span>

<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - GM2A - 835.52</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - Inositolphosphate-H2O fragment 241.0119, metaphosphate 78.9591 and</span>
<span class="sd">      headgroup fragment 152.9958 must be present.</span>
<span class="sd">    - Additional headgroup fragments 96.9696, 259.0224 and 297.0381</span>
<span class="sd">      increase the score.</span>
<span class="sd">    - Presence of Lyso-PI fragments complementing other [M-H]- fatty</span>
<span class="sd">      acid fragments increase the score.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="PI_Negative.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PI_Negative.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">19</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PI [InsP-H2O]- (241.01)&#39;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PA/PG/PI/PS [G+P] (152.9958)&#39;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;Cer1P/PIP/PL metaphosphate (78.9591)&#39;</span><span class="p">)</span>
        <span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;Cer1P/PI phosphate (96.9696)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PI [InsP-H]- (259.02)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PI [G+P+I] (297.04)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PI [InsP-2H2O]- (223.00)&#39;</span><span class="p">),</span>
            <span class="p">)))</span> <span class="o">*</span> <span class="mi">2</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">matching_chain_combinations</span><span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="s1">&#39;FA-H&#39;</span><span class="p">},</span>
                <span class="p">{</span><span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;LysoPI&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;LysoPI-H2O&#39;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="n">score_method</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ccomb</span><span class="p">:</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ccomb</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
            <span class="p">)</span></div></div>


<div class="viewcode-block" id="PI_Positive"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PI_Positive">[docs]</a><span class="k">class</span> <span class="nc">PI_Positive</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a negative MS2 spectrum is Phosphatidylinositol.</span>

<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - SEC14L2 + 906.60 and 882.6</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - Combinations of fatty acid fragments must match the expected</span>
<span class="sd">      carbon count and unsaturation for PI.</span>
<span class="sd">    - Presence of neutral losses 259.0219 and 277.0563 adds to the score.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="n">must_have_chains</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="PI_Positive.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PI_Positive.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">9</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL PI [P+Ins] (NL 259.0219)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL PI [P+Ins+NH3] (NL 277.0563)&#39;</span><span class="p">),</span>
            <span class="p">)))</span> <span class="o">*</span> <span class="mi">4</span></div></div>


<div class="viewcode-block" id="PS_Negative"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PS_Negative">[docs]</a><span class="k">class</span> <span class="nc">PS_Negative</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a negative mode MS2 spectrum is a Phosphatidylserine.</span>

<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - ORP9 - 788.54</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - The most abundant fragment is an [M-H]- fatty acid fragment.</span>
<span class="sd">    - Glycerophosphate fragment 152.9958 must be present.</span>
<span class="sd">    - Metaphosphate 78.9591 increases the score.</span>
<span class="sd">    - Serine-H2O neutral loss 87.0320 adds to the score.</span>
<span class="sd">    - Presence of Lyso-PS and Lyso-PA fragments complementing</span>
<span class="sd">      the highest [M-H]- fatty acid fragment increase the score.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="n">must_have_chains</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="PS_Negative.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PS_Negative.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">17</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_fragment_type_is</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span> <span class="n">chain_type</span> <span class="o">=</span> <span class="s1">&#39;FA&#39;</span><span class="p">,</span> <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;FA-H&#39;</span>
            <span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">fragment_among_most_abundant</span><span class="p">(</span>
                <span class="s1">&#39;PA/PG/PI/PS [G+P] (152.9958)&#39;</span><span class="p">,</span> <span class="mi">5</span>
            <span class="p">)</span>
        <span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;Cer1P/PIP/PL metaphosphate (78.9591)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PS [Ser-H2O] (87.0320)&#39;</span><span class="p">),</span>
            <span class="p">)))</span> <span class="o">*</span> <span class="mi">3</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">matching_chain_combinations</span><span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="s1">&#39;FA-H&#39;</span><span class="p">},</span>
                <span class="p">{</span><span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;LysoPS&#39;</span><span class="p">,</span> <span class="s1">&#39;LysoPA&#39;</span><span class="p">}},</span>
                <span class="n">score_method</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ccomb</span><span class="p">:</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ccomb</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
            <span class="p">)</span></div></div>


<div class="viewcode-block" id="PS_Positive"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PS_Positive">[docs]</a><span class="k">class</span> <span class="nc">PS_Positive</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a positive mode MS2 spectrum is a Phosphatidylserine.</span>

<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - BPI + 790.56</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - PS headgroup neutral loss 185.0089 must be the highest intensity.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="n">must_have_chains</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="PS_Positive.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PS_Positive.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">5</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">fragment_among_most_abundant</span><span class="p">(</span><span class="s1">&#39;PS [P+S] (NL 185.0089)&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span></div></div>


<div class="viewcode-block" id="PG_Negative"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PG_Negative">[docs]</a><span class="k">class</span> <span class="nc">PG_Negative</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a negative mode MS2 spectrum is Phosphatidylglycerol.</span>
<span class="sd">    The result will be the same as `bmp_neg_1`, as in negative</span>
<span class="sd">    mode we do not know a way to distinguish these species.</span>
<span class="sd">    </span>

<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - GM2A - 799.54</span>
<span class="sd">    - BPIFB2 - 773.5258 (might be BMP)</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - The most abundant fragment is a fatty acid [M-H]- ion.</span>
<span class="sd">    - The 152.9958 glycerophosphate fragment must be present.</span>
<span class="sd">    - If Lyso-PG fragment present with carbon count complementing</span>
<span class="sd">      the [M-H]- fatty acid score is higher.</span>
<span class="sd">    - Presence of 171.0064 headgroup fragment adds to the score.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="n">must_have_chains</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="PG_Negative.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PG_Negative.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">14</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_fragment_type_is</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span> <span class="n">chain_type</span> <span class="o">=</span> <span class="s1">&#39;FA&#39;</span><span class="p">,</span> <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;FA-H&#39;</span>
            <span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PA/PG/PI/PS [G+P] (152.9958)&#39;</span><span class="p">)</span>
        <span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PG headgroup (171.0064)&#39;</span><span class="p">):</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">3</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">matching_chain_combinations</span><span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="s1">&#39;FA-H&#39;</span><span class="p">},</span>
                <span class="p">{</span><span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;LysoPG&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;LysoPG-H2O&#39;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="n">score_method</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ccomb</span><span class="p">:</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ccomb</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
            <span class="p">)</span></div></div>


<div class="viewcode-block" id="PG_Positive"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PG_Positive">[docs]</a><span class="k">class</span> <span class="nc">PG_Positive</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a positive mode MS2 spectrum is a Phosphatidylglycerol.</span>
<span class="sd">    At in vivo observed only in standard.</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - The PG headgroup neutral loss (189.0402) is the fragment ion</span>
<span class="sd">      with the highest intensity?</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="PG_Positive.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PG_Positive.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">5</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">most_abundant_fragment_is</span><span class="p">(</span>
                <span class="s1">&#39;NL PG [G+P+NH3] (NL 189.0402)&#39;</span>
            <span class="p">)</span>
        <span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
        
        <span class="c1"># alternative for lyso</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">hg</span><span class="o">.</span><span class="n">sub</span> <span class="o">==</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_fragment_type_among_most_abundant</span><span class="p">(</span>
                <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">frag_type</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;FA+Glycerol-OH&#39;</span><span class="p">},</span>
                <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
                <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="o">.</span><span class="n">u</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">+=</span> <span class="mi">5</span></div></div>


<div class="viewcode-block" id="BMP_Negative"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.BMP_Negative">[docs]</a><span class="k">class</span> <span class="nc">BMP_Negative</span><span class="p">(</span><span class="n">PG_Negative</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a negative mode MS2 spectrum is Bismonoacylglycerophosphate.</span>
<span class="sd">    The result will be the same as for PG, as in negative</span>
<span class="sd">    mode we do not know a way to distinguish these species.</span>
<span class="sd">    </span>

<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - GM2A - 799.54</span>
<span class="sd">    - BPIFB2 - 773.5258 (might be BMP)</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - The most abundant fragment is a fatty acid [M-H]- ion.</span>
<span class="sd">    - The 152.9958 glycerophosphate fragment must be present.</span>
<span class="sd">    - If Lyso-PG fragment present with carbon count complementing</span>
<span class="sd">      the [M-H]- fatty acid score is higher.</span>
<span class="sd">    - Presence of 171.0064 headgroup fragment adds to the score.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">PG_Negative</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="BMP_Positive"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.BMP_Positive">[docs]</a><span class="k">class</span> <span class="nc">BMP_Positive</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a positive mode MS2 spectrum</span>
<span class="sd">    is a Bismonoacylglycerophosphate.</span>

<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - BPIFB2 + 792.57</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - A glycerol+fatty acid fragment can be found among the 3 highest?</span>
<span class="sd">    - The PG headgroup neutral loss (189.0402) is among the fragments?</span>
<span class="sd">    - If so, does it have a lower intensity than half of the fatty</span>
<span class="sd">      acid+glycerol fragment?</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="n">must_have_chains</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="BMP_Positive.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.BMP_Positive.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">10</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_fragment_type_among_most_abundant</span><span class="p">(</span>
                <span class="n">chain_type</span> <span class="o">=</span> <span class="s1">&#39;FA&#39;</span><span class="p">,</span> <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;FA+Glycerol-OH&#39;</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="p">)</span>
        <span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="n">i_hg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">fragment_by_name</span><span class="p">(</span><span class="s1">&#39;NL PG [G+P+NH3] (NL 189.0402)&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">i_hg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                
                <span class="n">i_gfa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">highest_fragment_by_chain_type</span><span class="p">(</span>
                    <span class="n">head</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;FA+Glycerol-OH&#39;</span>
                <span class="p">)</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">intensities</span><span class="p">[</span><span class="n">i_gfa</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">intensities</span><span class="p">[</span><span class="n">i_hg</span><span class="p">]:</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
                
                <span class="k">else</span><span class="p">:</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span></div></div>


<div class="viewcode-block" id="PA_Negative"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PA_Negative">[docs]</a><span class="k">class</span> <span class="nc">PA_Negative</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a negative mode MS2 spectrum is Phosphatidylglycerol.</span>
<span class="sd">    The result will be the same as `bmp_neg_1`, as in negative</span>
<span class="sd">    mode we do not know a way to distinguish these species.</span>
<span class="sd">    </span>

<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - GM2A - 799.54</span>
<span class="sd">    - BPIFB2 - 773.5258 (might be BMP)</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - The most abundant fragment is a fatty acid [M-H]- ion.</span>
<span class="sd">    - The 152.9958 glycerophosphate fragment must be present.</span>
<span class="sd">    - If Lyso-PG fragment present with carbon count complementing</span>
<span class="sd">      the [M-H]- fatty acid score is higher.</span>
<span class="sd">    - Presence of 171.0064 headgroup fragment adds to the score.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="n">must_have_chains</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="PA_Negative.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PA_Negative.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">25</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_fragment_type_is</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span> <span class="n">chain_type</span> <span class="o">=</span> <span class="s1">&#39;FA&#39;</span><span class="p">,</span> <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;FA-H&#39;</span>
            <span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">fragment_among_most_abundant</span><span class="p">(</span>
                <span class="s1">&#39;PA/PG/PI/PS [G+P] (152.9958)&#39;</span><span class="p">,</span> <span class="mi">10</span>
            <span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">fragment_among_most_abundant</span><span class="p">(</span>
                <span class="s1">&#39;Cer1P/PIP/PL metaphosphate (78.9591)&#39;</span><span class="p">,</span> <span class="mi">10</span>
            <span class="p">)</span>
        <span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">20</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;Cer1P/PI phosphate (96.9696)&#39;</span><span class="p">):</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span></div></div>


<div class="viewcode-block" id="PA_Positive"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PA_Positive">[docs]</a><span class="k">class</span> <span class="nc">PA_Positive</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a positive mode MS2 spectrum is a Phosphatidylglycerol.</span>
<span class="sd">    At in vivo observed only in standard.</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - The PG headgroup neutral loss (189.0402) is the fragment ion</span>
<span class="sd">      with the highest intensity?</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="PA_Positive.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.PA_Positive.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">20</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">fragment_among_most_abundant</span><span class="p">(</span>
                <span class="s1">&#39;NL [P] (NL 97.9769)&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span>
            <span class="p">)</span>
        <span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combination</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span>
                <span class="n">chain_param</span> <span class="o">=</span> <span class="p">({</span>
                    <span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;FA+Glycerol-OH&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;FA-OH&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;FA-H2O-OH&#39;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">},)</span>
            <span class="p">):</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span></div></div>

<span class="c1">#</span>
<span class="c1"># Vitamins</span>
<span class="c1">#</span>

<div class="viewcode-block" id="VA_Positive"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.VA_Positive">[docs]</a><span class="k">class</span> <span class="nc">VA_Positive</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a positive MS2 spectrum is vitamin A (retinol).</span>

<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - in vivo RBP1 + 269.2245</span>
<span class="sd">    - in vivo RBP4 + 269.2245</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - The most abundant ion is the whole molecule m/z = 269.224.</span>
<span class="sd">    - Presence off 3 other ions adds to the score but not</span>
<span class="sd">      mandatory: 213.165, 145.1027, 157.1028.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="n">must_have_chains</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="VA_Positive.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.VA_Positive.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">8</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">fragment_among_most_abundant</span><span class="p">(</span><span class="s1">&#39;Retinol I (269.2264)&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;Retinol II (213.1637)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;Retinol III (157.1012)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;Retinol IV (145.1012)&#39;</span><span class="p">),</span>
            <span class="p">)))</span></div></div>


<div class="viewcode-block" id="VA_Negative"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.VA_Negative">[docs]</a><span class="k">class</span> <span class="nc">VA_Negative</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a positive MS2 spectrum is vitamin A (retinol).</span>

<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - Standards 141020 negative scan 673</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - 3 fragments seems to always present and be among the most abundant:</span>
<span class="sd">      79.055, 119.087 and 255.212; presence of these is the main condition.</span>
<span class="sd">    - We also detected 125.061 in our standards which is special because</span>
<span class="sd">      contains 2 oxygens; presence of this increase the score.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="n">must_have_chains</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="VA_Negative.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.VA_Negative.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">=</span> <span class="mi">8</span>
        
        <span class="k">if</span> <span class="nb">all</span><span class="p">((</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">fragment_among_most_abundant</span><span class="p">(</span><span class="n">fragname</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">fragname</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="s1">&#39;Retinoic acid I (79.0553)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Retinoic acid II (119.0866)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Retinoic acid IV (255.2118)&#39;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;Retinoic acid III (125.0608)&#39;</span><span class="p">):</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">3</span></div></div>

<span class="c1">#</span>
<span class="c1"># Sphingolipids</span>
<span class="c1">#</span>

<div class="viewcode-block" id="Cer_Positive"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive">[docs]</a><span class="k">class</span> <span class="nc">Cer_Positive</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a positive mode MS2 spectrum is a ceramide.</span>
<span class="sd">    Identifies ceramide varieties including sphingomyeline,</span>
<span class="sd">    ceramide-1-phosphare, ceramide-phosphoethanolamine,</span>
<span class="sd">    OH-acyl-ceramide, hexosyl and dihexosyl-ceramides,</span>
<span class="sd">    and d, t and DH long chain base varieties.</span>
<span class="sd">    </span>
<span class="sd">    dCer</span>
<span class="sd">    ====</span>
<span class="sd">    </span>
<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - Sphingolipid standards scans </span>
<span class="sd">    - SEC14L1 + 538.52</span>
<span class="sd">    - STARD11 + 538.526</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - A sphingosine backbone with two H2O loss must be among the</span>
<span class="sd">      10 most abundant fragments.</span>
<span class="sd">    - Fatty acid [M+H]+ or [M-O]+ fragments or neutral losses</span>
<span class="sd">      complementing the one above increase the score.</span>
<span class="sd">    - Sphingosine backbone fragments with same carbon count and</span>
<span class="sd">      unsaturation with the one with 2 water loss but [Sph-C-2(H2O)]+</span>
<span class="sd">      or [Sph-H2O]+ add to the score.</span>
<span class="sd">    - The score increases if the following choline fragments</span>
<span class="sd">      can not be found: 58.0651, 104.1070, 124.9998 and 184.0733.</span>
<span class="sd">    - The presence of the following fragments increase the score:</span>
<span class="sd">      60.0444, 70.0651, 82.0651, 96.0808, 107.0730, 121.0886,</span>
<span class="sd">      135.1042 and 149.1199.</span>
<span class="sd">    </span>
<span class="sd">    DHCer</span>
<span class="sd">    =====</span>
<span class="sd">    </span>
<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - Standards 180626 m/z 568.56 scan 2367</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - Same pattern as at dCer but from the sphingosine derived fragments</span>
<span class="sd">      it becomes clear if it has no unsaturation.</span>
<span class="sd">    </span>
<span class="sd">    tCer</span>
<span class="sd">    ====</span>
<span class="sd">    </span>
<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - Standards 180628 m/z 584.56 scan 2070</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - Has Sph+H2O-H fragment which does not occur at dCer.</span>
<span class="sd">    - Sph-H2O-H and Sph-H are much higher abundant than at dCer.</span>
<span class="sd">    - Strong fragment at 60.044 which is missing at dCer.</span>
<span class="sd">    - H2O and 2xH2O neutral losses are much higher than at dCer.</span>
<span class="sd">    </span>
<span class="sd">    dCer-2OH-acyl</span>
<span class="sd">    =============</span>
<span class="sd">    </span>
<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - Standards 180615 m/z 584.22 scan 2421</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - Same as other ceramides. It&#39;s d and DH forms are isobaric with tCer</span>
<span class="sd">      but d and t are clearly distinguishable so this does not cause</span>
<span class="sd">      confusion.</span>
<span class="sd">    </span>
<span class="sd">    dCer-1-P</span>
<span class="sd">    ========</span>
<span class="sd">    </span>
<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - in vivo GLTPD1 + 728.59</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - A shpingosine backbone with 2 H2O loss must be among the 3 highest</span>
<span class="sd">      intensity fragments.</span>
<span class="sd">    - Presence of any of the following fragments increases the score:</span>
<span class="sd">      82.0651, 115.9875.</span>
<span class="sd">      107.0729, 135.1043, 149.1199.</span>
<span class="sd">    </span>
<span class="sd">    Hex-dCer</span>
<span class="sd">    ========</span>
<span class="sd">    </span>
<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - in vivo GLTP + 810.68</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - Hexose fragments 198.0740, 180.0634 and 162.0528 must present.</span>
<span class="sd">      These are neutral losses of hexose, hexose-H2O and hexose+H2O</span>
<span class="sd">    </span>
<span class="sd">    Hex-tCer</span>
<span class="sd">    ========</span>
<span class="sd">    </span>
<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - in vivo GLTP + 826.67</span>
<span class="sd">    - in vitro GLTP + 826.67, 800.66,</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - Hexose fragments 198.0740, 180.0634 and 162.0528 must present.</span>
<span class="sd">      These are neutral losses of hexose, hexose-H2O and hexose+H2O</span>
<span class="sd">    </span>
<span class="sd">    Hex2-dCer</span>
<span class="sd">    =========</span>
<span class="sd">    </span>
<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - in vivo GLTP + 988.73</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - Loss of double hexose with our without extra water or water loss</span>
<span class="sd">      are the characteristic fragments of this class.</span>
<span class="sd">    </span>
<span class="sd">    SHex-dCer</span>
<span class="sd">    =========</span>
<span class="sd">    </span>
<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - in vitro 890.64</span>
<span class="sd">    </span>
<span class="sd">    dSM</span>
<span class="sd">    ===</span>
<span class="sd">    </span>
<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - in vivo GLTPD1 + 703.57</span>
<span class="sd">    - in vitro GLTPD1 + 813.68</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - The following choline fragments must be present: 60.0808, 86.0964,</span>
<span class="sd">      104.1069, 124.9998 and 184.0733. The last one is the most intensive.</span>
<span class="sd">    - If 58.0651 can be found it adds to the score.</span>
<span class="sd">    </span>
<span class="sd">    PE-Cer</span>
<span class="sd">    ======</span>
<span class="sd">    </span>
<span class="sd">    We do not have this in standards or in screens so we can not test this.</span>
<span class="sd">    Based on Amiar 2016 and Narayanaswamy 2014.</span>
<span class="sd">    </span>
<span class="sd">    **Principle:**</span>
<span class="sd">    </span>
<span class="sd">    - Neutral loss of 141.0191 must be present.</span>
<span class="sd">    - 142.0264 phospho-ethanolamine fragment and neutral loss of</span>
<span class="sd">      phospho-ethanolamine+water might be present.</span>
<span class="sd">    - Sph-2xH2O fragment increases the score.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">class_methods</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;SM&#39;</span><span class="p">:</span> <span class="s1">&#39;sm&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Sph&#39;</span><span class="p">:</span> <span class="s1">&#39;sph&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    
    <span class="n">subclass_methods</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;1P&#39;</span><span class="p">:</span> <span class="s1">&#39;cer1p&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Hex&#39;</span><span class="p">:</span> <span class="s1">&#39;hexcer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Hex2&#39;</span><span class="p">:</span> <span class="s1">&#39;hex2cer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;SHex&#39;</span><span class="p">:</span> <span class="s1">&#39;shexcer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;SHex2&#39;</span><span class="p">:</span> <span class="s1">&#39;shex2cer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PE&#39;</span><span class="p">:</span> <span class="s1">&#39;pe_cer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;M2&#39;</span><span class="p">:</span> <span class="s1">&#39;m2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;M1&#39;</span><span class="p">:</span> <span class="s1">&#39;m1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;M3&#39;</span><span class="p">:</span> <span class="s1">&#39;m3&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PC&#39;</span><span class="p">:</span> <span class="s1">&#39;pc&#39;</span><span class="p">,</span>
        <span class="s1">&#39;empty&#39;</span><span class="p">:</span> <span class="s1">&#39;cer&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">nacyl</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">chainsum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">chainsum</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oacyl</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">chainsum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">chainsum</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nacyl</span> <span class="k">else</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="n">must_have_chains</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sph_scores</span>     <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sph_max_scores</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fa_scores</span>      <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fa_max_scores</span>  <span class="o">=</span> <span class="p">{}</span>
    
<div class="viewcode-block" id="Cer_Positive.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="n">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">+=</span> <span class="mi">2</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="s1">&#39;NL [H2O] (NL 18.0106)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;NL [2xH2O] (NL 36.0211)&#39;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">confirm_subclass</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="Cer_Positive.confirm_chains_explicit"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.confirm_chains_explicit">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_chains_explicit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Most of the time we don&#39;t really have fatty acid derived</span>
<span class="sd">        fragments from ceramides in positive mode. However certain</span>
<span class="sd">        sphingosin base derived fragments correspond to neutral losses</span>
<span class="sd">        of fatty acids as the molecule is composed of a sphingosine</span>
<span class="sd">        and a fatty acid but this is redundant. Hence we call both</span>
<span class="sd">        explicit and implicit identification as practically the it</span>
<span class="sd">        is implicit anyways.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">for</span> <span class="n">chains</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
            <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="n">confirm_chains_explicit</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
            <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="n">confirm_chains_implicit</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
        <span class="p">):</span>
            
            <span class="k">if</span> <span class="n">chains</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">sph</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="o">.</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sph</span><span class="p">:</span>
                
                <span class="c1"># the sphingosin base and fatty acyl related part of the</span>
                <span class="c1"># score is valid only for the current chain combination</span>
                <span class="c1"># hence now we add these to the overall score, yield the</span>
                <span class="c1"># identification and then subtract them from the score</span>
                <span class="n">sph_score</span><span class="p">,</span> <span class="n">sph_max_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphingosine_base</span><span class="p">(</span>
                    <span class="n">chains</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">sph</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="n">sph_score</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">+=</span> <span class="n">sph_max_score</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nacyl</span><span class="p">:</span>
                    
                    <span class="n">fa_score</span><span class="p">,</span> <span class="n">fa_max_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fatty_acyl</span><span class="p">(</span><span class="n">chains</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="n">fa_score</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">+=</span> <span class="n">fa_max_score</span>
                
                <span class="k">yield</span> <span class="n">chains</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">-=</span> <span class="n">sph_score</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">-=</span> <span class="n">sph_max_score</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nacyl</span><span class="p">:</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">-=</span> <span class="n">fa_score</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">-=</span> <span class="n">fa_max_score</span></div>
    
<div class="viewcode-block" id="Cer_Positive.fatty_acyl"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.fatty_acyl">[docs]</a>    <span class="k">def</span> <span class="nf">fatty_acyl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fa</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">if</span> <span class="n">fa</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">oh</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span> <span class="o">==</span> <span class="s1">&#39;[M-H2O+H]+&#39;</span><span class="p">:</span>
                
                <span class="n">score</span> <span class="o">-=</span> <span class="mi">20</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Positive.cer"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.cer">[docs]</a>    <span class="k">def</span> <span class="nf">cer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="n">non_hex_score</span><span class="p">,</span> <span class="n">non_hex_max_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_hex</span><span class="p">()</span>
        
        <span class="n">score</span> <span class="o">+=</span> <span class="n">non_hex_score</span>
        <span class="n">max_score</span> <span class="o">+=</span> <span class="n">non_hex_max_score</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Positive.non_hex"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.non_hex">[docs]</a>    <span class="k">def</span> <span class="nf">non_hex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="n">score</span> <span class="o">-=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [Hexose-H2O] (NL 162.05)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [Hexose] (NL 180.06)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [Hexose+H2O] (NL 198.07)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [2xHexose] (NL 342.1162)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [2xHexose+H2O] (NL 360.1268)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [2xHexose-H2O] (NL 324.1056)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [2xHexose+O] (NL 358.1111)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [2xHexose+C] (NL 372.1268)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [S] (NL 79.9568)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [S+H2O] (97.9674)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [Hexose+SO3] (NL 242.100)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [Hexose+SO3+H2O] (NL 260.0202)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [Hexose+SO3+2xH2O] (NL 278.0308)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [2xHexose+SO3] (NL 404.0625)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [2xHexose+SO3+H2O] (NL 422.0730)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [2xHexose+SO3+2xH2O] (NL 440.0836)&#39;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">))</span> <span class="o">*</span> <span class="mi">5</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Positive.sm"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.sm">[docs]</a>    <span class="k">def</span> <span class="nf">sm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">47</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">most_abundant_fragment_is</span><span class="p">(</span><span class="s1">&#39;PC/SM [P+Ch] (184.0733)&#39;</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">15</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PC/SM [N+3xCH3] (60.0808)&#39;</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PC/SM [Ch] (86.096)&#39;</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PC/SM [Ch+H2O] (104.107)&#39;</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PC/SM [P+Et] (124.9998)&#39;</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PC/SM [Ch-Et] (58.0651)&#39;</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL PC/SM [P+Ch] (NL 183.066)&#39;</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL SM [P+Ch] (NL 201.0766)&#39;</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL SM [N+3xCH3] (77.0841)&#39;</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [H2O] (NL 18.0106)&#39;</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">))</span> <span class="o">*</span> <span class="mi">3</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_fragment_type</span><span class="p">(</span><span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-2xH2O+H&#39;</span><span class="p">):</span>
                
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">must_have_chains</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Positive.pc"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.pc">[docs]</a>    <span class="k">def</span> <span class="nf">pc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scherer 2010, Table 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">15</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">most_abundant_fragment_is</span><span class="p">(</span><span class="s1">&#39;PC/SM [P+Ch] (184.0733)&#39;</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">15</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Positive.pe_cer"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.pe_cer">[docs]</a>    <span class="k">def</span> <span class="nf">pe_cer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">30</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL PE [P+E] (NL 141.0191)&#39;</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">15</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PE [P+E] (142.0264)&#39;</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL PE [P+E+H2O] (NL 159.0297)&#39;</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL PE [P+E-H2O] (NL 123.0085)&#39;</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">))</span> <span class="o">*</span> <span class="mi">5</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Positive.cer1p"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.cer1p">[docs]</a>    <span class="k">def</span> <span class="nf">cer1p</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">31</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [P+H2O] (NL 115.9875)&#39;</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_among_most_abundant</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-2xH2O-H&#39;</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combination</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span>
            <span class="n">chain_param</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;Sph-2xH2O+H&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;Sph-H2O+H&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;Sph-H2O-H&#39;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="p">{</span><span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="s1">&#39;FA+NH+C2H2-OH&#39;</span><span class="p">},</span>
            <span class="p">)</span>
        <span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
        
        <span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [P] (NL 79.9663)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [P] (NL 97.9769)&#39;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">))</span> <span class="o">*</span> <span class="mi">3</span>
        
        <span class="n">non_hex_score</span><span class="p">,</span> <span class="n">non_hex_max_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_hex</span><span class="p">()</span>
        
        <span class="n">score</span> <span class="o">+=</span> <span class="n">non_hex_score</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Positive.hexcer"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.hexcer">[docs]</a>    <span class="k">def</span> <span class="nf">hexcer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">14</span>
        
        <span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [Hexose-H2O] (NL 162.05)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [Hexose] (NL 180.06)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [Hexose+H2O] (NL 198.07)&#39;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">))</span> <span class="o">*</span> <span class="mi">3</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hexcer_chain_combination</span><span class="p">():</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Positive.hex2cer"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.hex2cer">[docs]</a>    <span class="k">def</span> <span class="nf">hex2cer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">39</span>
        
        <span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [2xHexose] (NL 342.1162)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [2xHexose+H2O] (NL 360.1268)&#39;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">))</span> <span class="o">*</span> <span class="mi">10</span>
        
        <span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [2xHexose-H2O] (NL 324.1056)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [2xHexose+O] (NL 358.1111)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [2xHexose+C] (NL 372.1268)&#39;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">))</span> <span class="o">*</span> <span class="mi">3</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hexcer_chain_combination</span><span class="p">():</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Positive.hexcer_chain_combination"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.hexcer_chain_combination">[docs]</a>    <span class="k">def</span> <span class="nf">hexcer_chain_combination</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combination</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span>
            <span class="n">chain_param</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;Sph-2xH2O+H&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;Sph-2xH2O-H&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;Sph-H2O+H&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;Sph-H2O-H&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;Sph-C-2xH2O&#39;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="p">{</span><span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;FA-OH&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;NL FA&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;FA+NH2-O&#39;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">},</span>
            <span class="p">)</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="Cer_Positive.shexcer"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.shexcer">[docs]</a>    <span class="k">def</span> <span class="nf">shexcer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">25</span>
        
        <span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [S] (NL 79.9568)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [S+H2O] (97.9674)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [Hexose+SO3] (NL 242.100)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [Hexose+SO3+H2O] (NL 260.0202)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [Hexose+SO3+2xH2O] (NL 278.0308)&#39;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">))</span> <span class="o">*</span> <span class="mi">5</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Positive.shex2cer"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.shex2cer">[docs]</a>    <span class="k">def</span> <span class="nf">shex2cer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">25</span>
        
        <span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [S] (NL 79.9568)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [S+H2O] (97.9674)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [2xHexose+SO3] (NL 404.0625)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [2xHexose+SO3+H2O] (NL 422.0730)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [2xHexose+SO3+2xH2O] (NL 440.0836)&#39;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">))</span> <span class="o">*</span> <span class="mi">5</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Positive.m2"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.m2">[docs]</a>    <span class="k">def</span> <span class="nf">m2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">46</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PC/SM [Ch-Et] (58.0651)&#39;</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="o">.</span><span class="n">u</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[C7+NH2] (110.0964)&#39;</span><span class="p">)</span>
        <span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span>
        
        <span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[C5+NH2+2H] (84.0808)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[C6+NH2] (96.0808)&#39;</span><span class="p">),</span>
        <span class="p">)))</span> <span class="o">*</span> <span class="mi">3</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combination</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span>
                <span class="n">chain_param</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;Sph-2xH2O+CH3&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;Sph-O-H2O+CH3+H&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;Sph-2xH2O+2xCh3+H&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;Sph-H2O+2xCH3+H&#39;</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                <span class="p">)</span>
            <span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">20</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Positive.m1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.m1">[docs]</a>    <span class="k">def</span> <span class="nf">m1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">30</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PC/SM [Ch-Et] (58.0651)&#39;</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combination</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span>
                <span class="n">head</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                <span class="n">chain_param</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;Sph-2xH2O+CH3&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;Sph-O-H2O+CH3+H&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;Sph-H2O+CH3+H&#39;</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                <span class="p">)</span>
            <span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">20</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_fragment_type</span><span class="p">(</span>
                <span class="n">frag_type</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Sph-2xH2O+2xCH3+H&#39;</span><span class="p">,</span> <span class="s1">&#39;Sph-H2O+2xCH3+H&#39;</span><span class="p">},</span>
                <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="o">.</span><span class="n">u</span><span class="p">,</span>
            <span class="p">):</span>
            
            <span class="n">score</span> <span class="o">-=</span> <span class="mi">20</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Positive.m3"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.m3">[docs]</a>    <span class="k">def</span> <span class="nf">m3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">20</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">fragment_among_most_abundant</span><span class="p">(</span>
            <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;PC/SM [N+3xCH3] (60.0808)&#39;</span>
        <span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">20</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Positive.sph"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.sph">[docs]</a>    <span class="k">def</span> <span class="nf">sph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">9</span>
        
        <span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[C3+NH2] (56.0495)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[C2+NH2+O] (60.0444)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[C4+NH2+OH] (86.0600)&#39;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">))</span> <span class="o">*</span> <span class="mi">3</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Positive.sphingosine_base"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.sphingosine_base">[docs]</a>    <span class="k">def</span> <span class="nf">sphingosine_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sph</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">sph</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sph_scores</span><span class="p">:</span>
            
            <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;sphingosine_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sph</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">sph_scores</span><span class="p">[</span><span class="n">sph</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sph_max_scores</span><span class="p">[</span><span class="n">sph</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">)()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sph_scores</span><span class="p">[</span><span class="n">sph</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sph_max_scores</span><span class="p">[</span><span class="n">sph</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="Cer_Positive.sphingosine_d"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.sphingosine_d">[docs]</a>    <span class="k">def</span> <span class="nf">sphingosine_d</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">15</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="o">.</span><span class="n">u</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            
            <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nacyl</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_fragment_type_is</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-2xH2O+H&#39;</span><span class="p">,</span>
                <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">}),</span>
            <span class="p">)</span>
        <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nacyl</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_fragment_type_is</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-H2O+H&#39;</span><span class="p">,</span>
                <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">}),</span>
            <span class="p">)</span>
        <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">hg</span><span class="o">.</span><span class="n">main</span> <span class="o">==</span> <span class="s1">&#39;SM&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_among_most_abundant</span><span class="p">(</span>
                <span class="mi">5</span><span class="p">,</span>
                <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-2xH2O+H&#39;</span><span class="p">,</span>
                <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">}),</span>
                <span class="n">skip_non_chains</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[C2+NH2+O] (60.0444)&#39;</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [C+2xH2O] (NL 48.0211)&#39;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">))</span>
            
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_fragment_type_among_most_abundant</span><span class="p">(</span>
                    <span class="mi">4</span><span class="p">,</span> <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-H2O+H&#39;</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">})</span>
                <span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_fragment_type_among_most_abundant</span><span class="p">(</span>
                    <span class="mi">4</span><span class="p">,</span> <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-C-O-H2O-H&#39;</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">})</span>
                <span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_fragment_type_among_most_abundant</span><span class="p">(</span>
                    <span class="mi">4</span><span class="p">,</span> <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-2xH2O+H&#39;</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">})</span>
                <span class="p">)</span>
            <span class="p">):</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Positive.sphingosine_dh"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.sphingosine_dh">[docs]</a>    <span class="k">def</span> <span class="nf">sphingosine_dh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">20</span>
        
        <span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[C2+NH2+O] (60.0444)&#39;</span><span class="p">),</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [C+2xH2O] (NL 48.0211)&#39;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">))</span>
        
        <span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_fragment_type_among_most_abundant</span><span class="p">(</span>
                    <span class="mi">5</span><span class="p">,</span> <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-H2O+H&#39;</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_fragment_type_among_most_abundant</span><span class="p">(</span>
                    <span class="mi">5</span><span class="p">,</span> <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;FA+NH2-O&#39;</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_fragment_type_among_most_abundant</span><span class="p">(</span>
                    <span class="mi">10</span><span class="p">,</span> <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-2xH2O+H&#39;</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_fragment_type</span><span class="p">(</span>
                    <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-C-O-H2O-H&#39;</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_fragment_type</span><span class="p">(</span>
                    <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph+H&#39;</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_fragment_type</span><span class="p">(</span>
                    <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-C-O-H2O-NH&#39;</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">))</span> <span class="o">*</span> <span class="mi">3</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Positive.sphingosine_t"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.sphingosine_t">[docs]</a>    <span class="k">def</span> <span class="nf">sphingosine_t</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">23</span>
        
        <span class="k">if</span> <span class="nb">all</span><span class="p">((</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_fragment_type_among_most_abundant</span><span class="p">(</span>
                <span class="mi">5</span><span class="p">,</span> <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-H2O-H&#39;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_fragment_type_among_most_abundant</span><span class="p">(</span>
                <span class="mi">10</span><span class="p">,</span> <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-2xH2O-H&#39;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">fragment_among_most_abundant</span><span class="p">(</span>
                    <span class="s1">&#39;[C2+NH2+O] (60.0444)&#39;</span>
                <span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">hg</span><span class="o">.</span><span class="n">sub</span>
            <span class="p">)</span>
        <span class="p">)):</span>
            
            <span class="n">score</span> <span class="o">=</span> <span class="mi">12</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [C+2xH2O] (NL 48.0211)&#39;</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL [3xH2O] (NL 54.0317)&#39;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">))</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_fragment_type</span><span class="p">(</span>
                        <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-C-2xH2O&#39;</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_fragment_type</span><span class="p">(</span>
                        <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph+H2O-H&#39;</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_fragment_type_among_most_abundant</span><span class="p">(</span>
                        <span class="mi">5</span><span class="p">,</span> <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-H&#39;</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">)</span>
            <span class="p">))</span> <span class="o">*</span> <span class="mi">3</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Positive.sphingosine_k"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Positive.sphingosine_k">[docs]</a>    <span class="k">def</span> <span class="nf">sphingosine_k</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">39</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_fragment_type</span><span class="p">(</span><span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-NH2-H2O-2H&#39;</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">15</span>
        
        <span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[C2+NH2+O] (60.0444)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[C4+NH2+OH] (86.0600)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[C6+OH] (99.0804)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[C3+NH2] (56.0495)&#39;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">))</span> <span class="o">*</span> <span class="mi">3</span>
        
        <span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_fragment_type</span><span class="p">(</span>
                    <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-C-2xH2O&#39;</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_fragment_type</span><span class="p">(</span>
                    <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-H2O-H&#39;</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_fragment_type</span><span class="p">(</span>
                    <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-H&#39;</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_fragment_type_among_most_abundant</span><span class="p">(</span>
                    <span class="mi">5</span><span class="p">,</span> <span class="n">frag_type</span> <span class="o">=</span> <span class="s1">&#39;Sph-H&#39;</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="p">))</span> <span class="o">*</span> <span class="mi">3</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div></div>


<div class="viewcode-block" id="Cer_Negative"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Negative">[docs]</a><span class="k">class</span> <span class="nc">Cer_Negative</span><span class="p">(</span><span class="n">AbstractMS2Identifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examines if a positive mode MS2 spectrum is a ceramide.</span>
<span class="sd">    Identifies ceramide varieties including sphingomyeline,</span>
<span class="sd">    ceramide-1-phosphare, ceramide-phosphoethanolamine,</span>
<span class="sd">    OH-acyl-ceramide, hexosyl and dihexosyl-ceramides,</span>
<span class="sd">    and d, t and DH long chain base varieties.</span>
<span class="sd">    </span>
<span class="sd">    dCer</span>
<span class="sd">    ====</span>
<span class="sd">    </span>
<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - in vivo SEC14L1 583, 554, 580 (formiate adduct)</span>
<span class="sd">    - in vivo STARD11 583, 554 (formiate adduct)</span>
<span class="sd">    - standards</span>
<span class="sd">    </span>
<span class="sd">    DHCer</span>
<span class="sd">    =====</span>
<span class="sd">    </span>
<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - standards</span>
<span class="sd">    </span>
<span class="sd">    tCer</span>
<span class="sd">    ====</span>
<span class="sd">    </span>
<span class="sd">    **Specimen:**</span>
<span class="sd">    </span>
<span class="sd">    - standards</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">class_methods</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Cer&#39;</span><span class="p">:</span> <span class="s1">&#39;cer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;SM&#39;</span><span class="p">:</span>  <span class="s1">&#39;sm&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    
    <span class="n">subclass_methods</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;1P&#39;</span><span class="p">:</span> <span class="s1">&#39;cer1p&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Hex&#39;</span><span class="p">:</span> <span class="s1">&#39;hexcer&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">nacyl</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">chainsum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">chainsum</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oacyl</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">chainsum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">chainsum</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">chain_comb_args</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="n">must_have_chains</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sph_scores</span>     <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fa_scores</span>      <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sph_max_scores</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fa_max_scores</span>  <span class="o">=</span> <span class="p">{}</span>
    
<div class="viewcode-block" id="Cer_Negative.confirm_class"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Negative.confirm_class">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="n">confirm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">confirm_subclass</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="Cer_Negative.confirm_chains_explicit"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Negative.confirm_chains_explicit">[docs]</a>    <span class="k">def</span> <span class="nf">confirm_chains_explicit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">for</span> <span class="n">chains</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
            <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="n">confirm_chains_explicit</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
            <span class="n">AbstractMS2Identifier</span><span class="o">.</span><span class="n">confirm_chains_implicit</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
        <span class="p">):</span>
            
            <span class="k">if</span> <span class="n">chains</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">sph</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">chainsum</span><span class="o">.</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sph</span><span class="p">:</span>
                
                <span class="c1"># the sphingosin base and fatty acyl related part of the</span>
                <span class="c1"># score is valid only for the current chain combination</span>
                <span class="c1"># hence now we add these to the overall score, yield the</span>
                <span class="c1"># identification and then subtract them from the score</span>
                <span class="n">sph_score</span><span class="p">,</span> <span class="n">sph_max_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphingosine_base</span><span class="p">(</span>
                    <span class="n">chains</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">sph</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="n">sph_score</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">+=</span> <span class="n">sph_max_score</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nacyl</span><span class="p">:</span>
                    
                    <span class="n">fa_score</span><span class="p">,</span> <span class="n">fa_max_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fatty_acyl</span><span class="p">(</span><span class="n">chains</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="n">fa_score</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">+=</span> <span class="n">fa_max_score</span>
                
                <span class="k">yield</span> <span class="n">chains</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">-=</span> <span class="n">sph_score</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">-=</span> <span class="n">sph_max_score</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nacyl</span><span class="p">:</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">-=</span> <span class="n">fa_score</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">-=</span> <span class="n">fa_max_score</span></div>
    
<div class="viewcode-block" id="Cer_Negative.fatty_acyl"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Negative.fatty_acyl">[docs]</a>    <span class="k">def</span> <span class="nf">fatty_acyl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fa</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fa</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">oh</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            
            <span class="n">max_score</span> <span class="o">=</span> <span class="mi">30</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combination</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span>
                <span class="n">head</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="c1"># to exclude tCer</span>
                <span class="n">chain_param</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;Sph-H&#39;</span><span class="p">,</span> <span class="c1"># b1</span>
                            <span class="s1">&#39;Sph-C2H4-NH2-H2O&#39;</span><span class="p">,</span> <span class="c1"># b5</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;FA+C2+NH2+O&#39;</span><span class="p">,</span>  <span class="c1"># a5 @ hydroxyacyl</span>
                            <span class="s1">&#39;FA+CH2+NH2+O&#39;</span><span class="p">,</span> <span class="c1"># a1 @ hydroxyacyl</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="p">):</span>
                
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">30</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Negative.cer"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Negative.cer">[docs]</a>    <span class="k">def</span> <span class="nf">cer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">23</span>
        
        <span class="n">cer_nl</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">&#39;NL H2O (NL 18.0106)&#39;</span><span class="p">,</span> <span class="c1"># Hsu c1</span>
            <span class="s1">&#39;NL 2xH2O (NL 36.0211)&#39;</span><span class="p">,</span> <span class="c1"># Hsu c4</span>
            <span class="s1">&#39;NL C+H2O (NL 30.0106)&#39;</span><span class="p">,</span> <span class="c1"># Hsu c2</span>
            <span class="s1">&#39;NL CH2+H2O (NL 32.0262)&#39;</span><span class="p">,</span> <span class="c1"># Hsu c3</span>
            <span class="s1">&#39;NL C+2xH2O (NL 48.0211)&#39;</span><span class="p">,</span> <span class="c1"># Hsu c5</span>
            <span class="s1">&#39;NL C+3xH2O (66.0455)&#39;</span><span class="p">,</span> <span class="c1"># Hsu c6</span>
        <span class="p">)</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="n">frag_name</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">frag_name</span> <span class="ow">in</span> <span class="n">cer_nl</span>
        <span class="p">)</span> <span class="o">*</span> <span class="mi">3</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Negative.sphingosine_base"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Negative.sphingosine_base">[docs]</a>    <span class="k">def</span> <span class="nf">sphingosine_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sph</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">sph</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sph_scores</span><span class="p">:</span>
            
            <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;sphingosine_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sph</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">sph_scores</span><span class="p">[</span><span class="n">sph</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sph_max_scores</span><span class="p">[</span><span class="n">sph</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">)()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sph_scores</span><span class="p">[</span><span class="n">sph</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sph_max_scores</span><span class="p">[</span><span class="n">sph</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="Cer_Negative.sphingosine_d_dh"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Negative.sphingosine_d_dh">[docs]</a>    <span class="k">def</span> <span class="nf">sphingosine_d_dh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">20</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combination</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span>
            <span class="n">chain_param</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">{</span>
                    <span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;Sph-H&#39;</span><span class="p">,</span> <span class="c1"># b1</span>
                        <span class="s1">&#39;Sph-C2H4-3H&#39;</span><span class="p">,</span> <span class="c1"># b2</span>
                        <span class="s1">&#39;Sph-CH2-H2O-H&#39;</span><span class="p">,</span> <span class="c1"># b3</span>
                        <span class="s1">&#39;Sph-H2O-NH2-2H&#39;</span><span class="p">,</span> <span class="c1"># b4</span>
                        <span class="s1">&#39;Sph-C2H4-NH2-H2O&#39;</span><span class="p">,</span> <span class="c1"># b5</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;FA+C2+NH2&#39;</span><span class="p">,</span> <span class="c1"># a2</span>
                        <span class="s1">&#39;FA+C2+NH2-O&#39;</span><span class="p">,</span> <span class="c1"># a3</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">20</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Negative.sphingosine_d"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Negative.sphingosine_d">[docs]</a>    <span class="k">def</span> <span class="nf">sphingosine_d</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">20</span>
        
        <span class="n">d_dh_score</span><span class="p">,</span> <span class="n">d_dh_max_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphingosine_d_dh</span><span class="p">()</span>
        
        <span class="n">score</span> <span class="o">+=</span> <span class="n">d_dh_score</span>
        <span class="n">max_score</span> <span class="o">+=</span> <span class="n">d_dh_max_score</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL C+H2O (NL 30.0106)&#39;</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">20</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Negative.sphingosine_dh"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Negative.sphingosine_dh">[docs]</a>    <span class="k">def</span> <span class="nf">sphingosine_dh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span>
        
        <span class="n">d_dh_score</span><span class="p">,</span> <span class="n">d_dh_max_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphingosine_d_dh</span><span class="p">()</span>
        
        <span class="n">score</span> <span class="o">+=</span> <span class="n">d_dh_score</span>
        <span class="n">max_score</span> <span class="o">+=</span> <span class="n">d_dh_max_score</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL C+H2O (NL 30.0106)&#39;</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">-=</span> <span class="mi">20</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Negative.sphingosine_t"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Negative.sphingosine_t">[docs]</a>    <span class="k">def</span> <span class="nf">sphingosine_t</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">28</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL C+3xH2O (66.0455)&#39;</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;HexCer identity II&#39;</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">3</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combination</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span>
            <span class="n">chain_param</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">{</span>
                    <span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;Sph-CH2-NH2-4H&#39;</span><span class="p">,</span> <span class="c1"># b6</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;FA+C2H2+NH2&#39;</span><span class="p">,</span> <span class="c1"># a1</span>
                        <span class="s1">&#39;FA+C3H2+NH2&#39;</span><span class="p">,</span> <span class="c1"># a10</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">20</span>
        
        <span class="c1"># differentiate from hydroxyacyl-dCer</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">chain_percent_of_most_abundant</span><span class="p">(</span>
            <span class="n">frag_type</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;FA+C2H2+NH2+O&#39;</span><span class="p">,</span> <span class="s1">&#39;FA+C2+NH2+O&#39;</span><span class="p">},</span>
            <span class="n">percent</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
        <span class="p">):</span>
            
            <span class="n">score</span> <span class="o">-=</span> <span class="mi">10</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Negative.cer1p"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Negative.cer1p">[docs]</a>    <span class="k">def</span> <span class="nf">cer1p</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">70</span>
        
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;Cer1P/PIP/PL metaphosphate (78.9591)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;Cer1P/PI phosphate (96.9696)&#39;</span><span class="p">),</span>
        <span class="p">))):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">20</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span>
                <span class="s1">&#39;NL H2O (NL 18.0106)&#39;</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span>
            <span class="p">):</span>
                
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_fragment_type</span><span class="p">(</span>
                <span class="n">frag_type</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;NLFA_pH2O&#39;</span><span class="p">,</span> <span class="s1">&#39;NLFA_p2xH2O&#39;</span><span class="p">},</span>
                <span class="n">adduct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span>
            <span class="p">):</span>
                
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">must_have_chains</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">hg</span><span class="o">.</span><span class="n">main</span> <span class="o">==</span> <span class="s1">&#39;Sph&#39;</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">fragment_among_most_abundant</span><span class="p">(</span>
                <span class="s1">&#39;Cer1P/PIP/PL metaphosphate (78.9591)&#39;</span><span class="p">,</span> <span class="mi">3</span>
            <span class="p">)</span>
        <span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">20</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">must_have_chains</span> <span class="o">=</span> <span class="kc">False</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;Cer1P/PI phosphate (96.9696)&#39;</span><span class="p">):</span>
                
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Negative.sm"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Negative.sm">[docs]</a>    <span class="k">def</span> <span class="nf">sm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">45</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">fragment_among_most_abundant</span><span class="p">(</span>
            <span class="s1">&#39;NL CH2 (NL 14.0157)&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">fragment_among_most_abundant</span><span class="p">(</span>
            <span class="s1">&#39;PC/SM PO4+choline-CH3 (168.0431)&#39;</span><span class="p">,</span> <span class="mi">5</span>
        <span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">30</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span>
                    <span class="s1">&#39;Cer1P/PIP/PL metaphosphate (78.9591)&#39;</span>
                <span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span>
                    <span class="s1">&#39;NL choline+H2O&#39;</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span>
                <span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span>
                    <span class="s1">&#39;NL choline+H2O-CH3&#39;</span><span class="p">,</span> <span class="n">adduct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span>
                <span class="p">),</span>
            <span class="p">)))</span> <span class="o">*</span> <span class="mi">5</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">must_have_chains</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Negative.hexcer"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Negative.hexcer">[docs]</a>    <span class="k">def</span> <span class="nf">hexcer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">90</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">fragment_among_most_abundant</span><span class="p">(</span><span class="s1">&#39;HexCer identity I&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">fragment_among_most_abundant</span><span class="p">(</span><span class="s1">&#39;HexCer identity II&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">fragment_among_most_abundant</span><span class="p">(</span><span class="s1">&#39;HexCer identity III&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[Hexose] (179.0561)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[Hexose-H2O] (161.0455)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[Hexose-HCHO] (149.0455)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL hexose (162.053)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL hexose+H2O (180.063)&#39;</span><span class="p">),</span>
        <span class="p">)))</span> <span class="o">*</span> <span class="mi">10</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Negative.hex2cer"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Negative.hex2cer">[docs]</a>    <span class="k">def</span> <span class="nf">hex2cer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">140</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;HexCer identity I&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;HexCer identity II&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;HexCer identity III&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[Hexose] (179.0561)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[Hexose-H2O] (161.0455)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[Hexose-HCHO] (149.0455)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL hexose (162.053)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL hexose+H2O (180.063)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[2xHexose-HCHO] (311.0984)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[2xHexose-H2O] (323.0984)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[2xHexose] (341.1089)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL 2xHexose (324.106)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL 2xHexose+H2O (342.1162)&#39;</span><span class="p">),</span>
        <span class="p">)))</span> <span class="o">*</span> <span class="mi">10</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Negative.shexcer"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Negative.shexcer">[docs]</a>    <span class="k">def</span> <span class="nf">shexcer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">100</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;Sulphate (96.9601)&#39;</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">20</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[Sulfohexose] (259.0129)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[Sulfohexose] (256.9972)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[Sulfohexose-H2O] (241.0024)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[Sulfohexose+Et+N] (300.0395)&#39;</span><span class="p">),</span>
        <span class="p">)))</span> <span class="o">*</span> <span class="mi">10</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_fragment_type</span><span class="p">(</span>
            <span class="n">frag_type</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Sph+C6O5H8+SO3+H2O&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Sph+C6O5H8+SO3+CO+H2O&#39;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">20</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combination</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span>
                <span class="n">chain_param</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;Sph+C6O5H8+SO3&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;Sph+C6O5H8+SO3+H2O&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;Sph+C6O5H8+SO3+CO+H2O&#39;</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;NLFA&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;NLFA_mH2O&#39;</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="p">):</span>
                
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">20</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Negative.shex2cer"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Negative.shex2cer">[docs]</a>    <span class="k">def</span> <span class="nf">shex2cer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">140</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">missing_chains</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;Sulphate (96.9601)&#39;</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">20</span>
        
        <span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[Sulfohexose] (259.0129)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[Sulfohexose] (256.9972)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[Sulfohexose-H2O] (241.0024)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[Sulfohexose+Et+N] (300.0395)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[2xHexose-H2O+SO3] (403.0552)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[2xHexose+SO3] (419.0501)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[2xHexose+SO3] (421.0658)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;[2xHexose+SO3+Et+N] (462.0923)&#39;</span><span class="p">),</span>
        <span class="p">)))</span> <span class="o">*</span> <span class="mi">10</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_fragment_type</span><span class="p">(</span>
            <span class="n">frag_type</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Sph+C12O10H18+SO3&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Sph+C12O10H18+SO3+H2O&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Sph+C12O10H18+SO3+CO+H2O&#39;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">20</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_chain_combination</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rec</span><span class="p">,</span>
                <span class="n">chain_param</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;Sph+C12O10H18+SO3&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;Sph+C12O10H18+SO3+H2O&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;Sph+C12O10H18+SO3+CO+H2O&#39;</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;frag_type&#39;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s1">&#39;NLFA&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;NLFA_mH2O&#39;</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="p">):</span>
                
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">20</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div>
    
<div class="viewcode-block" id="Cer_Negative.pe_cer"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.Cer_Negative.pe_cer">[docs]</a>    <span class="k">def</span> <span class="nf">pe_cer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_score</span> <span class="o">=</span> <span class="mi">30</span>
        
        <span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PE [P+E] (140.0118)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;NL PE [P+E] (141.0191)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scn</span><span class="o">.</span><span class="n">has_fragment</span><span class="p">(</span><span class="s1">&#39;PE [P+E-H2O] (122.0013)&#39;</span><span class="p">),</span>
        <span class="p">)))</span> <span class="o">*</span> <span class="mi">10</span>
        
        <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">max_score</span></div></div>

<span class="c1">#</span>
<span class="c1"># Scan.identify() dispatches identification methods as below</span>
<span class="c1">#</span>

<span class="n">idmethods</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;neg&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;FA&#39;</span><span class="p">):</span>  <span class="n">FA_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;DAG&#39;</span><span class="p">):</span> <span class="n">DAG_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;TAG&#39;</span><span class="p">):</span> <span class="n">TAG_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;DGTA&#39;</span><span class="p">):</span> <span class="n">GL_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;DGTS&#39;</span><span class="p">):</span> <span class="n">GL_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;DGCC&#39;</span><span class="p">):</span> <span class="n">GL_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;SQDG&#39;</span><span class="p">):</span> <span class="n">GL_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;MGDG&#39;</span><span class="p">):</span> <span class="n">GL_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;DGDG&#39;</span><span class="p">):</span> <span class="n">GL_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;DGTA&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span> <span class="n">GL_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;DGTS&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span> <span class="n">GL_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;DGCC&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span> <span class="n">GL_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;SQDG&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span> <span class="n">GL_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;MGDG&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span> <span class="n">GL_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;DGDG&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span> <span class="n">GL_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PE&#39;</span><span class="p">):</span>  <span class="n">PE_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PE&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span> <span class="n">PE_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PC&#39;</span><span class="p">):</span>  <span class="n">PC_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PC&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span> <span class="n">PC_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PI&#39;</span><span class="p">):</span>  <span class="n">PI_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PI&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span>  <span class="n">PI_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PS&#39;</span><span class="p">):</span>  <span class="n">PS_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PS&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span> <span class="n">PS_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PG&#39;</span><span class="p">):</span>  <span class="n">PG_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PG&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span>  <span class="n">PG_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;BMP&#39;</span><span class="p">):</span> <span class="n">BMP_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PA&#39;</span><span class="p">):</span>  <span class="n">PA_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PA&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span>  <span class="n">PA_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;VA&#39;</span><span class="p">):</span> <span class="n">VA_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Cer&#39;</span><span class="p">):</span> <span class="n">Cer_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;1P&#39;</span><span class="p">,)):</span> <span class="n">Cer_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;SM&#39;</span><span class="p">):</span> <span class="n">Cer_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Hex&#39;</span><span class="p">,)):</span> <span class="n">Cer_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Hex2&#39;</span><span class="p">,)):</span> <span class="n">Cer_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;SHex&#39;</span><span class="p">,)):</span> <span class="n">Cer_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;SHex2&#39;</span><span class="p">,)):</span> <span class="n">Cer_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;PE&#39;</span><span class="p">,)):</span> <span class="n">Cer_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Sph&#39;</span><span class="p">):</span> <span class="n">Cer_Negative</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Sph&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;1P&#39;</span><span class="p">,)):</span> <span class="n">Cer_Negative</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;pos&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;FA&#39;</span><span class="p">):</span>  <span class="n">FA_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;DAG&#39;</span><span class="p">):</span> <span class="n">DAG_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;DGTA&#39;</span><span class="p">):</span> <span class="n">GL_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;DGTS&#39;</span><span class="p">):</span> <span class="n">GL_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;DGCC&#39;</span><span class="p">):</span> <span class="n">GL_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;SQDG&#39;</span><span class="p">):</span> <span class="n">GL_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;MGDG&#39;</span><span class="p">):</span> <span class="n">GL_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;DGDG&#39;</span><span class="p">):</span> <span class="n">GL_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;DGTA&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span> <span class="n">GL_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;DGTS&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span> <span class="n">GL_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;DGCC&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span> <span class="n">GL_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;SQDG&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span> <span class="n">GL_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;MGDG&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span> <span class="n">GL_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;DGDG&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span> <span class="n">GL_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;TAG&#39;</span><span class="p">):</span> <span class="n">TAG_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PE&#39;</span><span class="p">):</span>  <span class="n">PE_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PE&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span>  <span class="n">LysoPE_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PC&#39;</span><span class="p">):</span>  <span class="n">PC_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PC&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span>  <span class="n">LysoPC_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PI&#39;</span><span class="p">):</span>  <span class="n">PI_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PI&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span>  <span class="n">PI_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PS&#39;</span><span class="p">):</span>  <span class="n">PS_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PS&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span>  <span class="n">PS_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PG&#39;</span><span class="p">):</span>  <span class="n">PG_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PG&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span>  <span class="n">PG_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;BMP&#39;</span><span class="p">):</span> <span class="n">BMP_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PA&#39;</span><span class="p">):</span>  <span class="n">PA_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;PA&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span>  <span class="n">PA_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;VA&#39;</span><span class="p">):</span> <span class="n">VA_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Cer&#39;</span><span class="p">):</span> <span class="n">Cer_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;1P&#39;</span><span class="p">,)):</span> <span class="n">Cer_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Hex&#39;</span><span class="p">,)):</span> <span class="n">Cer_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Hex2&#39;</span><span class="p">,)):</span> <span class="n">Cer_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;SHex&#39;</span><span class="p">,)):</span> <span class="n">Cer_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;SHex2&#39;</span><span class="p">,)):</span> <span class="n">Cer_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;PE&#39;</span><span class="p">,)):</span> <span class="n">Cer_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;SM&#39;</span><span class="p">):</span> <span class="n">Cer_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;1P&#39;</span><span class="p">,</span> <span class="s1">&#39;Lyso&#39;</span><span class="p">)):</span> <span class="n">Cer_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Hex&#39;</span><span class="p">,</span> <span class="s1">&#39;Lyso&#39;</span><span class="p">)):</span> <span class="n">Cer_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Hex2&#39;</span><span class="p">,</span> <span class="s1">&#39;Lyso&#39;</span><span class="p">)):</span> <span class="n">Cer_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;SHex&#39;</span><span class="p">,</span> <span class="s1">&#39;Lyso&#39;</span><span class="p">)):</span> <span class="n">Cer_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;SHex2&#39;</span><span class="p">,</span> <span class="s1">&#39;Lyso&#39;</span><span class="p">)):</span>
            <span class="n">Cer_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;PE&#39;</span><span class="p">,</span> <span class="s1">&#39;Lyso&#39;</span><span class="p">)):</span> <span class="n">Cer_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;SM&#39;</span><span class="p">,</span>  <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lyso&#39;</span><span class="p">,)):</span> <span class="n">Cer_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Sph&#39;</span><span class="p">):</span> <span class="n">Cer_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Sph&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;1P&#39;</span><span class="p">,)):</span> <span class="n">Cer_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Sph&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;M1&#39;</span><span class="p">,)):</span> <span class="n">Cer_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Sph&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;M2&#39;</span><span class="p">,)):</span> <span class="n">Cer_Positive</span><span class="p">,</span>
        <span class="n">lipproc</span><span class="o">.</span><span class="n">Headgroup</span><span class="p">(</span><span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;Sph&#39;</span><span class="p">,</span> <span class="n">sub</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;M3&#39;</span><span class="p">,)):</span> <span class="n">Cer_Positive</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>


<div class="viewcode-block" id="MS2Feature"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Feature">[docs]</a><span class="k">class</span> <span class="nc">MS2Feature</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz</span><span class="p">,</span> <span class="n">ionmode</span><span class="p">,</span> <span class="n">mgfs</span><span class="p">,</span> <span class="n">rt</span><span class="p">,</span> <span class="n">ms1_records</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mz</span> <span class="o">=</span> <span class="n">mz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ionmode</span> <span class="o">=</span> <span class="n">ionmode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ms1_records</span> <span class="o">=</span> <span class="n">ms1_records</span> <span class="ow">or</span> <span class="n">moldb</span><span class="o">.</span><span class="n">adduct_lookup</span><span class="p">(</span><span class="n">mz</span><span class="p">,</span> <span class="n">ionmode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mgfs</span> <span class="o">=</span> <span class="n">mgfs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rt</span> <span class="o">=</span> <span class="p">(</span><span class="n">rt</span><span class="p">,</span> <span class="n">rt</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rt</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">float</span> <span class="k">else</span> <span class="n">rt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rtmean</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rt</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
    
<div class="viewcode-block" id="MS2Feature.main"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Feature.main">[docs]</a>    <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">build_scans</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identify</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="MS2Feature.iterscans"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Feature.iterscans">[docs]</a>    <span class="k">def</span> <span class="nf">iterscans</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">mgfname</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mgfs</span><span class="p">):</span>
            
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">mgfname</span><span class="p">)</span> <span class="ow">is</span> <span class="n">basestring</span><span class="p">:</span>
                
                <span class="n">mgffile</span> <span class="o">=</span> <span class="n">mgf</span><span class="o">.</span><span class="n">MgfReader</span><span class="p">(</span><span class="n">mgfname</span><span class="p">,</span> <span class="n">charge</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
                
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mgfname</span><span class="p">,</span> <span class="n">mgf</span><span class="o">.</span><span class="n">MgfReader</span><span class="p">):</span>
                
                <span class="n">mgffile</span> <span class="o">=</span> <span class="n">mgfname</span>
                
            <span class="k">else</span><span class="p">:</span>
                
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;Mgf files should be lipyd.mgf.MgfReader &#39;</span>
                    <span class="s1">&#39;instances of file names.&#39;</span>
                <span class="p">)</span>
            
            <span class="n">idx</span><span class="p">,</span> <span class="n">rtdiff</span> <span class="o">=</span> <span class="n">mgffile</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mz</span><span class="p">,</span> <span class="n">rt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rtmean</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rtd</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">rtdiff</span><span class="p">):</span>
                
                <span class="n">scan_rt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rtmean</span> <span class="o">+</span> <span class="n">rtd</span>
                
                <span class="k">if</span> <span class="n">scan_rt</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">scan_rt</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rt</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    
                    <span class="k">continue</span>
                
                <span class="n">sc</span> <span class="o">=</span> <span class="n">mgffile</span><span class="o">.</span><span class="n">get_scan</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                
                <span class="k">yield</span> <span class="n">Scan</span><span class="p">(</span>
                    <span class="n">mzs</span> <span class="o">=</span> <span class="n">sc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">intensities</span> <span class="o">=</span> <span class="n">sc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">ionmode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ionmode</span><span class="p">,</span>
                    <span class="n">precursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz</span><span class="p">,</span>
                    <span class="n">ms1_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms1_records</span><span class="p">,</span>
                    <span class="n">scan_id</span> <span class="o">=</span> <span class="n">mgffile</span><span class="o">.</span><span class="n">mgfindex</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span>
                    <span class="n">rt</span> <span class="o">=</span> <span class="n">mgffile</span><span class="o">.</span><span class="n">mgfindex</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
                    <span class="n">sample</span> <span class="o">=</span> <span class="n">sample</span><span class="p">,</span>
                <span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2Feature.build_scans"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Feature.build_scans">[docs]</a>    <span class="k">def</span> <span class="nf">build_scans</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">scans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterscans</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deltart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">sc</span><span class="o">.</span><span class="n">rt</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rtmean</span> <span class="k">for</span> <span class="n">sc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">])</span>
        
        <span class="n">rtsort</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
                <span class="p">(</span><span class="n">it</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deltart</span><span class="p">)),</span>
                <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">it</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">it</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="n">rtsort</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deltart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltart</span><span class="p">[</span><span class="n">rtsort</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="MS2Feature.identify"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Feature.identify">[docs]</a>    <span class="k">def</span> <span class="nf">identify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">identities</span> <span class="o">=</span> <span class="p">[</span><span class="n">scan</span><span class="o">.</span><span class="n">identify</span><span class="p">()</span> <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="MS2Feature.identity_summary"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Feature.identity_summary">[docs]</a>    <span class="k">def</span> <span class="nf">identity_summary</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">drt</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">sample_ids</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">scan_ids</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">):</span>
        
        <span class="n">identities</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">scan_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identities</span><span class="p">):</span>
            
            <span class="k">for</span> <span class="n">sum_str</span><span class="p">,</span> <span class="n">varieties</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">scan_i</span><span class="p">):</span>
                
                <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">varieties</span><span class="p">:</span>
                    
                    <span class="n">summary</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()]</span>
                    
                    <span class="k">if</span> <span class="n">scores</span><span class="p">:</span>
                        
                        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">score_pct</span><span class="p">)</span>
                        
                    <span class="k">else</span><span class="p">:</span>
                        
                        <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">score</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            
                            <span class="k">continue</span>
                    
                    <span class="k">if</span> <span class="n">drt</span><span class="p">:</span>
                        
                        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deltart</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    
                    <span class="k">if</span> <span class="n">sample_ids</span><span class="p">:</span>
                        
                        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">scan_ids</span><span class="p">:</span>
                        
                        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scan_id</span><span class="p">)</span>
                    
                    <span class="n">identities</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">summary</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">identities</span></div></div>

<span class="c1">##############################################################################</span>


<div class="viewcode-block" id="MS2FeatureOld"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2FeatureOld">[docs]</a><span class="k">class</span> <span class="nc">MS2FeatureOld</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides additional, more sophisticated methods</span>
<span class="sd">    for identification of a single feature.</span>
<span class="sd">    </span>
<span class="sd">    In the original concept all methods for identification</span>
<span class="sd">    based on MS1 and MS2 took place in class Screening(),</span>
<span class="sd">    as those could simply iterate through the arrays.</span>
<span class="sd">    </span>
<span class="sd">    Later more complex methods became necessary, so</span>
<span class="sd">    I created this class to group them.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">main</span><span class="p">,</span> <span class="n">protein</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">oi</span><span class="p">,</span> <span class="n">log</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @main : ltp.Screening() instance</span>
<span class="sd">            One Screening() instance with MS1 and MS2 processing already done.</span>
<span class="sd">        </span>
<span class="sd">        @protein : str</span>
<span class="sd">            Protein name</span>
<span class="sd">        </span>
<span class="sd">        @mode : str</span>
<span class="sd">            MS mode (`pos` or `neg`)</span>
<span class="sd">        </span>
<span class="sd">        @oi : int</span>
<span class="sd">            Original index of one feature.</span>
<span class="sd">        </span>
<span class="sd">        @log : bool</span>
<span class="sd">            Whether output verbose messages to logfile.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main</span> <span class="o">=</span> <span class="n">main</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protein</span> <span class="o">=</span> <span class="n">protein</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oi</span> <span class="o">=</span> <span class="n">oi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ifracs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">fraction_indices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protein</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fracsi</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">fr</span><span class="p">:</span> <span class="p">(</span><span class="n">fr</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                               <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ifracs</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">valids</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">protein</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ms2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;ms2&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">oi</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">oi2i</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">oi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fa</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scans_fractions</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">tpl</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">tpl</span><span class="p">)),</span>
            <span class="n">uniqList</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span>
                    <span class="nb">tuple</span><span class="p">,</span>
                    <span class="c1"># scan ID, fraction ID</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ms2</span><span class="p">[:,[</span><span class="mi">12</span><span class="p">,</span><span class="mi">14</span><span class="p">]]</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PA&#39;</span><span class="p">,</span> <span class="s1">&#39;PC&#39;</span><span class="p">,</span> <span class="s1">&#39;PE&#39;</span><span class="p">,</span> <span class="s1">&#39;PG&#39;</span><span class="p">,</span> <span class="s1">&#39;PS&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classes2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PA&#39;</span><span class="p">,</span> <span class="s1">&#39;PC&#39;</span><span class="p">,</span> <span class="s1">&#39;PE&#39;</span><span class="p">,</span> <span class="s1">&#39;PG&#39;</span><span class="p">,</span> <span class="s1">&#39;PS&#39;</span><span class="p">,</span> <span class="s1">&#39;PI&#39;</span><span class="p">,</span> <span class="s1">&#39;SM&#39;</span><span class="p">,</span> <span class="s1">&#39;BMP&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="s1">&#39;Cer1P&#39;</span><span class="p">,</span> <span class="s1">&#39;HexCer&#39;</span><span class="p">,</span> <span class="s1">&#39;HexCerOH&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;DAG&#39;</span><span class="p">,</span> <span class="s1">&#39;TAG&#39;</span><span class="p">,</span> <span class="s1">&#39;FA&#39;</span><span class="p">,</span> <span class="s1">&#39;VA&#39;</span><span class="p">,</span> <span class="s1">&#39;LysoPE&#39;</span><span class="p">,</span> <span class="s1">&#39;LysoPC&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identities</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identities2</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># get carbon counts from MS1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ms1fa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;ms1fa&#39;</span><span class="p">][</span><span class="n">oi</span><span class="p">]</span>
        <span class="c1"># sorting by fractions/scans</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scans</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">sc_fr</span><span class="p">:</span>
                    <span class="p">(</span>
                        <span class="c1"># scan ID, fraction ID: key</span>
                        <span class="p">(</span><span class="n">sc_fr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sc_fr</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="c1"># MS2 array slice: value</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ms2</span><span class="p">[</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">ms2</span><span class="p">[:,</span><span class="mi">12</span><span class="p">]</span> <span class="o">==</span> <span class="n">sc_fr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">ms2</span><span class="p">[:,</span><span class="mi">14</span><span class="p">]</span> <span class="o">==</span> <span class="n">sc_fr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="p">]</span>
                    <span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scans_fractions</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># sorting by intensity desc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scans</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span>
                    <span class="p">(</span>
                        <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],:]</span>
                    <span class="p">),</span>
                <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deltart</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span>
                    <span class="p">(</span>
                        <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;rtm&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">11</span><span class="p">]</span>
                    <span class="p">),</span>
                <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scans</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span>
                    <span class="p">(</span>
                        <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="c1"># i[0]: (scan ID, fraction ID)</span>
                        <span class="c1"># i[1]: MS2 array slice</span>
                        <span class="n">MS2Scan</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="p">)</span>
                    <span class="p">),</span>
                <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span>
                    <span class="p">(</span>
                        <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
                    <span class="p">),</span>
                <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">medins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span>
                    <span class="p">(</span>
                        <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span><span class="mi">2</span><span class="p">])</span>
                    <span class="p">),</span>
                <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_scans</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_best_scan</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">::: Analysing feature: </span><span class="si">%s</span><span class="s1"> :: </span><span class="si">%s</span><span class="s1"> :: index = </span><span class="si">%u</span><span class="s1"> ::&#39;</span>\
                <span class="s1">&#39; m/z = </span><span class="si">%.03f</span><span class="s1"> :: number of MS2 scans: </span><span class="si">%u</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">oi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;mz&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">],</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scans</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">::: Database lookup resulted &#39;</span>\
            <span class="s1">&#39;the following species: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_db_species</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">::: Intensities:</span><span class="se">\n</span><span class="si">%s%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;          &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;A09&#39;</span><span class="p">,</span> <span class="s1">&#39;A10&#39;</span><span class="p">,</span> <span class="s1">&#39;A11&#39;</span><span class="p">,</span> <span class="s1">&#39;A12&#39;</span><span class="p">,</span> <span class="s1">&#39;B01&#39;</span><span class="p">])))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">63</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">    - absolute:  </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;   &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
          <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%10.01f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;fe&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,:]))</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">    - relative: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
          <span class="s1">&#39;  &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">xx</span><span class="p">:</span>
                        <span class="s1">&#39;</span><span class="si">%10.02f%%</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xx</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">),</span>
                    <span class="nb">map</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>
                            <span class="n">x</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;fe&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,:]),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;fe&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,:]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">::: MS2 scans available (</span><span class="si">%u</span><span class="s1">):</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">sc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scans</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">sc</span><span class="o">.</span><span class="n">print_scan</span><span class="p">()</span>
    
<div class="viewcode-block" id="MS2FeatureOld.sort_scans"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2FeatureOld.sort_scans">[docs]</a>    <span class="k">def</span> <span class="nf">sort_scans</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Groups the scans in 3 groups: highest consists of those from the</span>
<span class="sd">        fractions with the highest protein level (there might be more than</span>
<span class="sd">        one the highest, because the fraction offset limits); the secondary</span>
<span class="sd">        contains scans from other protein containing fractions; while the</span>
<span class="sd">        other contains the scans from non protein containing fractions.</span>
<span class="sd">        Within the groups the scans are sorted from lowest to highest</span>
<span class="sd">        deltaRT.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">highest</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secondary</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">other</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">with_protein</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">protein_containing_fractions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protein</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">scan_num</span><span class="p">,</span> <span class="n">fr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">fr_name</span> <span class="o">=</span> <span class="s1">&#39;a</span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fr</span> <span class="k">if</span> <span class="n">fr</span> <span class="o">!=</span> <span class="mi">13</span> <span class="ow">and</span> <span class="n">fr</span> <span class="o">!=</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;b1&#39;</span>
            <span class="k">if</span> <span class="n">fr_name</span> <span class="ow">in</span> <span class="n">with_protein</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fr_name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">fracs_orderL</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">protein</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> \
                    <span class="n">fr_name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">fracs_orderU</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">protein</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">highest</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">scan_num</span><span class="p">,</span> <span class="n">fr</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">secondary</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">scan_num</span><span class="p">,</span> <span class="n">fr</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">other</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">scan_num</span><span class="p">,</span> <span class="n">fr</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highest</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">highest</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sc</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scans</span><span class="p">[</span><span class="n">sc</span><span class="p">]</span><span class="o">.</span><span class="n">deltart</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secondary</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">secondary</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sc</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scans</span><span class="p">[</span><span class="n">sc</span><span class="p">]</span><span class="o">.</span><span class="n">deltart</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">other</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">other</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sc</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scans</span><span class="p">[</span><span class="n">sc</span><span class="p">]</span><span class="o">.</span><span class="n">deltart</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="MS2FeatureOld.select_best_scan"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2FeatureOld.select_best_scan">[docs]</a>    <span class="k">def</span> <span class="nf">select_best_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_scan</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">highest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">highest</span><span class="p">)</span> <span class="k">else</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">secondary</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">secondary</span><span class="p">)</span> <span class="k">else</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">other</span><span class="p">)</span> <span class="k">else</span> \
            <span class="kc">None</span></div>
    
<div class="viewcode-block" id="MS2FeatureOld.print_db_species"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2FeatureOld.print_db_species">[docs]</a>    <span class="k">def</span> <span class="nf">print_db_species</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">hg</span><span class="p">:</span>
                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">hg</span> \
                            <span class="k">if</span> <span class="n">hg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;ms1fa&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">oi</span><span class="p">]</span> \
                            <span class="ow">or</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;ms1fa&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">oi</span><span class="p">][</span><span class="n">hg</span><span class="p">])</span> \
                            <span class="k">else</span> \
                        <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="nb">map</span><span class="p">(</span>
                                <span class="k">lambda</span> <span class="n">fa</span><span class="p">:</span>
                                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hg</span><span class="p">,</span> <span class="n">fa</span><span class="p">),</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;ms1fa&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">oi</span><span class="p">][</span><span class="n">hg</span><span class="p">]</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;ms1hg&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">oi</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span> \
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;ms1hg&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">oi</span><span class="p">])</span> \
        <span class="k">else</span> <span class="s1">&#39;none&#39;</span></div>
    
<div class="viewcode-block" id="MS2FeatureOld.reload"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2FeatureOld.reload">[docs]</a>    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">children</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">fromlist</span><span class="o">=</span><span class="p">[</span><span class="n">modname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">imp</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__class__&#39;</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">children</span><span class="p">:</span>
            
            <span class="k">for</span> <span class="n">sc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scans</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                
                <span class="n">sc</span><span class="o">.</span><span class="n">reload</span><span class="p">()</span></div>
    
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">hgfas</span><span class="p">:</span>
                    <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="nb">map</span><span class="p">(</span>
                            <span class="k">lambda</span> <span class="n">fa</span><span class="p">:</span>
                                <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hgfas</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fa</span><span class="p">),</span>
                            <span class="n">hgfas</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="p">),</span>
                <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
    
<div class="viewcode-block" id="MS2FeatureOld.get_header_div"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2FeatureOld.get_header_div">[docs]</a>    <span class="k">def</span> <span class="nf">get_header_div</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">&lt;div class=&quot;ms2hdr&quot;&gt;</span><span class="se">\n\t\t</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;MS2 scans of feature </span><span class="si">%.04f</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;</span><span class="se">\n\t\t\t</span><span class="s1">|&lt;span class=&quot;scansbutton morescans1&quot;&#39;</span>\
                <span class="s1">&#39; title=&quot;Show/hide scans from fractions with &#39;</span>\
                <span class="s1">&#39;highest protein concentration&quot;&gt;scans+&lt;/span&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;</span><span class="se">\n\t\t\t</span><span class="s1">|&lt;span class=&quot;scansbutton morescans2&quot;&#39;</span>\
                <span class="s1">&#39; title=&quot;Show/hide scans from other protein &#39;</span>\
                <span class="s1">&#39;containing fractions&quot;&gt;scans++&lt;/span&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;</span><span class="se">\n\t\t\t</span><span class="s1">|&lt;span class=&quot;scansbutton morescans3&quot;&#39;</span>\
                <span class="s1">&#39; title=&quot;Show/hide scans from non protein &#39;</span>\
                <span class="s1">&#39;containing fractions&quot;&gt;scans+++&lt;/span&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;</span><span class="se">\n\t\t\t</span><span class="s1">|&lt;span class=&quot;scansbutton morefrags&quot;&#39;</span>\
                <span class="s1">&#39; title=&quot;Show/hide fragments after 5 highest&#39;</span>\
                <span class="s1">&#39;&quot;&gt;frags+&lt;/span&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;</span><span class="se">\n\t\t\t</span><span class="s1">|&lt;span class=&quot;scansbutton remove&quot;&#39;</span>\
                <span class="s1">&#39; title=&quot;Remove scans of this feature&#39;</span>\
                <span class="s1">&#39;&quot;&gt;remove&lt;/span&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">&lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;mz&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="MS2FeatureOld.html_table"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2FeatureOld.html_table">[docs]</a>    <span class="k">def</span> <span class="nf">html_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;div id=&quot;</span><span class="si">%s</span><span class="s1">&quot; class=&quot;ms2tblcontainer&quot;&gt;</span><span class="se">\n</span><span class="si">%s%s</span><span class="se">\n\t</span><span class="s1">&lt;/div&gt;&#39;</span>
        <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_header_div</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_scan</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">html</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">best_scan</span><span class="p">]</span><span class="o">.</span><span class="n">html_table</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">html</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;noscans&quot;&gt;No scans &#39;</span>\
                <span class="s1">&#39;from fractions with highest protein concentration.&lt;/div&gt;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sc</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scans</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sc</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">deltart</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">sc</span><span class="o">.</span><span class="n">in_primary</span> <span class="ow">and</span> <span class="n">sc</span><span class="o">.</span><span class="n">scan_id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_scan</span><span class="p">:</span>
                <span class="n">html</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">html_table</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">sc</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scans</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sc</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">deltart</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sc</span><span class="o">.</span><span class="n">in_primary</span> <span class="ow">and</span> <span class="n">sc</span><span class="o">.</span><span class="n">scan_id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_scan</span><span class="p">:</span>
                <span class="n">html</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">html_table</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">sc</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scans</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sc</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">deltart</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sc</span><span class="o">.</span><span class="n">in_primary</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">sc</span><span class="o">.</span><span class="n">in_secondary</span><span class="p">:</span>
                <span class="n">html</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">html_table</span><span class="p">())</span>
        <span class="n">html</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">container</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;ms2c_</span><span class="si">%u</span><span class="s1">_</span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;aaa&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">oi</span><span class="p">),</span> <span class="n">header</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2FeatureOld.html_table_b64"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2FeatureOld.html_table_b64">[docs]</a>    <span class="k">def</span> <span class="nf">html_table_b64</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">encodestring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">html_table</span><span class="p">())</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2FeatureOld.msg"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2FeatureOld.msg">[docs]</a>    <span class="k">def</span> <span class="nf">msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">ms2log</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>
    
    <span class="k">def</span> <span class="nf">_any_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sc</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scans</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">:: Calling method </span><span class="si">%s</span><span class="s1">() on scan #</span><span class="si">%u</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">method</span><span class="p">)(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>
    
<div class="viewcode-block" id="MS2FeatureOld.identify"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2FeatureOld.identify">[docs]</a>    <span class="k">def</span> <span class="nf">identify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">hg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&gt;&gt;&gt; Attempting to identify </span><span class="si">%s</span><span class="s1"> in all scans</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hg</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_any_scan</span><span class="p">(</span><span class="s1">&#39;is_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">hg</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">identities</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hg</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;&lt;&lt; Result: identified as </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">hg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;&lt;&lt; Result: not </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">hg</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2FeatureOld.identify2"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2FeatureOld.identify2">[docs]</a>    <span class="k">def</span> <span class="nf">identify2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        
        <span class="k">for</span> <span class="n">scanid</span><span class="p">,</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scans</span><span class="p">):</span>
            
            <span class="k">for</span> <span class="n">hg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">classes2</span><span class="p">:</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&gt;&gt;&gt; Attempting to identify </span><span class="si">%s</span><span class="s1"> in scan </span><span class="si">%u</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                         <span class="p">(</span><span class="n">hg</span><span class="p">,</span> <span class="n">scanid</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                
                <span class="n">identified</span> <span class="o">=</span> <span class="kc">False</span>
                
                <span class="k">if</span> <span class="n">hg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">identities2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">identities2</span><span class="p">[</span><span class="n">hg</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                
                <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">identities2</span><span class="p">[</span><span class="n">hg</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="n">method</span><span class="p">)())</span>
                    
                    <span class="n">identified</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
                        <span class="nb">map</span><span class="p">(</span>
                            <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">identities2</span><span class="p">[</span><span class="n">hg</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                
                <span class="k">if</span> <span class="n">identified</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;&lt;&lt; Result: identified as </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">hg</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;&lt;&lt; Result: not </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">hg</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="s1">&#39;fa_co_2&#39;</span><span class="p">):</span>
                <span class="k">del</span> <span class="n">scan</span><span class="o">.</span><span class="n">fa_co_2</span>
            
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="s1">&#39;fa_list&#39;</span><span class="p">):</span>
                <span class="n">scan</span><span class="o">.</span><span class="n">fa_list</span> <span class="o">=</span> <span class="kc">None</span></div></div>


<div class="viewcode-block" id="MS2Scan"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan">[docs]</a><span class="k">class</span> <span class="nc">MS2Scan</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class represents one MS2 scan and provides methods for its analysis.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="n">scan_id</span><span class="p">,</span> <span class="n">feature</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">scan</span> <span class="o">=</span> <span class="n">scan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_id</span> <span class="o">=</span> <span class="n">scan_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span> <span class="o">=</span> <span class="n">feature</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deltart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">deltart</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frac_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_id</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frac_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">fracsi</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frac_id</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ms2_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">ms2files</span>\
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">protein</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">mode</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">frac_name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_primary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frac_name</span> <span class="ow">in</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">fracs_order</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">protein</span><span class="p">][</span><span class="s1">&#39;prim&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_secondary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frac_name</span> <span class="ow">in</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">fracs_order</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">protein</span><span class="p">][</span><span class="s1">&#39;sec&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">tbl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recc</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;.*?([0-9]{1,2}):([0-9]).*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fa</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fa1</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_order</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_by_i</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_fa_list</span><span class="p">()</span>
    
<div class="viewcode-block" id="MS2Scan.reload"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.reload">[docs]</a>    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">fromlist</span><span class="o">=</span><span class="p">[</span><span class="n">modname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">imp</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__class__&#39;</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2Scan.print_identities"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.print_identities">[docs]</a>    <span class="k">def</span> <span class="nf">print_identities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints identities to standard output or file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identities_str</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identities_str</span><span class="p">())</span></div>
    
<div class="viewcode-block" id="MS2Scan.identities_str"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.identities_str">[docs]</a>    <span class="k">def</span> <span class="nf">identities_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns table of all identification attempts as string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;=== Scan #</span><span class="si">%u</span><span class="s1"> (fraction </span><span class="si">%s</span><span class="s1">) ===&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan_id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">frac_name</span><span class="p">)]</span>
        
        <span class="k">for</span> <span class="n">hg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">classes2</span><span class="p">:</span>
            
            <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">hg</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="n">num</span>
            <span class="p">)</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
                <span class="k">continue</span>
            
            <span class="n">idd</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">)()</span>
            
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%u</span><span class="se">\t</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">hg</span><span class="p">,</span>
                <span class="n">idd</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">],</span>
                <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">idd</span><span class="p">[</span><span class="s1">&#39;fattya&#39;</span><span class="p">])</span>
            <span class="p">))</span>
        
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2Scan.print_scan"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.print_scan">[docs]</a>    <span class="k">def</span> <span class="nf">print_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints the list of fragments as an annotated table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_str</span><span class="p">())</span></div>
    
<div class="viewcode-block" id="MS2Scan.show"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints the scan table to standard output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_str</span><span class="p">())</span></div>
    
<div class="viewcode-block" id="MS2Scan.scan_str"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.scan_str">[docs]</a>    <span class="k">def</span> <span class="nf">scan_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the scan table as string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">ms1mz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;mz&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Frag. m/z</span><span class="se">\t</span><span class="s1">Intensity</span><span class="se">\t</span><span class="s1">Identity</span><span class="si">%s</span><span class="s1">NL mass</span><span class="se">\n</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">26</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">73</span><span class="p">)</span>
        <span class="n">table</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">sc</span><span class="p">:</span>
                    <span class="s1">&#39;</span><span class="si">%9.4f</span><span class="se">\t</span><span class="si">%10.2f</span><span class="se">\t</span><span class="si">%s%s%9.4f</span><span class="s1">&#39;</span> <span class="o">%</span> \
                        <span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sc</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">]])</span> <span class="o">+</span> \
                            <span class="p">[</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">32</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sc</span><span class="p">[</span><span class="mi">7</span><span class="p">])),</span> <span class="n">ms1mz</span> <span class="o">-</span> <span class="n">sc</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scan</span>
            <span class="p">)</span>
        <span class="p">)</span>
        
        <span class="n">fri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_id</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">9</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_id</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">4</span>
        
        <span class="k">return</span> <span class="p">(</span>
            <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Scan </span><span class="si">%u</span><span class="s1"> (fraction </span><span class="si">%s%u</span><span class="s1">; </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">; &#39;</span>\
            <span class="s1">&#39;intensity = </span><span class="si">%.01f</span><span class="s1"> (</span><span class="si">%.02f%%</span><span class="s1">)):</span><span class="se">\n\n</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">frac_name</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">frac_id</span><span class="p">,</span>
             <span class="s1">&#39;contains&#39;</span> \
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ifracs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frac_name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> \
                <span class="k">else</span> <span class="s1">&#39;does not contain&#39;</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;fe&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frac_id</span><span class="p">]</span> \
                 <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frac_id</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;fe&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;fe&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frac_id</span><span class="p">]</span> \
                 <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frac_id</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;fe&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span> <span class="o">/</span> \
                 <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;fe&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span>
             <span class="n">header</span><span class="p">,</span>
             <span class="n">table</span><span class="p">)</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2Scan.html_table"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.html_table">[docs]</a>    <span class="k">def</span> <span class="nf">html_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">table</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">&lt;table id=&quot;</span><span class="si">%s</span><span class="s1">&quot; class=&quot;scantbl </span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n\t\t</span><span class="s1">&lt;/table&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">th</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t\t\t\t</span><span class="s1">&lt;th&gt;</span><span class="se">\n\t\t\t\t\t</span><span class="si">%s</span><span class="se">\n\t\t\t\t</span><span class="s1">&lt;/th&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">ttl</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t\t\t</span><span class="s1">&lt;tr class=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="se">\n\t\t\t\t</span><span class="s1">&lt;th colspan=&quot;4&quot;&gt;</span><span class="se">\n\t\t\t\t\t</span><span class="si">%s</span><span class="s1">&#39;</span>\
            <span class="s1">&#39;</span><span class="se">\n\t\t\t\t</span><span class="s1">&lt;/th&gt;</span><span class="se">\n\t\t\t</span><span class="s1">&lt;/tr&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t\t\t</span><span class="s1">&lt;tr class=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n\t\t\t</span><span class="s1">&lt;/tr&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">td</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t\t\t\t</span><span class="s1">&lt;td&gt;</span><span class="se">\n\t\t\t\t\t</span><span class="si">%s</span><span class="se">\n\t\t\t\t</span><span class="s1">&lt;/td&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">ms1mz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;mz&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">]</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">ttl</span> <span class="o">%</span> <span class="p">(</span>
            <span class="s1">&#39;scantitle&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Scan </span><span class="si">%u</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">; &#39;</span>\
            <span class="s1">&#39;intensity = </span><span class="si">%.01f</span><span class="s1"> (</span><span class="si">%.02f%%</span><span class="s1">); dRT = </span><span class="si">%.03f</span><span class="s1"> min)&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scan_id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frac_name</span><span class="p">,</span>
                <span class="s1">&#39;the highest fraction&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_primary</span> \
                    <span class="k">else</span> <span class="s1">&#39;not the highest, but contains </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">protein</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_secondary</span> \
                    <span class="k">else</span> <span class="s1">&#39;does not contain </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;fe&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frac_id</span><span class="p">]</span> \
                    <span class="k">if</span> <span class="n">fri</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;fe&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;fe&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frac_id</span><span class="p">]</span> \
                    <span class="k">if</span> <span class="n">fri</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;fe&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span> <span class="o">/</span> \
                    <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;fe&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">deltart</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">rows</span> <span class="o">+=</span> <span class="n">tr</span> <span class="o">%</span> <span class="p">(</span>
            <span class="s1">&#39;scanhdr&#39;</span><span class="p">,</span>
            <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">cname</span><span class="p">:</span>
                        <span class="n">th</span> <span class="o">%</span> <span class="n">cname</span><span class="p">,</span>
                    <span class="p">[</span><span class="s1">&#39;Frag m/z&#39;</span><span class="p">,</span> <span class="s1">&#39;Intensity&#39;</span><span class="p">,</span> <span class="s1">&#39;Identity&#39;</span><span class="p">,</span> <span class="s1">&#39;NL mass&#39;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">rn</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">):</span>
            <span class="n">rows</span> <span class="o">+=</span> <span class="n">tr</span> <span class="o">%</span> <span class="p">(</span>
                <span class="s1">&#39;fragrow </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;first5&#39;</span> <span class="k">if</span> <span class="n">rn</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="k">else</span> <span class="s1">&#39;after5&#39;</span><span class="p">),</span>
                <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                    <span class="n">td</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%.04f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="n">td</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%.02f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                    <span class="n">td</span> <span class="o">%</span> <span class="n">row</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>
                    <span class="n">td</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%.04f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ms1mz</span> <span class="o">-</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="p">])</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">table</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%u</span><span class="s1">_</span><span class="si">%u</span><span class="s1">_</span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_id</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="s1">&#39;best&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">best_scan</span> \
                <span class="k">else</span> <span class="s1">&#39;primary&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_primary</span> \
                <span class="k">else</span> <span class="s1">&#39;secondary&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_secondary</span> \
                <span class="k">else</span> <span class="s1">&#39;noprotein&#39;</span><span class="p">,</span>
            <span class="n">rows</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2Scan.get_by_rank"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.get_by_rank">[docs]</a>    <span class="k">def</span> <span class="nf">get_by_rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rank</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">min_mz</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">):</span>
        <span class="n">this_rank</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">return_next</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">prev_mz</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_mz</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev_mz</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0001</span><span class="p">:</span>
                <span class="n">prev_mz</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">this_rank</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">this_rank</span> <span class="o">==</span> <span class="n">rank</span><span class="p">:</span>
                <span class="n">return_next</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">intensity</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.04f</span><span class="s1">(</span><span class="si">%u</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%.03f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">this_rank</span> <span class="o">!=</span> <span class="n">rank</span> <span class="ow">and</span> <span class="n">return_next</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">intensity</span><span class="p">,</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span></div>
    
<div class="viewcode-block" id="MS2Scan.full_list_str"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.full_list_str">[docs]</a>    <span class="k">def</span> <span class="nf">full_list_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prev_mz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev_mz</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0001</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>  <span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;unknown&#39;</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%.03f</span><span class="s1">) (</span><span class="si">%u</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">))),</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">intensity</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%u</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">))),</span> <span class="n">intensity</span><span class="p">))</span>
                <span class="n">names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
                <span class="n">intensity</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">prev_mz</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%u</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">))),</span> <span class="n">intensity</span><span class="p">))</span>
        <span class="k">return</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2Scan.most_abundant_mz"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.most_abundant_mz">[docs]</a>    <span class="k">def</span> <span class="nf">most_abundant_mz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- Most abundant m/z is </span><span class="si">%.03f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="MS2Scan.mz_match"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.mz_match">[docs]</a>    <span class="k">def</span> <span class="nf">mz_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz_detected</span><span class="p">,</span> <span class="n">mz</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mz_detected</span> <span class="o">-</span> <span class="n">mz</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">ms2_tlr</span></div>
    
<div class="viewcode-block" id="MS2Scan.sort_by_mz"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.sort_by_mz">[docs]</a>    <span class="k">def</span> <span class="nf">sort_by_mz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sorts the scan array by m/z increasing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">(),:]</span></div>
    
<div class="viewcode-block" id="MS2Scan.sort_by_i"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.sort_by_i">[docs]</a>    <span class="k">def</span> <span class="nf">sort_by_i</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_order</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sorts the scan array by intensity decreasing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">order</span><span class="p">,:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">order</span><span class="p">,:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order</span><span class="p">[</span><span class="n">order</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">return_order</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">order</span></div>
    
<div class="viewcode-block" id="MS2Scan.mz_lookup"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.mz_lookup">[docs]</a>    <span class="k">def</span> <span class="nf">mz_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the index of the closest m/z value</span>
<span class="sd">        detected in the scan if it is within the</span>
<span class="sd">        range of tolerance, otherwise None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">du</span> <span class="o">=</span> <span class="mf">999.0</span>
        <span class="n">dl</span> <span class="o">=</span> <span class="mf">999.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_by_mz</span><span class="p">()</span>
        <span class="n">ui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">mz</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ui</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">du</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">ui</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">mz</span>
        <span class="k">if</span> <span class="n">ui</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dl</span> <span class="o">=</span> <span class="n">mz</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">ui</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">ui</span> <span class="k">if</span> <span class="n">du</span> <span class="o">&lt;</span> <span class="n">dl</span> <span class="k">else</span> <span class="n">ui</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">mz</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">sort</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_by_i</span><span class="p">(</span><span class="n">return_order</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sort</span> <span class="o">==</span> <span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">i</span></div>
    
<div class="viewcode-block" id="MS2Scan.has_mz"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.has_mz">[docs]</a>    <span class="k">def</span> <span class="nf">has_mz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if an m/z exists in this scan.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_lookup</span><span class="p">(</span><span class="n">mz</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- m/z </span><span class="si">%.03f</span><span class="s1"> occures in this scan? -- </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="n">mz</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="MS2Scan.has_nl"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.has_nl">[docs]</a>    <span class="k">def</span> <span class="nf">has_nl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if a neutral loss exists in this scan.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms1_mz</span><span class="p">()</span> <span class="o">-</span> <span class="n">nl</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- neutral loss of </span><span class="si">%.03f</span><span class="s1"> occures in &#39;</span>\
            <span class="s1">&#39;this scan? Looked up m/z </span><span class="si">%.03f</span><span class="s1"> - </span><span class="si">%.03f</span><span class="s1"> = </span><span class="si">%.03f</span><span class="s1"> -- </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="n">nl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;mz&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">i</span><span class="p">],</span> <span class="n">nl</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;mz&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">nl</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="MS2Scan.ms1_mz"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.ms1_mz">[docs]</a>    <span class="k">def</span> <span class="nf">ms1_mz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the MS1 m/z (which should be the precursor ion).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;mz&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">i</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="MS2Scan.nl_lookup"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.nl_lookup">[docs]</a>    <span class="k">def</span> <span class="nf">nl_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Looks up if a neutral loss exists in this scan and returns its index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;mz&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">nl</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2Scan.most_abundant_mz_is"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.most_abundant_mz_is">[docs]</a>    <span class="k">def</span> <span class="nf">most_abundant_mz_is</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if the m/z with the highest intensity is `mz`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">most_abundant_mz</span><span class="p">(),</span> <span class="n">mz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- m/z </span><span class="si">%.03f</span><span class="s1"> is the most abundant? -- </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="n">mz</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="MS2Scan.mz_among_most_abundant"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.mz_among_most_abundant">[docs]</a>    <span class="k">def</span> <span class="nf">mz_among_most_abundant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if an m/z is among the most aboundant `n` fragments</span>
<span class="sd">        in a spectrum.</span>
<span class="sd">        </span>
<span class="sd">        :param float mz: The m/z value.</span>
<span class="sd">        :param int n: The number of most abundant fragments considered.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">mz</span><span class="p">):</span>
                
                <span class="n">result</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- m/z </span><span class="si">%.03f</span><span class="s1"> is among the </span><span class="si">%u</span><span class="s1"> most abundant? -- &#39;</span>\
            <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mz</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="MS2Scan.nl_among_most_abundant"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.nl_among_most_abundant">[docs]</a>    <span class="k">def</span> <span class="nf">nl_among_most_abundant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nl</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if a neutral loss corresponds to one of the</span>
<span class="sd">        most aboundant `n` fragments in a spectrum.</span>
<span class="sd">        </span>
<span class="sd">        :param float nl: The mass of the neutral loss.</span>
<span class="sd">        :param int n: The number of most abundant fragments considered.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms1_mz</span><span class="p">()</span> <span class="o">-</span> <span class="n">nl</span><span class="p">):</span>
                
                <span class="n">result</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- neutral loss </span><span class="si">%.03f</span><span class="s1"> is among &#39;</span>\
            <span class="s1">&#39;the </span><span class="si">%u</span><span class="s1"> most abundant? -- &#39;</span>\
            <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nl</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="MS2Scan.get_intensity"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.get_intensity">[docs]</a>    <span class="k">def</span> <span class="nf">get_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the intensity of a fragment ion from its m/z.</span>
<span class="sd">        Value is `None` if m/z does not present.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_lookup</span><span class="p">(</span><span class="n">mz</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="kc">None</span></div>
    
<div class="viewcode-block" id="MS2Scan.get_nl_intensity"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.get_nl_intensity">[docs]</a>    <span class="k">def</span> <span class="nf">get_nl_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the intensity of a fragment ion from its a neutral loss.</span>
<span class="sd">        Value is `None` if neutral loss does not present.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intensity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms1_mz</span><span class="p">()</span> <span class="o">-</span> <span class="n">nl</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2Scan.mz_percent_of_most_abundant"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.mz_percent_of_most_abundant">[docs]</a>    <span class="k">def</span> <span class="nf">mz_percent_of_most_abundant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz</span><span class="p">,</span> <span class="n">percent</span> <span class="o">=</span> <span class="mf">80.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if an m/z has at least certain percent of intensity</span>
<span class="sd">        compared to the most intensive fragment.</span>
<span class="sd">        </span>
<span class="sd">        :param float mz: The m/z value.</span>
<span class="sd">        :param float percent: The threshold in percent</span>
<span class="sd">                              of the highest intensity.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">insmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="k">for</span> <span class="n">frag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_match</span><span class="p">(</span><span class="n">frag</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mz</span><span class="p">):</span>
                
                <span class="n">result</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
            
            <span class="k">if</span> <span class="n">frag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">insmax</span> <span class="o">*</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="n">percent</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">break</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- m/z </span><span class="si">%.03f</span><span class="s1"> has abundance at least </span><span class="si">%.01f</span><span class="s1"> </span><span class="si">%%</span><span class="s1"> of&#39;</span>\
            <span class="s1">&#39; the highest abundance? -- </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="n">mz</span><span class="p">,</span> <span class="n">percent</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="MS2Scan.fa_type_is"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.fa_type_is">[docs]</a>    <span class="k">def</span> <span class="nf">fa_type_is</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">fa_type</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">uns</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">scan_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if a fatty acid fragment is a specified type. The type</span>
<span class="sd">        should be a part of the string representation of the fragment,</span>
<span class="sd">        e.g. `-O]` for fragments with one oxygen loss.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">ifa</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">scan_index</span><span class="p">:</span>
            <span class="n">ifa</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">i</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span><span class="p">[</span><span class="n">ifa</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">fa_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span> <span class="ow">or</span> <span class="n">fa_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">7</span><span class="p">])</span> <span class="ow">and</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">sphingo</span> <span class="ow">or</span> <span class="s1">&#39;Sphingosine&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">7</span><span class="p">])</span> <span class="ow">and</span>
            <span class="p">(</span><span class="n">uns</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ifa</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span><span class="p">[</span><span class="n">ifa</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">uns</span><span class="p">)</span>
        <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- Fragment #</span><span class="si">%u</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">): fatty acid type &#39;</span>\
            <span class="s1">&#39;is </span><span class="si">%s</span><span class="s1">?  -- </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span> <span class="n">fa_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="MS2Scan.is_fa"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.is_fa">[docs]</a>    <span class="k">def</span> <span class="nf">is_fa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines whether a fragment is fatty acid-like or not.</span>
<span class="sd">        In the labels of fatty acid fragments we always </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;FA&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;Lyso&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span> <span class="ow">or</span> \
            <span class="p">(</span><span class="n">sphingo</span> <span class="ow">and</span> <span class="s1">&#39;Sphi&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">7</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- Fragment #</span><span class="si">%u</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">): is fatty acid? &#39;</span>\
            <span class="s1">&#39;-- </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="MS2Scan.most_abundant_fa"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.most_abundant_fa">[docs]</a>    <span class="k">def</span> <span class="nf">most_abundant_fa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fa_type</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns `True` if there is a fatty acid among the most abundant</span>
<span class="sd">        fragments and it is of the defined type; `False` if there is no</span>
<span class="sd">        fatty acid, or it is different type.</span>
<span class="sd">        </span>
<span class="sd">        :param str fa_type: The type of the fatty acid fragment ion.</span>
<span class="sd">        :param int head: The number of most abundant fragments considered.</span>
<span class="sd">        :param bool sphingo: Look for a sphingolipid backbone.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">head</span><span class="p">:</span>
                
                <span class="k">break</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_fa</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="n">sphingo</span><span class="p">):</span>
                
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_type_is</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">fa_type</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="n">sphingo</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- Having fatty acid </span><span class="si">%s</span><span class="s1"> among </span><span class="si">%u</span><span class="s1"> most abundant &#39;</span>\
            <span class="s1">&#39;features? -- </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fa_type</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="MS2Scan.get_most_abundant_fa"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.get_most_abundant_fa">[docs]</a>    <span class="k">def</span> <span class="nf">get_most_abundant_fa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fa_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Looks up the most abundant fatty acid fragment of the given type.</span>
<span class="sd">        Returns tuple with mz, intensity, carbon count and unsaturation, index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">build_fa_list</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">fa_frag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span><span class="p">[:</span><span class="n">head</span><span class="p">]:</span>
            
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">fa_type</span> <span class="ow">is</span> <span class="kc">None</span>  <span class="ow">or</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fa_type_is</span><span class="p">(</span><span class="n">fa_frag</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">fa_type</span><span class="p">,</span> <span class="n">sphingo</span><span class="p">)</span>
            <span class="p">):</span>
                
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">fa_frag</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="mi">1</span><span class="p">],</span> <span class="n">fa_frag</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">fa_frag</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fa_frag</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>
    
<div class="viewcode-block" id="MS2Scan.fa_cc_among_most_abundant"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.fa_cc_among_most_abundant">[docs]</a>    <span class="k">def</span> <span class="nf">fa_cc_among_most_abundant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns `True` if there is one  fatty acid with the defined</span>
<span class="sd">        carbon count and unsaturation and compatible with the given</span>
<span class="sd">        headgroup among the most abundant `n` fragments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">build_fa_list</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">fa_frag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">fa_frag</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">n</span><span class="p">:</span>
                
                <span class="k">break</span>
            
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">fa_frag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">cc</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">fa_frag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">hg</span> <span class="ow">in</span> <span class="n">fa_frag</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">sphingo</span> <span class="ow">or</span> <span class="n">fa_frag</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="p">):</span>
                
                <span class="k">return</span> <span class="kc">True</span>
        
        <span class="k">return</span> <span class="kc">False</span></div>
    
<div class="viewcode-block" id="MS2Scan.fa_among_most_abundant"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.fa_among_most_abundant">[docs]</a>    <span class="k">def</span> <span class="nf">fa_among_most_abundant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fa_type</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                               <span class="n">min_mass</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                               <span class="n">uns</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns `True` if there is one of the defined type of fatty acid</span>
<span class="sd">        fragments among the given number of most abundant fragments, and</span>
<span class="sd">        it has a mass greater than the given threhold.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">build_fa_list</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fa</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span><span class="p">):</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sphingo</span> <span class="ow">or</span> <span class="n">fa</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">min_mass</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">fa</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_mass</span>
                <span class="p">):</span>
                
                <span class="k">if</span> <span class="n">min_mass</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t\t</span><span class="s1">-- Fragment #</span><span class="si">%u</span><span class="s1"> having mass larger &#39;</span>\
                        <span class="s1">&#39;than </span><span class="si">%.01f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">min_mass</span><span class="p">))</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_type_is</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">fa_type</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="n">sphingo</span><span class="p">,</span>
                                   <span class="n">uns</span> <span class="o">=</span> <span class="n">uns</span><span class="p">,</span> <span class="n">scan_index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="kc">True</span>
            
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
                <span class="k">break</span>
            
            <span class="k">elif</span> <span class="n">min_mass</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t\t</span><span class="s1">-- Fragment #</span><span class="si">%u</span><span class="s1"> having mass lower &#39;</span>\
                        <span class="s1">&#39;than </span><span class="si">%.01f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">min_mass</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- Having fatty acid fragment </span><span class="si">%s</span><span class="s1"> among </span><span class="si">%u</span><span class="s1"> most &#39;</span>\
            <span class="s1">&#39;abundant -- </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fa_type</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="MS2Scan.fa_percent_of_most_abundant"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.fa_percent_of_most_abundant">[docs]</a>    <span class="k">def</span> <span class="nf">fa_percent_of_most_abundant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fa_type</span><span class="p">,</span> <span class="n">percent</span> <span class="o">=</span> <span class="mf">80.0</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_fa</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="n">sphingo</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_type_is</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">fa_type</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="n">sphingo</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">insmax</span> <span class="o">*</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="n">percent</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">False</span></div>
    
<div class="viewcode-block" id="MS2Scan.mz_most_abundant_fold"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.mz_most_abundant_fold">[docs]</a>    <span class="k">def</span> <span class="nf">mz_most_abundant_fold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz</span><span class="p">,</span> <span class="n">fold</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if an m/z is the most abundant fragment</span>
<span class="sd">        and it has at least a certain</span>
<span class="sd">        fold higher intensity than any other fragment.</span>
<span class="sd">        </span>
<span class="sd">        :param float mz: The m/z value.</span>
<span class="sd">        :param float fold: The m/z must be this times higher than any other.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">most_abundant_mz_is</span><span class="p">(</span><span class="n">mz</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">fold</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- m/z </span><span class="si">%.03f</span><span class="s1"> is at least </span><span class="si">%u</span><span class="s1"> times higher than &#39;</span>\
            <span class="s1">&#39;any other? -- </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mz</span><span class="p">,</span> <span class="n">fold</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="MS2Scan.sum_cc_is"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.sum_cc_is">[docs]</a>    <span class="k">def</span> <span class="nf">sum_cc_is</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cc1</span><span class="p">,</span> <span class="n">cc2</span><span class="p">,</span> <span class="n">cc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns `True` if the sum of the 2 carbon counts and</span>
<span class="sd">        unsaturations is equal with the third one.</span>
<span class="sd">        </span>
<span class="sd">        :param tuple cc1: Carbon count and unsaturation 1.</span>
<span class="sd">        :param tuple cc2: Carbon count and unsaturation 2.</span>
<span class="sd">        :param str cc: Expected total carbon count and unsaturation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cc2str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sum_cc</span><span class="p">([</span><span class="n">cc1</span><span class="p">,</span> <span class="n">cc2</span><span class="p">]))</span> <span class="o">==</span> <span class="n">cc</span></div>
    
<div class="viewcode-block" id="MS2Scan.cer_fa_test"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.cer_fa_test">[docs]</a>    <span class="k">def</span> <span class="nf">cer_fa_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frag1</span><span class="p">,</span> <span class="n">frag2</span><span class="p">):</span>
        <span class="k">return</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">fa_type_is</span><span class="p">(</span><span class="n">frag1</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;CerFA(&#39;</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">fa_type_is</span><span class="p">(</span><span class="n">frag2</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;CerSphi-N(&#39;</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="n">frag1</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">frag2</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span></div>
    
<div class="viewcode-block" id="MS2Scan.fa_combinations3"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.fa_combinations3">[docs]</a>    <span class="k">def</span> <span class="nf">fa_combinations3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">expected_intensities</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds all combinations of 3 fatty acids which match the</span>
<span class="sd">        total carbon count and unsaturation resulted by database</span>
<span class="sd">        lookups of the MS1 precursor mass.</span>
<span class="sd">        This can be used for example at TAG.</span>
<span class="sd">        </span>
<span class="sd">        :param str hg: The short name of the headgroup, e.g. `TAG`.</span>
<span class="sd">        :param int head: If `None` or `numpy.inf` all fragment ions</span>
<span class="sd">                         will be considered, otherwise only the first</span>
<span class="sd">                         most aboundant until the number `head`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="n">hg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">[</span><span class="n">hg</span><span class="p">]):</span>
            <span class="n">ccs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">[</span><span class="n">hg</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>
        
        <span class="n">head</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="k">if</span> <span class="n">head</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">head</span>
        
        <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">ccs</span><span class="p">:</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="n">icc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cc2int</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">continue</span>
            
            <span class="k">for</span> <span class="n">frag0</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span><span class="p">:</span>
                
                <span class="k">if</span> <span class="n">frag0</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">head</span><span class="p">:</span>
                    <span class="k">break</span>
                
                <span class="n">cc0</span> <span class="o">=</span> <span class="n">frag0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                
                <span class="n">cc12e</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                            <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">icc</span><span class="p">,</span> <span class="n">cc0</span><span class="p">])))</span>
                
                <span class="n">cc12s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations_tuples</span><span class="p">(</span><span class="n">cc12e</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="n">head</span><span class="p">,</span> <span class="n">by_cc</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                
                <span class="k">for</span> <span class="n">cc12</span> <span class="ow">in</span> <span class="n">cc12s</span><span class="p">:</span>
                    
                    <span class="n">cc012</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cc12</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cc2str</span><span class="p">(</span><span class="n">cc0</span><span class="p">)]))</span>
                    
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_cc_str</span><span class="p">(</span><span class="n">cc012</span><span class="p">)</span> <span class="o">==</span> <span class="n">icc</span><span class="p">:</span>
                    
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_ratios</span><span class="p">([</span>
                            <span class="p">(</span><span class="n">cc12</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">cc12</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
                            <span class="p">(</span><span class="n">cc12</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">cc12</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                            <span class="p">(</span><span class="n">frag0</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">frag0</span><span class="p">[</span><span class="mi">5</span><span class="p">])],</span>
                            <span class="n">expected</span> <span class="o">=</span> <span class="n">expected_intensities</span>
                        <span class="p">):</span>
                            
                            <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cc012</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="MS2Scan.intensity_ratios"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.intensity_ratios">[docs]</a>    <span class="k">def</span> <span class="nf">intensity_ratios</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intensities</span><span class="p">,</span> <span class="n">expected</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">logbase</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tells if the ratio of a list of intensities fits</span>
<span class="sd">        the one in `expected` or is even if `expected` is `None`.</span>
<span class="sd">        </span>
<span class="sd">        :param list intensities: List of tuples, first element is the</span>
<span class="sd">                                 intensity, the second is an uniqe</span>
<span class="sd">                                 identifier of the fragments.</span>
<span class="sd">        :param list expected: List with expected intensity proportions.</span>
<span class="sd">                              E.g. `[1, 1, 2]` means the third ion is</span>
<span class="sd">                              twice higher intense than the 2 others.</span>
<span class="sd">        :param int logbase: The fold difference tolerance when comparing</span>
<span class="sd">                            intensities. E.g. if this is 2, then an almost</span>
<span class="sd">                            twice less or more intense ion will considered</span>
<span class="sd">                            to have similar intensity.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">intensities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            
            <span class="k">return</span> <span class="kc">True</span>
        
        <span class="n">i</span> <span class="o">=</span> <span class="n">intensities</span>
        
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ii</span><span class="p">:</span> <span class="n">ii</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">i</span><span class="p">)):</span>
            
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="c1"># to know if one fragment contributes more than one times;</span>
        <span class="c1"># intensities divided by the times the fragment is incident</span>
        <span class="n">cntr</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ii</span><span class="p">:</span> <span class="n">ii</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">i</span><span class="p">))</span>
        
        <span class="c1"># by default expecting more or less equal intensities</span>
        <span class="k">if</span> <span class="n">expected</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        
        <span class="n">i</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">ii</span><span class="p">:</span>
                    <span class="p">(</span><span class="n">ii</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">expected</span><span class="p">[</span><span class="n">ii</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="n">cntr</span><span class="p">[</span><span class="n">ii</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">ii</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                <span class="nb">enumerate</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">all</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">co</span><span class="p">:</span>
                        <span class="p">(</span>
                            <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">co</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">logbase</span><span class="p">)</span> <span class="o">-</span>
                            <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">co</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">logbase</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">1</span>
                        <span class="p">),</span>
                    <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2Scan.fa_combinations_old"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.fa_combinations_old">[docs]</a>    <span class="k">def</span> <span class="nf">fa_combinations_old</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">head</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">by_cc</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds all combinations of 2 fatty acids which match the</span>
<span class="sd">        total carbon count and unsaturation resulted by database</span>
<span class="sd">        lookups of the MS1 precursor mass.</span>
<span class="sd">        Alternatively a carbon count and unsaturation can be provided</span>
<span class="sd">        if `by_cc` is set to `True`.</span>
<span class="sd">        </span>
<span class="sd">        :param str hg: Short name of the headgroup, e.g. `PC`; or cc:unsat e.g.</span>
<span class="sd">                       `32:1` if `by_cc` is `True`.</span>
<span class="sd">        :param bool sphingo: Assume sphingolipid.</span>
<span class="sd">        :param int head: If `None` the total fragment list used, if a number,</span>
<span class="sd">                         only the most intensive fragments accordingly.</span>
<span class="sd">        :param bool by_cc: Use the MS1 database identification to find out</span>
<span class="sd">                           the possible carbon counts and unsaturations for</span>
<span class="sd">                           the given headgroup, or a cc:uns provided and</span>
<span class="sd">                           search combinations accordingly.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="k">if</span> <span class="n">hg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">[</span><span class="n">hg</span><span class="p">]):</span>
            <span class="n">ccs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">[</span><span class="n">hg</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">by_cc</span><span class="p">:</span>
            <span class="n">ccs</span> <span class="o">=</span> <span class="p">[</span><span class="n">hg</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>
        
        <span class="n">head</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="k">if</span> <span class="n">head</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">head</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">build_fa_list</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">ccs</span><span class="p">:</span>
            
            <span class="k">for</span> <span class="n">frag1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span><span class="p">:</span>
                
                <span class="k">for</span> <span class="n">frag2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span><span class="p">:</span>
                    
                    <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_fa_combinations</span><span class="p">(</span><span class="n">frag1</span><span class="p">,</span> <span class="n">frag2</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span>
                                                <span class="n">cc</span><span class="p">,</span> <span class="n">sphingo</span><span class="p">,</span> <span class="n">head</span><span class="p">)</span>
                    <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="MS2Scan.fa_combinations_preprocess"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.fa_combinations_preprocess">[docs]</a>    <span class="k">def</span> <span class="nf">fa_combinations_preprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regenerate</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a lookup table for all possible combinations of two</span>
<span class="sd">        fatty acids.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;fa_co_2&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">regenerate</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">fa_co_2</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span>
            
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations_with_replacement</span><span class="p">(</span>
                <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span><span class="p">)),</span> <span class="mi">2</span><span class="p">):</span>
                
                <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_cc</span><span class="p">([(</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                                   <span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])])</span>
                
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_co_2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fa_co_2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">fa_co_2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="MS2Scan.fa_combinations"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.fa_combinations">[docs]</a>    <span class="k">def</span> <span class="nf">fa_combinations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                               <span class="n">head</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">by_cc</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds all combinations of 2 fatty acids which match the</span>
<span class="sd">        total carbon count and unsaturation resulted by database</span>
<span class="sd">        lookups of the MS1 precursor mass.</span>
<span class="sd">        Alternatively a carbon count and unsaturation can be provided</span>
<span class="sd">        if `by_cc` is set to `True`.</span>
<span class="sd">        </span>
<span class="sd">        This method does the same as `fa_combinations` but works with</span>
<span class="sd">        a preprocessed lookup table.</span>
<span class="sd">        </span>
<span class="sd">        Returns set of strings.</span>
<span class="sd">        </span>
<span class="sd">        :param str hg: Short name of the headgroup, e.g. `PC`; or cc:unsat e.g.</span>
<span class="sd">                       `32:1` if `by_cc` is `True`.</span>
<span class="sd">        :param bool sphingo: Assume sphingolipid.</span>
<span class="sd">        :param int head: If `None` the total fragment list used, if a number,</span>
<span class="sd">                         only the most intensive fragments accordingly.</span>
<span class="sd">        :param bool by_cc: Use the MS1 database identification to find out</span>
<span class="sd">                           the possible carbon counts and unsaturations for</span>
<span class="sd">                           the given headgroup, or a cc:uns provided and</span>
<span class="sd">                           search combinations accordingly.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">co</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">co</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations_tuples</span><span class="p">(</span><span class="n">hg</span><span class="p">,</span> <span class="n">sphingo</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="n">by_cc</span><span class="p">)))</span></div>
    
    
<div class="viewcode-block" id="MS2Scan.fa_combinations_tuples"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.fa_combinations_tuples">[docs]</a>    <span class="k">def</span> <span class="nf">fa_combinations_tuples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                               <span class="n">head</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">by_cc</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds all combinations of 2 fatty acids which match the</span>
<span class="sd">        total carbon count and unsaturation resulted by database</span>
<span class="sd">        lookups of the MS1 precursor mass.</span>
<span class="sd">        Alternatively a carbon count and unsaturation can be provided</span>
<span class="sd">        if `by_cc` is set to `True`.</span>
<span class="sd">        </span>
<span class="sd">        Returns tuples of tuples with carbon count/unsaturation,</span>
<span class="sd">        intensities and indices.</span>
<span class="sd">        </span>
<span class="sd">        :param str hg: Short name of the headgroup, e.g. `PC`; or cc:unsat e.g.</span>
<span class="sd">                       `32:1` if `by_cc` is `True`.</span>
<span class="sd">        :param bool sphingo: Assume sphingolipid.</span>
<span class="sd">        :param int head: If `None` the total fragment list used, if a number,</span>
<span class="sd">                         only the most intensive fragments accordingly.</span>
<span class="sd">        :param bool by_cc: Use the MS1 database identification to find out</span>
<span class="sd">                           the possible carbon counts and unsaturations for</span>
<span class="sd">                           the given headgroup, or a cc:uns provided and</span>
<span class="sd">                           search combinations accordingly.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">hg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">[</span><span class="n">hg</span><span class="p">]):</span>
            <span class="n">ccs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">[</span><span class="n">hg</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">by_cc</span><span class="p">:</span>
            <span class="n">ccs</span> <span class="o">=</span> <span class="p">[</span><span class="n">hg</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>
        
        <span class="n">head</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="k">if</span> <span class="n">head</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">head</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">build_fa_list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations_preprocess</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">ccs</span><span class="p">:</span>
            
            <span class="n">icc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cc2int</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">icc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_co_2</span><span class="p">:</span>
                
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_co_2</span><span class="p">[</span><span class="n">icc</span><span class="p">]:</span>
                    
                    <span class="n">frag1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">frag2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    
                    <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_fa_combinations</span><span class="p">(</span><span class="n">frag1</span><span class="p">,</span> <span class="n">frag2</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span>
                                                 <span class="n">cc</span><span class="p">,</span> <span class="n">sphingo</span><span class="p">,</span> <span class="n">head</span><span class="p">)</span>
                    <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="MS2Scan.get_fa_combinations"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.get_fa_combinations">[docs]</a>    <span class="k">def</span> <span class="nf">get_fa_combinations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frag1</span><span class="p">,</span> <span class="n">frag2</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">sphingo</span><span class="p">,</span> <span class="n">head</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes two fatty acid fragments to decide</span>
<span class="sd">        if their combination is valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">frag1</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">head</span> <span class="ow">or</span> <span class="n">frag2</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">head</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>
        
        <span class="k">if</span> <span class="n">hg</span> <span class="o">==</span> <span class="s1">&#39;Cer&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cer_fa_test</span><span class="p">(</span><span class="n">frag1</span><span class="p">,</span> <span class="n">frag2</span><span class="p">):</span>
            <span class="c1"># where not the &#39;CerFA&#39; is the most intensive</span>
            <span class="c1"># those are clearly false</span>
            <span class="k">return</span> <span class="n">result</span>
        
        <span class="k">if</span> <span class="n">frag1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">frag2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">frag1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">hg</span> <span class="ow">in</span> <span class="n">frag1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">frag2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">hg</span> <span class="ow">in</span> <span class="n">frag2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="ow">not</span> <span class="n">sphingo</span> <span class="ow">or</span> <span class="n">frag1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">or</span> <span class="n">frag2</span><span class="p">[</span><span class="mi">3</span><span class="p">]):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_cc_is</span><span class="p">(</span><span class="n">frag1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">frag2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cc</span><span class="p">):</span>
                <span class="n">ether_1</span> <span class="o">=</span> <span class="s1">&#39;O-&#39;</span> <span class="k">if</span> <span class="n">frag1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                <span class="n">ether_2</span> <span class="o">=</span> <span class="s1">&#39;O-&#39;</span> <span class="k">if</span> <span class="n">frag2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                <span class="n">fa_1</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ether_1</span><span class="p">,</span> <span class="n">frag1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">frag1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">fa_2</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ether_2</span><span class="p">,</span> <span class="n">frag2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">frag2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">frag1</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                    <span class="n">fa_1</span> <span class="o">=</span> <span class="s1">&#39;d</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fa_1</span>
                <span class="k">elif</span> <span class="n">frag2</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                    <span class="n">sph</span> <span class="o">=</span> <span class="s1">&#39;d</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fa_2</span>
                    <span class="n">fa_2</span> <span class="o">=</span> <span class="n">fa_1</span>
                    <span class="n">fa_1</span> <span class="o">=</span> <span class="n">sph</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">frag1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">frag2</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                    <span class="n">fa</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">([</span><span class="n">fa_1</span><span class="p">,</span> <span class="n">fa_2</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fa</span> <span class="o">=</span> <span class="p">(</span><span class="n">fa_1</span><span class="p">,</span> <span class="n">fa_2</span><span class="p">)</span>
                
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span>
                    <span class="n">fa</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">frag1</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">frag2</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                    <span class="p">(</span><span class="n">frag1</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">frag2</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                <span class="p">))</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="MS2Scan.matching_fa_frags_of_type"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.matching_fa_frags_of_type">[docs]</a>    <span class="k">def</span> <span class="nf">matching_fa_frags_of_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">return_details</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns carbon counts of those fragments which are of the given type</span>
<span class="sd">        and have complement fatty acid fragment of any type.</span>
<span class="sd">        </span>
<span class="sd">        Details is a dict with carbon counts as keys</span>
<span class="sd">        and fragment names as values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="n">details</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">if</span> <span class="n">hg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">[</span><span class="n">hg</span><span class="p">]):</span>
            
            <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">[</span><span class="n">hg</span><span class="p">]:</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">build_fa_list</span><span class="p">()</span>
                
                <span class="k">for</span> <span class="n">frag1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span><span class="p">:</span>
                    
                    <span class="k">for</span> <span class="n">frag2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span><span class="p">:</span>
                        
                        <span class="k">if</span> <span class="n">frag1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
                            <span class="n">frag2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
                            <span class="p">(</span><span class="n">frag1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">hg</span> <span class="ow">in</span> <span class="n">frag1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> \
                            <span class="p">(</span><span class="n">frag2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">hg</span> <span class="ow">in</span> <span class="n">frag2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> \
                            <span class="p">(</span><span class="ow">not</span> <span class="n">sphingo</span> <span class="ow">or</span> <span class="n">frag1</span><span class="p">[</span><span class="mi">3</span><span class="p">]):</span>
                            
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_type_is</span><span class="p">(</span><span class="n">frag1</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">typ</span><span class="p">)</span> <span class="ow">and</span> \
                                <span class="bp">self</span><span class="o">.</span><span class="n">sum_cc_is</span><span class="p">(</span><span class="n">frag1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">frag2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cc</span><span class="p">):</span>
                                
                                <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">frag1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                                
                                <span class="k">if</span> <span class="n">return_details</span><span class="p">:</span>
                                    
                                    <span class="k">if</span> <span class="n">frag1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">details</span><span class="p">:</span>
                                        
                                        <span class="n">details</span><span class="p">[</span><span class="n">frag1</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
                                    
                                    <span class="n">details</span><span class="p">[</span><span class="n">frag1</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">frag2</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="mi">7</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="n">return_details</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">details</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="MS2Scan.cer_missing_fa"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.cer_missing_fa">[docs]</a>    <span class="k">def</span> <span class="nf">cer_missing_fa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cer_hg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Infers the fatty acid carbon count and unsaturation</span>
<span class="sd">        by subtracting the sphingoid backbone from the total.</span>
<span class="sd">        This works with Cer, CerP and HexCer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="n">cer_ccs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">for</span> <span class="n">frag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
            
            <span class="k">if</span> <span class="s1">&#39;phingo&#39;</span> <span class="ow">in</span> <span class="n">frag</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span>
                
                <span class="n">cer_ccs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cc</span><span class="p">(</span><span class="n">frag</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
        
        <span class="k">if</span> <span class="n">cer_hg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">:</span>
            
            <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">[</span><span class="n">cer_hg</span><span class="p">]:</span>
                
                <span class="n">cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cc</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
                
                <span class="k">for</span> <span class="n">cer_cc</span> <span class="ow">in</span> <span class="n">cer_ccs</span><span class="p">:</span>
                    
                    <span class="n">carb</span> <span class="o">=</span> <span class="n">cc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">cer_cc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">unsat</span> <span class="o">=</span> <span class="n">cc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">cer_cc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    
                    <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;d</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">/</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">cer_cc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cer_cc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">carb</span><span class="p">,</span> <span class="n">unsat</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="MS2Scan.cer_matching_fa"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.cer_matching_fa">[docs]</a>    <span class="k">def</span> <span class="nf">cer_matching_fa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cer_fa</span><span class="p">):</span>
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="s1">&#39;Cer&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">:</span>
            <span class="n">cer_cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cc</span><span class="p">(</span><span class="n">cer_fa</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">[</span><span class="s1">&#39;Cer&#39;</span><span class="p">]:</span>
                <span class="n">cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cc</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
                <span class="n">carb</span> <span class="o">=</span> <span class="n">cc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">cer_cc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">unsat</span> <span class="o">=</span> <span class="n">cc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">cer_cc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frag_name_present</span><span class="p">(</span>
                    <span class="s1">&#39;[FA-alkyl(C</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">)-H]-&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">carb</span><span class="p">,</span> <span class="n">unsat</span><span class="p">)):</span>
                    <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">carb</span> <span class="o">=</span> <span class="n">cc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">cer_cc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span>
                <span class="n">unsat</span> <span class="o">=</span> <span class="n">cc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">cer_cc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frag_name_present</span><span class="p">(</span>
                    <span class="s1">&#39;[FA-alkyl(C</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">)-H]-&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">carb</span><span class="p">,</span> <span class="n">unsat</span><span class="p">)):</span>
                    <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">score</span></div>
    
<div class="viewcode-block" id="MS2Scan.build_fa_list"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.build_fa_list">[docs]</a>    <span class="k">def</span> <span class="nf">build_fa_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rebuild</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns list with elements:</span>
<span class="sd">            carbon count, headgroups (set or None),</span>
<span class="sd">            esther (False) or ether (True),</span>
<span class="sd">            sphingosine (True) or fatty acid (False),</span>
<span class="sd">            fragment intensity and row index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rebuild</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">frag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">frag</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;unknown&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_fa</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
                    <span class="n">cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cc</span><span class="p">(</span><span class="n">frag</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
                    <span class="n">hgs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_hg</span><span class="p">(</span><span class="n">frag</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
                    <span class="n">is_ether</span> <span class="o">=</span> <span class="s1">&#39;alk&#39;</span> <span class="ow">in</span> <span class="n">frag</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
                    <span class="n">is_sphingo</span> <span class="o">=</span> <span class="s1">&#39;Sphi&#39;</span> <span class="ow">in</span> <span class="n">frag</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">cc</span><span class="p">,</span> <span class="n">hgs</span><span class="p">,</span> <span class="n">is_ether</span><span class="p">,</span> <span class="n">is_sphingo</span><span class="p">,</span> <span class="n">frag</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">i</span><span class="p">])</span></div>
    
<div class="viewcode-block" id="MS2Scan.get_hg"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.get_hg">[docs]</a>    <span class="k">def</span> <span class="nf">get_hg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frag_name</span><span class="p">):</span>
        <span class="n">hgfrags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">nHgfrags</span> \
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;neg&#39;</span> \
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">pHgfrags</span>
        <span class="k">return</span> <span class="n">hgfrags</span><span class="p">[</span><span class="n">frag_name</span><span class="p">]</span> \
            <span class="k">if</span> <span class="n">frag_name</span> <span class="ow">in</span> <span class="n">hgfrags</span> <span class="ow">and</span> \
                <span class="nb">len</span><span class="p">(</span><span class="n">hgfrags</span><span class="p">[</span><span class="n">frag_name</span><span class="p">])</span> \
            <span class="k">else</span> <span class="kc">None</span></div>
    
<div class="viewcode-block" id="MS2Scan.get_cc"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.get_cc">[docs]</a>    <span class="k">def</span> <span class="nf">get_cc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fa</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts carbon count from any string, for example fatty acid names.</span>
<span class="sd">        Recognizes the pattern [number:number].</span>
<span class="sd">        E.g. from `Phosphatidylcholine (36:1)` returns the tuple `(36, 1)`.</span>
<span class="sd">        To convert pure cc:uns strings, use the method `cc2int` instead,</span>
<span class="sd">        as that one is faster.</span>
<span class="sd">        </span>
<span class="sd">        :param str fa: Any string containing carbon count and unsaturation.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recc</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">fa</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()))</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2Scan.most_abundant_fa_cc"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.most_abundant_fa_cc">[docs]</a>    <span class="k">def</span> <span class="nf">most_abundant_fa_cc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fa_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">fa_cc</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">frag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">head</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_fa</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">fa_type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fa_type_is</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">fa_type</span><span class="p">)</span>
                <span class="p">):</span>
                
                <span class="n">cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cc</span><span class="p">(</span><span class="n">frag</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">cc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">fa_cc</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">cc</span><span class="p">,</span> <span class="n">frag</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        
        <span class="k">return</span> <span class="n">fa_cc</span></div>
    
<div class="viewcode-block" id="MS2Scan.cc2str"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.cc2str">[docs]</a>    <span class="k">def</span> <span class="nf">cc2str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts carbon count and unsaturation from tuple of integers</span>
<span class="sd">        to string. E.g. `(18, 1)` results `18:1`.</span>
<span class="sd">        </span>
<span class="sd">        :param tuple cc: Tuple of 2 integers representing carbon count</span>
<span class="sd">                         and unsaturation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cc</span></div>
    
<div class="viewcode-block" id="MS2Scan.ccs2str"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.ccs2str">[docs]</a>    <span class="k">def</span> <span class="nf">ccs2str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ccs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts multiple carbon counts and unsaturations from tuples</span>
<span class="sd">        of integers format to string. E.g. `[(18, 1), (18, 0)]` results</span>
<span class="sd">        `18:1/18:0`.</span>
<span class="sd">        </span>
<span class="sd">        :param list ccs: List of tuples of integers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cc2str</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ccs</span><span class="p">)))</span></div>
    
<div class="viewcode-block" id="MS2Scan.cc2int"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.cc2int">[docs]</a>    <span class="k">def</span> <span class="nf">cc2int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts carbon count and unsaturation from string format to</span>
<span class="sd">        tuple of integers. E.g. `18:1` results `(18, 1)`.</span>
<span class="sd">        </span>
<span class="sd">        :param str cc: String representing carbon count and unsaturation</span>
<span class="sd">                       separated by colon.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)))</span></div>
    
<div class="viewcode-block" id="MS2Scan.ccs2int"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.ccs2int">[docs]</a>    <span class="k">def</span> <span class="nf">ccs2int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ccs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a string of multiple carbon counts and unsaturations</span>
<span class="sd">        to a list of tuples of integers.</span>
<span class="sd">        </span>
<span class="sd">        :param str ccs: Multiple carbon counts and unsaturations in string</span>
<span class="sd">                        representation, e.g. `18:1/16:0`.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cc2int</span><span class="p">,</span> <span class="n">ccs</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)))</span></div>
    
<div class="viewcode-block" id="MS2Scan.sum_cc_str"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.sum_cc_str">[docs]</a>    <span class="k">def</span> <span class="nf">sum_cc_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ccs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the sum of multiple carbon counts and unsaturations.</span>
<span class="sd">        Accepts string format and results string format.</span>
<span class="sd">        </span>
<span class="sd">        :param str ccs: Multiple carbon counts and unsaturations in string</span>
<span class="sd">                        representation, e.g. `18:1/16:0`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_cc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ccs2int</span><span class="p">(</span><span class="n">ccs</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="MS2Scan.sum_cc"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.sum_cc">[docs]</a>    <span class="k">def</span> <span class="nf">sum_cc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ccs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds numeric carbon counts and unsaturations.</span>
<span class="sd">        Accepts a list of tuples of integers, returns</span>
<span class="sd">        a tuple of integers.</span>
<span class="sd">        </span>
<span class="sd">        :param list ccs: A list with tuples of integers,</span>
<span class="sd">                         e.g. `[(14, 1), (16, 0)]`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">tuple</span><span class="p">(</span>
                <span class="n">reduce</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">cu1</span><span class="p">,</span> <span class="n">cu2</span><span class="p">:</span>
                        <span class="c1"># here `cu`: carbon count and unsaturation</span>
                        <span class="p">(</span><span class="n">cu1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">cu2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cu1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">cu2</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="n">ccs</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2Scan.sum_cc2"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.sum_cc2">[docs]</a>    <span class="k">def</span> <span class="nf">sum_cc2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ccs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the total carbon count and unsaturation in tuple</span>
<span class="sd">        format from a list of tuples where the first element of</span>
<span class="sd">        the tuple is another tuple with the cc and uns, and the</span>
<span class="sd">        second is the intensity, which is discarded here.</span>
<span class="sd">        </span>
<span class="sd">        :param list ccs: List of the format described above. E.g.</span>
<span class="sd">                         `[((16, 0), 1000.0), ((18, 1), 722)]`, this</span>
<span class="sd">                         results `(34, 1)`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_cc</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">cci</span><span class="p">:</span> <span class="n">cci</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ccs</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="MS2Scan.sum_cc2str"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.sum_cc2str">[docs]</a>    <span class="k">def</span> <span class="nf">sum_cc2str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ccs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the total carbon count and unsaturation in string</span>
<span class="sd">        format from a list of tuples where the first element of</span>
<span class="sd">        the tuple is another tuple with the cc and uns, and the</span>
<span class="sd">        second is the intensity, which is discarded here.</span>
<span class="sd">        </span>
<span class="sd">        :param list ccs: List of the format described above. E.g.</span>
<span class="sd">                         `[((16, 0), 1000.0), ((18, 1), 722)]`, this</span>
<span class="sd">                         results `34:1`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cc2str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sum_cc2</span><span class="p">(</span><span class="n">ccs</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="MS2Scan.add_fa1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.add_fa1">[docs]</a>    <span class="k">def</span> <span class="nf">add_fa1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fa</span><span class="p">,</span> <span class="n">hg</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">hg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fa1</span><span class="p">[</span><span class="n">hg</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fa1</span><span class="p">[</span><span class="n">hg</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="nb">tuple</span><span class="p">(</span>
                    <span class="nb">map</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">fai</span><span class="p">:</span>
                            <span class="n">fai</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">fa</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">fastr</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="nb">map</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">fai</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cc2str</span><span class="p">(</span><span class="n">fai</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="n">fa</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- Adding fatty acids </span><span class="si">%s</span><span class="s1"> at headgroup &#39;</span>\
                <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fastr</span><span class="p">,</span> <span class="n">hg</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="MS2Scan.fa_ccs_agree_ms1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.fa_ccs_agree_ms1">[docs]</a>    <span class="k">def</span> <span class="nf">fa_ccs_agree_ms1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">fa_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">fa_cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">most_abundant_fa_cc</span><span class="p">(</span><span class="n">fa_type</span> <span class="o">=</span> <span class="n">fa_type</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="n">head</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fa_cc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_cc2str</span><span class="p">([</span><span class="n">fa_cc</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">agr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_cc_agrees_ms1</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">hg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">agr</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_fa1</span><span class="p">(</span><span class="n">fa_cc</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="n">hg</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fa_cc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_cc2str</span><span class="p">(</span><span class="n">fa_cc</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">agr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_cc_agrees_ms1</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">hg</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">agr</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_fa1</span><span class="p">(</span><span class="n">fa_cc</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">hg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">hg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span></div>
    
<div class="viewcode-block" id="MS2Scan.fa_cc_agrees_ms1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.fa_cc_agrees_ms1">[docs]</a>    <span class="k">def</span> <span class="nf">fa_cc_agrees_ms1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">hg</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">hg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span> <span class="ow">and</span> <span class="n">cc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">[</span><span class="n">hg</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">hg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">fa</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="n">hg</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
            <span class="k">if</span> <span class="n">hg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="n">hg</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="n">hg</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="n">hg</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">  -- Carbon count from MS2: </span><span class="si">%s</span><span class="s1">; from databases &#39;</span>\
            <span class="s1">&#39;lookup: </span><span class="si">%s</span><span class="s1"> -- Any of these matches: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span>
                    <span class="n">cc</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">[</span><span class="n">hg</span><span class="p">])</span> \
                        <span class="k">if</span> <span class="n">hg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span> <span class="k">else</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="MS2Scan.frag_name_present"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.frag_name_present">[docs]</a>    <span class="k">def</span> <span class="nf">frag_name_present</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        
        <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[:,</span><span class="mi">7</span><span class="p">]</span></div>
    
    <span class="c1">#### New methods</span>
    
<div class="viewcode-block" id="MS2Scan.cer1p_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.cer1p_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">cer1p_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is a Ceramide-1-phosphate.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - GLTPD1 - 616.47</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - The most abundant fragment is 78.9591 metaphosphate.</span>
<span class="sd">      - If 96.9696 phosphate present adds to the score.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">most_abundant_mz_is</span><span class="p">(</span><span class="mf">78.95905658</span><span class="p">):</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">96.96962158</span><span class="p">):</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.hexcer_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.hexcer_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">hexcer_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is a Hexosyl-Ceramide.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - GLTP - 744.5627</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - Hexose fragments 71.0115, 89.0220 and 101.0219 must present.</span>
<span class="sd">      </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">mz</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_among_most_abundant</span><span class="p">(</span><span class="n">mz</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">10</span><span class="p">),</span>
                   <span class="c1"># these are 3 fragments found at GLTP</span>
                   <span class="p">[</span><span class="mf">71.0115000</span><span class="p">,</span> <span class="mf">89.0220000</span><span class="p">,</span> <span class="mf">101.021900</span><span class="p">])):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.hexceroh_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.hexceroh_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">hexceroh_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is a Hexosyl-Ceramide-OH</span>
<span class="sd">        (&#39;t&#39;). This method is the same as `hexcer_neg_1`.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - GLTP - 760.557</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - Hexose fragments 71.0115, 89.0220 and 101.0219 must present.</span>
<span class="sd">      </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hexcer_neg_1</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="MS2Scan.hexcer_pos_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.hexcer_pos_1">[docs]</a>    <span class="k">def</span> <span class="nf">hexcer_pos_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a positive mode MS2 spectrum is a Hexosyl-Ceramide.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - GLTP + 810.68</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - Hexose fragments 198.0740, 180.0634 and 162.0528 must present.</span>
<span class="sd">      </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="n">hexfrags</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">nl</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nl_among_most_abundant</span><span class="p">(</span><span class="n">nl</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">15</span><span class="p">),</span>
                           <span class="p">[</span><span class="mf">198.073955</span><span class="p">,</span> <span class="mf">180.06339</span><span class="p">,</span> <span class="mf">162.052825</span><span class="p">]))</span>
        
        <span class="k">if</span> <span class="n">hexfrags</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="n">hexfrags</span> <span class="o">+</span> <span class="mi">4</span>
        
        <span class="k">if</span> <span class="n">score</span><span class="p">:</span>
            
            <span class="n">fattya</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cer_missing_fa</span><span class="p">(</span><span class="s1">&#39;HexCer&#39;</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.hexceroh_pos_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.hexceroh_pos_1">[docs]</a>    <span class="k">def</span> <span class="nf">hexceroh_pos_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a positive mode MS2 spectrum is a Hexosyl-Ceramide-OH</span>
<span class="sd">        (`t`). This method is the same as `hexcer_pos_1`.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - GLTP + 826.67</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - Hexose fragments 198.0740, 180.0634 and 162.0528 must present.</span>
<span class="sd">      </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hexcer_pos_1</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="MS2Scan.cer1p_pos_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.cer1p_pos_1">[docs]</a>    <span class="k">def</span> <span class="nf">cer1p_pos_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a positive mode MS2 spectrum is a Ceramide-1-phosphate.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - GLTPD1 + 728.59</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - A shpingosine backbone with 2 H2O loss must be among the 3 highest</span>
<span class="sd">        intensity fragments.</span>
<span class="sd">        - Presence of any of the following fragments increases the score:</span>
<span class="sd">        82.0651, 107.0729, 135.1043, 149.1199.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_among_most_abundant</span><span class="p">(</span><span class="s1">&#39;-H2O-H2O+]+&#39;</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">4</span>
            
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">,</span>
                       <span class="c1"># these present at Cer too</span>
                       <span class="c1"># a specific difference needed!</span>
                       <span class="p">[</span><span class="mf">82.0651257</span><span class="p">,</span> <span class="mf">107.072951</span><span class="p">,</span> <span class="mf">135.104251</span><span class="p">,</span> <span class="mf">149.119901</span><span class="p">])):</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="n">fattya</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cer_missing_fa</span><span class="p">(</span><span class="s1">&#39;Cer1P&#39;</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.dag_pos_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.dag_pos_1">[docs]</a>    <span class="k">def</span> <span class="nf">dag_pos_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a positive mode MS2 spectrum is a DAG.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - SEC14L2 + 584.52</span>
<span class="sd">      - in vitro: BNIP2 + 770.67</span>
<span class="sd">        </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - Combination of fatty acid fragments among the 10 most abundant</span>
<span class="sd">        fragments must match the expected carbon count and unsaturation.</span>
<span class="sd">        - If these are among the 5 highest fragments the score is higher.</span>
<span class="sd">      </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations</span><span class="p">(</span><span class="s1">&#39;DAG&#39;</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)):</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">4</span>
            
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations</span><span class="p">(</span><span class="s1">&#39;DAG&#39;</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)):</span>
                
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">2</span>
            
            <span class="n">fattya</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations</span><span class="p">(</span><span class="s1">&#39;DAG&#39;</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.dag_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.dag_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">dag_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is a DAG.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - We don&#39;t have yet.</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - Combination of fatty acid fragments among the 10 most abundant</span>
<span class="sd">        fragments must match the expected carbon count and unsaturation.</span>
<span class="sd">        - If these are among the 5 highest fragments the score is higher.</span>
<span class="sd">      </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations</span><span class="p">(</span><span class="s1">&#39;DAG&#39;</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)):</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">4</span>
            
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations</span><span class="p">(</span><span class="s1">&#39;DAG&#39;</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)):</span>
                
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">2</span>
            
            <span class="n">fattya</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations</span><span class="p">(</span><span class="s1">&#39;DAG&#39;</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.tag_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.tag_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">tag_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is a TAG.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - We don&#39;t have yet.</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - Combination of fatty acid fragments must match the</span>
<span class="sd">        expected carbon count and unsaturation.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="n">fattya</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations3</span><span class="p">(</span><span class="s1">&#39;TAG&#39;</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">fattya</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.tag_pos_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.tag_pos_1">[docs]</a>    <span class="k">def</span> <span class="nf">tag_pos_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a positive mode MS2 spectrum is a TAG.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - STARD11 + 818.7187</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - Combination of fatty acid fragments must match the expected</span>
<span class="sd">        carbon count and unsaturation.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="n">fattya</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations3</span><span class="p">(</span><span class="s1">&#39;TAG&#39;</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">fattya</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.pi_pos_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.pi_pos_1">[docs]</a>    <span class="k">def</span> <span class="nf">pi_pos_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative MS2 spectrum is Phosphatidylinositol.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - SEC14L2 + 906.60 and 882.6</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - Combinations of fatty acid fragments must match the expected</span>
<span class="sd">        carbon count and unsaturation for PI.</span>
<span class="sd">        - Presence of neutral losses 259.0219 and 277.0563 adds to the score.</span>
<span class="sd">      </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="n">fattya</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations</span><span class="p">(</span><span class="s1">&#39;PI&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">fattya</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_nl</span><span class="p">(</span><span class="mf">259.021894</span><span class="p">):</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">4</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_nl</span><span class="p">(</span><span class="mf">277.056272</span><span class="p">):</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">4</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.ps_pos_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.ps_pos_1">[docs]</a>    <span class="k">def</span> <span class="nf">ps_pos_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a positive mode MS2 spectrum is a Phosphatidylserine.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - BPI + 790.56</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - PS headgroup neutral loss 185.0089 must be the highest intensity.</span>
<span class="sd">      </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nl_among_most_abundant</span><span class="p">(</span><span class="mf">185.008927</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="n">fattya</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations</span><span class="p">(</span><span class="s1">&#39;PS&#39;</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.bmp_pos_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.bmp_pos_1">[docs]</a>    <span class="k">def</span> <span class="nf">bmp_pos_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a positive mode MS2 spectrum</span>
<span class="sd">        is a Bismonoacylglycerophosphate.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - BPIFB2 + 792.57</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - A glycerol+fatty acid fragment can be found among the 3 highest?</span>
<span class="sd">      - The PG headgroup neutral loss (189.0402) is among the fragments?</span>
<span class="sd">        - If so, does it have a lower intensity than half of the fatty</span>
<span class="sd">        acid+glycerol fragment?</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_among_most_abundant</span><span class="p">(</span><span class="s1">&#39;+G(&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">fattya</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations</span><span class="p">(</span><span class="s1">&#39;BMP&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">fattya</span><span class="p">:</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">4</span>
            
            <span class="n">hg_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nl_intensity</span><span class="p">(</span><span class="mf">189.0402</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">hg_int</span><span class="p">:</span>
                
                <span class="n">gfa_highest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_most_abundant_fa</span><span class="p">(</span><span class="s1">&#39;+G(&#39;</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">gfa_highest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">hg_int</span> <span class="o">*</span> <span class="mi">2</span><span class="p">:</span>
                    
                    <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.pg_pos_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.pg_pos_1">[docs]</a>    <span class="k">def</span> <span class="nf">pg_pos_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a positive mode MS2 spectrum</span>
<span class="sd">        is a Phosphatidylglycerol.</span>
<span class="sd">        At in vivo observed only in standard.</span>
<span class="sd">        </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - The PG headgroup neutral loss (189.0402) is the fragment ion</span>
<span class="sd">        with the highest intensity?</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nl_among_most_abundant</span><span class="p">(</span><span class="mf">189.0402</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="n">fattya</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations</span><span class="p">(</span><span class="s1">&#39;PG&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">fattya</span><span class="p">:</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">4</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.va_pos_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.va_pos_1">[docs]</a>    <span class="k">def</span> <span class="nf">va_pos_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a positive MS2 spectrum is vitamin A (retinol).</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - RBP1 + 269.2245</span>
<span class="sd">      - RBP4 + 269.2245</span>
<span class="sd">        </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - The most abundant ion is the whole molecule m/z = 269.224.</span>
<span class="sd">      - Presence off 3 other ions adds to the score but not</span>
<span class="sd">          mandatory: 213.165, 145.1027, 157.1028.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_among_most_abundant</span><span class="p">(</span><span class="mf">269.224</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">,</span> <span class="p">[</span><span class="mf">213.165</span><span class="p">,</span> <span class="mf">145.1027</span><span class="p">,</span> <span class="mf">157.1028</span><span class="p">]))</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.bmp_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.bmp_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">bmp_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is Phosphatidylglycerol.</span>
<span class="sd">        The result will be the same as `bmp_neg_1`, as in negative</span>
<span class="sd">        mode we do not know a way to distinguish these species.</span>
<span class="sd">        </span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - GM2A - 799.54</span>
<span class="sd">      - BPIFB2 - 773.5258 (might be BMP)</span>
<span class="sd">        </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - The most abundant fragment is a fatty acid [M-H]- ion.</span>
<span class="sd">      - The 152.9958 glycerophosphate fragment must be present.</span>
<span class="sd">        - If Lyso-PG fragment present with carbon count complementing</span>
<span class="sd">        the [M-H]- fatty acid score is higher.</span>
<span class="sd">        - Presence of 171.0064 headgroup fragment adds to the score.</span>
<span class="sd">      </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pg_neg_1</span><span class="p">()</span></div>
    
    <span class="c1">#### End: new methods</span>
    
<div class="viewcode-block" id="MS2Scan.pe_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.pe_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">pe_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is Phosphatidylethanolamine.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - GM2A - 714.507</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - The most abundant fragment is a fatty acid [M-H]- ion.</span>
<span class="sd">      - 140.0118 PE headgroup must be present.</span>
<span class="sd">        - Other headgroup ions 196.0380 and 178.0275 add to the score.</span>
<span class="sd">      - Lyso-PE and [M-H-CO2]- fatty acid fragments complementing the</span>
<span class="sd">          highest [M-H]- fatty acid increase the score.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_fa</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fa_type_is</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;-H]-&#39;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">140.0118206</span><span class="p">)</span> <span class="ow">and</span>
            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lysope_neg_1</span><span class="p">()[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span>
        <span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            <span class="n">fattya</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations</span><span class="p">(</span><span class="s1">&#39;PE&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">196.0380330</span><span class="p">):</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">178.0274684</span><span class="p">):</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="n">fa_h_ccs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matching_fa_frags_of_type</span><span class="p">(</span><span class="s1">&#39;PE&#39;</span><span class="p">,</span> <span class="s1">&#39;-H]-&#39;</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">fa_h_cc</span> <span class="ow">in</span> <span class="n">fa_h_ccs</span><span class="p">:</span>
                
                <span class="k">for</span> <span class="n">fa_other</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s1">&#39;[Lyso-PE(C</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">)-]-&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;[Lyso-PE-alkyl(C</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">)-H2O]-&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;[Lyso-PE-alkyl(C</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">)-]-&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;[FA(C</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">)-H-CO2]-&#39;</span>
                <span class="p">]:</span>
                    
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frag_name_present</span><span class="p">(</span><span class="n">fa_other</span> <span class="o">%</span> <span class="n">fa_h_cc</span><span class="p">):</span>
                        <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.lysope_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.lysope_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">lysope_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is</span>
<span class="sd">        Lysophosphatidylethanolamine.</span>

<span class="sd">        **Specimen:** </span>
<span class="sd">        </span>
<span class="sd">        - in vitro FABP1 - 464.27</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - The most abundant fragment is a fatty acid [M-H]- ion.</span>
<span class="sd">      - 140.0118 PE headgroup must be present.</span>
<span class="sd">        - The carbon count and unsaturation of the highest fatty acid</span>
<span class="sd">        fragment must be the same as it is expected for the whole PE molecule.</span>
<span class="sd">        - Other headgroup ions 196.0380 and 178.0275 add to the score.</span>
<span class="sd">      </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_fa</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fa_type_is</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;-H]-&#39;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">140.0118206</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">196.0380330</span><span class="p">):</span>
                <span class="n">score</span> <span class="o">+=</span><span class="mi">1</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">178.0274684</span><span class="p">):</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="n">ccs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms1_cc</span><span class="p">([</span><span class="s1">&#39;PE&#39;</span><span class="p">,</span> <span class="s1">&#39;LysoPE&#39;</span><span class="p">])</span>
            
            <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">ccs</span><span class="p">:</span>
                
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cc2int</span><span class="p">(</span><span class="n">cc</span><span class="p">):</span>
                    
                    <span class="n">score</span> <span class="o">+=</span> <span class="mi">3</span>
                    <span class="n">fattya</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fattya</span><span class="p">:</span>
                <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.pc_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.pc_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">pc_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is a Phosphatidylcholine.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - BPI - 804.57</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - 168.0431 phosphate+choline-CH3 fragment must be present.</span>
<span class="sd">      - The highest abundant fragment must be a fatty acid [M-H]- fragment.</span>
<span class="sd">        - Lyso-PC fragments complementing the highest [M-H]- fatty acid</span>
<span class="sd">        increase the score.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_fa</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_type_is</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;-H]-&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">168.0431206</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            <span class="n">fattya</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations</span><span class="p">(</span><span class="s1">&#39;PC&#39;</span><span class="p">)</span>
            <span class="n">fa_h_ccs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matching_fa_frags_of_type</span><span class="p">(</span><span class="s1">&#39;PC&#39;</span><span class="p">,</span> <span class="s1">&#39;-H]-&#39;</span><span class="p">)</span>
        
            <span class="k">for</span> <span class="n">fa_h_cc</span> <span class="ow">in</span> <span class="n">fa_h_ccs</span><span class="p">:</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frag_name_present</span><span class="p">(</span><span class="s1">&#39;[Lyso-PC(c</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">)-]-&#39;</span> <span class="o">%</span> <span class="n">fa_h_cc</span><span class="p">):</span>
                    <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.pi_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.pi_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">pi_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative MS2 spectrum is Phosphatidylinositol.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - GM2A - 835.52</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - Inositolphosphate-H2O fragment 241.0119, metaphosphate 78.9591 and</span>
<span class="sd">        headgroup fragment 152.9958 must be present.</span>
<span class="sd">        - Additional headgroup fragments 96.9696, 259.0224 and 297.0381</span>
<span class="sd">        increase the score.</span>
<span class="sd">        - Presence of Lyso-PI fragments complementing other [M-H]- fatty</span>
<span class="sd">        acid fragments increase the score.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">241.0118779</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">152.9958366</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">78.95905658</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            <span class="n">fattya</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations</span><span class="p">(</span><span class="s1">&#39;PI&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">hgfrag_mz</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">96.96962158</span><span class="p">,</span> <span class="mf">259.0224425</span><span class="p">,</span> <span class="mf">297.0380926</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="n">hgfrag_mz</span><span class="p">):</span>
                    <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">fa_h_ccs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matching_fa_frags_of_type</span><span class="p">(</span><span class="s1">&#39;PI&#39;</span><span class="p">,</span> <span class="s1">&#39;-H]-&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">fa_h_cc</span> <span class="ow">in</span> <span class="n">fa_h_ccs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">fa_other</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s1">&#39;[Lyso-PI(C</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">)-]-&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;[Lyso-PI(C</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">)-H2O]-]&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frag_name_present</span><span class="p">(</span><span class="n">fa_other</span> <span class="o">%</span> <span class="n">fa_h_cc</span><span class="p">):</span>
                        <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.ps_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.ps_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">ps_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is a Phosphatidylserine.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - ORP9 - 788.54</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - The most abundant fragment is an [M-H]- fatty acid fragment.</span>
<span class="sd">      - Glycerophosphate fragment 152.9958 must be present.</span>
<span class="sd">        - Metaphosphate 78.9591 increases the score.</span>
<span class="sd">      - Serine-H2O neutral loss 87.0320 adds to the score.</span>
<span class="sd">        - Presence of Lyso-PS and Lyso-PA fragments complementing</span>
<span class="sd">        the highest [M-H]- fatty acid fragment increase the score.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_fa</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_type_is</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;-H]-&#39;</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">mz_among_most_abundant</span><span class="p">(</span><span class="mf">152.9958366</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            <span class="n">fattya</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations</span><span class="p">(</span><span class="s1">&#39;PS&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fattya</span><span class="p">:</span>
                <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">87.03202840</span><span class="p">):</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">78.95905658</span><span class="p">):</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="n">fa_h_ccs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matching_fa_frags_of_type</span><span class="p">(</span><span class="s1">&#39;PS&#39;</span><span class="p">,</span> <span class="s1">&#39;-H]-&#39;</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">fa_h_cc</span> <span class="ow">in</span> <span class="n">fa_h_ccs</span><span class="p">:</span>
                
                <span class="k">for</span> <span class="n">fa_other</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s1">&#39;[Lyso-PS(C</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">)-]-&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;[Lyso-PA(C</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">)-]-&#39;</span><span class="p">]:</span>
                    
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frag_name_present</span><span class="p">(</span><span class="n">fa_other</span> <span class="o">%</span> <span class="n">fa_h_cc</span><span class="p">):</span>
                        <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.pg_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.pg_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">pg_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is Phosphatidylglycerol.</span>
<span class="sd">        The result will be the same as `bmp_neg_1`, as in negative</span>
<span class="sd">        mode we do not know a way to distinguish these species.</span>
<span class="sd">        </span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - GM2A - 799.54</span>
<span class="sd">      - BPIFB2 - 773.5258 (might be BMP)</span>
<span class="sd">        </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - The most abundant fragment is a fatty acid [M-H]- ion.</span>
<span class="sd">      - The 152.9958 glycerophosphate fragment must be present.</span>
<span class="sd">        - If Lyso-PG fragment present with carbon count complementing</span>
<span class="sd">        the [M-H]- fatty acid score is higher.</span>
<span class="sd">        - Presence of 171.0064 headgroup fragment adds to the score.</span>
<span class="sd">      </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_fa</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_type_is</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;-H]-&#39;</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">152.9958366</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="c1">#if self.mz_among_most_abundant(152.9958366, 5):</span>
            <span class="c1">#   score -= 3</span>
            
            <span class="n">fattya</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations</span><span class="p">(</span><span class="s1">&#39;PG&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">171.0064016</span><span class="p">):</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="n">fa_h_ccs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matching_fa_frags_of_type</span><span class="p">(</span><span class="s1">&#39;PG&#39;</span><span class="p">,</span> <span class="s1">&#39;-H]-&#39;</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">fa_h_cc</span> <span class="ow">in</span> <span class="n">fa_h_ccs</span><span class="p">:</span>
                
                <span class="k">for</span> <span class="n">fa_other</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s1">&#39;Lyso-PG(C</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">)-]-&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Lyso-PG(C</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">)-H2O]-&#39;</span><span class="p">]:</span>
                    
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frag_name_present</span><span class="p">(</span><span class="n">fa_other</span> <span class="o">%</span> <span class="n">fa_h_cc</span><span class="p">):</span>
                        <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.sm_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.sm_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">sm_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is a Sphingomyeline.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - GLTPD1 - 745.55</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - Must have a neutral loss of CH3+COOH (60.0211).</span>
<span class="sd">      - Phosphate+choline-CH3 fragment 168.0431 must be present.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_among_most_abundant</span><span class="p">(</span><span class="mf">168.0431206</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_nl</span><span class="p">(</span><span class="mf">60.02113</span><span class="p">):</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.sph1p_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.sph1p_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">sph1p_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is a Spingosine-1-phosphate.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - Only observed in standard.</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - Phosphate 78.9590 must be present.</span>
<span class="sd">      </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">78.95905658</span><span class="p">):</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.cer_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.cer_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">cer_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is Ceramide.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - SEC14L1 - 582.509</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - A Ceramide backbone fragment must be among the 2 most abundant.</span>
<span class="sd">      - Ceramide backbone fragments lighter by N or C2N but same carbon</span>
<span class="sd">          count and unsaturation add to the score.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_among_most_abundant</span><span class="p">(</span><span class="s1">&#39;CerFA&#39;</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            <span class="n">fattya</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations</span><span class="p">(</span><span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">fa_h_ccs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matching_fa_frags_of_type</span><span class="p">(</span><span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="s1">&#39;CerFA(&#39;</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">fa_h_cc</span> <span class="ow">in</span> <span class="n">fa_h_ccs</span><span class="p">:</span>
                
                <span class="k">for</span> <span class="n">fa_other</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s1">&#39;[CerFA-N(C</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">)-]-&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;[CerFA-C2N(C</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">)-]-&#39;</span><span class="p">]:</span>
                    
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frag_name_present</span><span class="p">(</span><span class="n">fa_other</span> <span class="o">%</span> <span class="n">fa_h_cc</span><span class="p">):</span>
                        
                        <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.cerp_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.cerp_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">cerp_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is a Ceramide-1-phosphate.</span>
<span class="sd">        Gives similar result as Sphingosine-1-phosphate.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - GLTPD1 - 616.47</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - The most abundant fragment must be 78.9591 metaphosphate.</span>
<span class="sd">      - Presence of 96.9696 phosphate increase the score.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">most_abundant_mz_is</span><span class="p">(</span><span class="mf">78.95905658</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">96.96962158</span><span class="p">):</span>
                
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.pc_pos_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.pc_pos_1">[docs]</a>    <span class="k">def</span> <span class="nf">pc_pos_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a positive mode MS2 spectrum is a Phosphatidylcholine.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - BPI + 786.607</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - The most abundant fragment must be choline+phosphate 184.0733.</span>
<span class="sd">      - The 86.0964 ethyl-triethylammonium must be present.</span>
<span class="sd">        - The most abundant fatty acid can not have the same carbon count</span>
<span class="sd">        and unsaturation as the whole molecule (then it is Lyso-PC).</span>
<span class="sd">        - Fragments 104.1069, 124.9998, 60.0808 and 58.0651 increase the</span>
<span class="sd">        score.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">most_abundant_mz_is</span><span class="p">(</span><span class="mf">184.073323</span><span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">86.096425</span><span class="p">)</span> <span class="ow">and</span>
            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lysopc_pos_1</span><span class="p">()[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span>
        <span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            <span class="n">fattya</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations</span><span class="p">(</span><span class="s1">&#39;PC&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">104.106990</span><span class="p">):</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">124.999822</span><span class="p">):</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">60.080776</span><span class="p">):</span>
                <span class="n">score</span> <span class="o">+=</span><span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">58.065126</span><span class="p">):</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.lysopc_pos_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.lysopc_pos_1">[docs]</a>    <span class="k">def</span> <span class="nf">lysopc_pos_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a positive mode MS2 spectrum is a Lysophosphatidylcholine.</span>
<span class="sd">        </span>
<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - in vitro FABP1 + 522.36</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - Choline-phosphate 184.0733, ethyl-triethylammonium 86.0964 and</span>
<span class="sd">        neutral loss 183.0660 must be present.</span>
<span class="sd">        - The latter neutral loss corresponds to a fatty acid+glycerol ion.</span>
<span class="sd">      - The carbon count and unsaturation of this fragment should match</span>
<span class="sd">          that of the whole molecule.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">most_abundant_mz_is</span><span class="p">(</span><span class="mf">184.073323</span><span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">86.096425</span><span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_nl</span><span class="p">(</span><span class="mf">183.066045</span><span class="p">)</span>
        <span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="n">fa_mz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nl_lookup</span><span class="p">(</span><span class="mf">183.066045</span><span class="p">),</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="n">ccs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms1_cc</span><span class="p">([</span><span class="s1">&#39;PC&#39;</span><span class="p">,</span> <span class="s1">&#39;LysoPC&#39;</span><span class="p">])</span>
            
            <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">ccs</span><span class="p">:</span>
                
                <span class="k">for</span> <span class="n">fa_frag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span><span class="p">:</span>
                    
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">fa_frag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cc2int</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span> <span class="ow">and</span>
                        <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">fa_frag</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">fa_mz</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0001</span> <span class="ow">and</span>
                        <span class="s1">&#39;FA+G(&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">[</span><span class="n">fa_frag</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="mi">7</span><span class="p">]</span> <span class="ow">and</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cc2int</span><span class="p">(</span><span class="n">cc</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">21</span>
                    <span class="p">):</span>
                        
                        <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
                        <span class="n">fattya</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fattya</span><span class="p">:</span>
                <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.sm_pos_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.sm_pos_1">[docs]</a>    <span class="k">def</span> <span class="nf">sm_pos_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a positive mode MS2 spectrum is a Sphingomyeline.</span>
<span class="sd">        </span>
<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - GLTPD1 + 703.57</span>
<span class="sd">      - GLTPD1 + 813.68 (in vitro)</span>
<span class="sd">        </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - The following choline fragments must be present: 60.0808, 86.0964,</span>
<span class="sd">        104.1069, 124.9998 and 184.0733. The last one is the most intensive.</span>
<span class="sd">        - If 58.0651 can be found it adds to the score.</span>
<span class="sd">      </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">mz</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="n">mz</span><span class="p">),</span>
                <span class="p">[</span>
                    <span class="mf">60.080776</span><span class="p">,</span>
                    <span class="mf">86.096425</span><span class="p">,</span>  <span class="c1">#</span>
                    <span class="mf">104.106990</span><span class="p">,</span> <span class="c1">#</span>
                    <span class="mf">124.999822</span><span class="p">,</span> <span class="c1">#</span>
                    <span class="mf">184.073323</span>  <span class="c1">#</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">58.0651</span><span class="p">):</span>
                
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.fa_pos_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.fa_pos_1">[docs]</a>    <span class="k">def</span> <span class="nf">fa_pos_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a positive mode MS2 spectrum is a fatty acid.</span>
<span class="sd">        Here we only check if the most abundant fragment is the</span>
<span class="sd">        fatty acid itself.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - in vitro FABP1 +</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - The most abundant fragment must be a fatty acid which matches</span>
<span class="sd">        the carbon count and the unsaturation of the whole molecule.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">build_fa_list</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_fa</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
            
            <span class="k">if</span> <span class="s1">&#39;FA&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">:</span>
                
                <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">[</span><span class="s1">&#39;FA&#39;</span><span class="p">]:</span>
                    
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cc2int</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                        
                        <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
                        <span class="n">fattya</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.fa_neg_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.fa_neg_1">[docs]</a>    <span class="k">def</span> <span class="nf">fa_neg_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a negative mode MS2 spectrum is a fatty acid.</span>
<span class="sd">        Here we only check if the most abundant fragment is the</span>
<span class="sd">        fatty acid itself.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - in vitro FABP1 -</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - The most abundant fragment must be a fatty acid which matches</span>
<span class="sd">        the carbon count and the unsaturation of the whole molecule.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># these are the same</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_pos_1</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="MS2Scan.cerp_pos_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.cerp_pos_1">[docs]</a>    <span class="k">def</span> <span class="nf">cerp_pos_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a positive mode MS2 spectrum is a Ceramide-1-phosphate.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - GLTPD1 + 728.59, 590.45, 702.58, 618.430, 616.415, 640.409</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - A sphingosine fragment with double H2O loss must be among the three</span>
<span class="sd">        highest abundant fragments.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_among_most_abundant</span><span class="p">(</span><span class="s1">&#39;-H2O-H2O+]+&#39;</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.pe_pos_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.pe_pos_1">[docs]</a>    <span class="k">def</span> <span class="nf">pe_pos_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a positive mode MS2 spectrum is a</span>
<span class="sd">        Phosphatidylethanolamine.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - BPI + 718.536</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - The PE headgroup neutral loss 141.0191 has the highest intensity.</span>
<span class="sd">      - If it is a Lyso-PE score will be zero.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nl_among_most_abundant</span><span class="p">(</span><span class="mf">141.019097</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            <span class="n">fattya</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations</span><span class="p">(</span><span class="s1">&#39;PE&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fattya</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lysope_pos_1</span><span class="p">()[</span><span class="s1">&#39;score&#39;</span><span class="p">]:</span>
                <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.lysope_pos_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.lysope_pos_1">[docs]</a>    <span class="k">def</span> <span class="nf">lysope_pos_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a positive mode MS2 spectrum is a</span>
<span class="sd">        Lysophosphatidylethanolamine.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - in vitro FABP1 + 454.29</span>
<span class="sd">      </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - The PE headgroup neutral loss 141.0191 has the highest intensity.</span>
<span class="sd">      - A fatty acid-glycerol fragment should match the carbon count and</span>
<span class="sd">          unsaturation of the whole molecule.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span>  <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nl_among_most_abundant</span><span class="p">(</span><span class="mf">141.019097</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">6</span>
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span><span class="p">):</span>
            
                <span class="n">frag1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            
                <span class="n">ccs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms1_cc</span><span class="p">([</span><span class="s1">&#39;PE&#39;</span><span class="p">,</span> <span class="s1">&#39;LysoPE&#39;</span><span class="p">])</span>
                
                <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">ccs</span><span class="p">:</span>
                    
                    <span class="k">if</span> <span class="p">(</span><span class="n">frag1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cc2int</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span> <span class="ow">and</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fa_type_is</span><span class="p">(</span><span class="n">frag1</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;FA+G(&#39;</span><span class="p">)):</span>
                        
                        <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">fattya</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
                        
                    
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">score</span> <span class="o">-=</span> <span class="mi">1</span>
            
            <span class="k">else</span><span class="p">:</span>
                <span class="n">score</span> <span class="o">-=</span> <span class="mi">1</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.cer_pos_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.cer_pos_1">[docs]</a>    <span class="k">def</span> <span class="nf">cer_pos_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a positive mode MS2 spectrum is a Ceramide.</span>

<span class="sd">        **Specimen:**</span>
<span class="sd">        </span>
<span class="sd">        - SEC14L1 + 538.52</span>
<span class="sd">      - STARD11 + 538.526</span>
<span class="sd">        </span>
<span class="sd">        **Principle:**</span>
<span class="sd">        </span>
<span class="sd">        - A sphingosine backbone with two H2O loss must be among the</span>
<span class="sd">        10 most abundant fragments.</span>
<span class="sd">        - Fatty acid [M+H]+ or [M-O]+ fragments or neutral losses</span>
<span class="sd">        complementing the one above increase the score.</span>
<span class="sd">        - Sphingosine backbone fragments with same carbon count and</span>
<span class="sd">        unsaturation with the one with 2 water loss but [Sph-C-2(H2O)]+</span>
<span class="sd">          or [Sph-H2O]+ add to the score.</span>
<span class="sd">        - The score increases if the following choline fragments</span>
<span class="sd">        can not be found: 58.0651, 104.1070, 124.9998 and 184.0733.</span>
<span class="sd">        - The presence of the following fragments increase the score:</span>
<span class="sd">        60.0444, 70.0651, 82.0651, 96.0808, 107.0730, 121.0886,</span>
<span class="sd">          135.1042 and 149.1199.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">if</span> <span class="s1">&#39;Cer&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">:</span>
            <span class="n">ms1uns</span> <span class="o">=</span> <span class="kc">None</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># larger unsaturation than the whole molecule</span>
            <span class="c1"># does not make sense</span>
            <span class="n">ms1uns</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">_cc</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cc2int</span><span class="p">(</span><span class="n">_cc</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">[</span><span class="s1">&#39;Cer&#39;</span><span class="p">]))</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_among_most_abundant</span><span class="p">(</span><span class="s1">&#39;-H2O-H2O+]+&#39;</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                                       <span class="n">sphingo</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">uns</span> <span class="o">=</span> <span class="n">ms1uns</span><span class="p">):</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="mi">5</span>
            <span class="n">fattya</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_combinations</span><span class="p">(</span><span class="s1">&#39;Cer&#39;</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            
            <span class="n">sph_ccs</span><span class="p">,</span> <span class="n">fa_frags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matching_fa_frags_of_type</span><span class="p">(</span><span class="s1">&#39;Cer&#39;</span><span class="p">,</span>
                <span class="s1">&#39;-H2O-H2O+]+&#39;</span><span class="p">,</span> <span class="n">sphingo</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">return_details</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">cc</span><span class="p">,</span> <span class="n">fa_frag_names</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">fa_frags</span><span class="p">):</span>
                
                <span class="k">for</span> <span class="n">fa_frag_name</span> <span class="ow">in</span> <span class="n">fa_frag_names</span><span class="p">:</span>
                    
                    <span class="k">if</span> <span class="s1">&#39;+H]+&#39;</span> <span class="ow">in</span> <span class="n">fa_frag_name</span><span class="p">:</span>
                        <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="s1">&#39;-O]+&#39;</span> <span class="ow">in</span> <span class="n">fa_frag_name</span><span class="p">:</span>
                        <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="s1">&#39;NL&#39;</span> <span class="ow">in</span> <span class="n">fa_frag_name</span><span class="p">:</span>
                        <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="k">for</span> <span class="n">sph_cc</span> <span class="ow">in</span> <span class="n">sph_ccs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">fa_other</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s1">&#39;[Sphingosine(C</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">)-C-H2O-H2O+]+&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;[Sphingosine(C</span><span class="si">%u</span><span class="s1">:</span><span class="si">%u</span><span class="s1">)-H2O+]+&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frag_name_present</span><span class="p">(</span><span class="n">fa_other</span> <span class="o">%</span> <span class="n">sph_cc</span><span class="p">):</span>
                        
                        <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span>
                    <span class="nb">filter</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">mz</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="n">mz</span><span class="p">),</span>
                        <span class="p">[</span><span class="mf">58.065126</span><span class="p">,</span> <span class="mf">104.106990</span><span class="p">,</span> <span class="mf">124.999822</span><span class="p">,</span> <span class="mf">184.073323</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">):</span>
                
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="n">score</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span>
                    <span class="nb">filter</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">mz</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="n">mz</span><span class="p">),</span>
                        <span class="p">[</span><span class="mf">60.0443902</span><span class="p">,</span> <span class="mf">70.0651257</span><span class="p">,</span> <span class="mf">82.0651257</span><span class="p">,</span> <span class="mf">96.0807757</span><span class="p">,</span>
                        <span class="mf">107.072951</span><span class="p">,</span> <span class="mf">121.088601</span><span class="p">,</span> <span class="mf">135.104251</span><span class="p">,</span> <span class="mf">149.119901</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.vd_pos_1"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.vd_pos_1">[docs]</a>    <span class="k">def</span> <span class="nf">vd_pos_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examines if a positive mode MS2 spectrum is a vitamin D.</span>
<span class="sd">        This method is not implemented, does nothing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fattya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span> <span class="s1">&#39;fattya&#39;</span><span class="p">:</span> <span class="n">fattya</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="MS2Scan.ms1_cc"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.ms1_cc">[docs]</a>    <span class="k">def</span> <span class="nf">ms1_cc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hgs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For a list of headgroups returns the possible carbon counts</span>
<span class="sd">        based on database lookups of MS1 m/z&#39;s.</span>
<span class="sd">        Returns set of strings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">ccs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        
        <span class="k">for</span> <span class="n">hg</span> <span class="ow">in</span> <span class="n">hgs</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">hg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">:</span>
                <span class="n">ccs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">[</span><span class="n">hg</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="n">hg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">:</span>
                <span class="n">ccs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">ms1fa</span><span class="p">[</span><span class="n">hg</span><span class="p">])</span>
        
        <span class="k">return</span> <span class="n">ccs</span></div>
    
<div class="viewcode-block" id="MS2Scan.is_pe"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.is_pe">[docs]</a>    <span class="k">def</span> <span class="nf">is_pe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;pos&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa_pe_ps_pg_pos</span><span class="p">(</span><span class="s1">&#39;PE&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pe_pc_pg_neg</span><span class="p">(</span><span class="s1">&#39;PE&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2Scan.is_pc"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.is_pc">[docs]</a>    <span class="k">def</span> <span class="nf">is_pc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;pos&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pc_pos</span><span class="p">(</span><span class="s1">&#39;PC&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pe_pc_pg_neg</span><span class="p">(</span><span class="s1">&#39;PC&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2Scan.is_pa"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.is_pa">[docs]</a>    <span class="k">def</span> <span class="nf">is_pa</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;pos&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa_pe_ps_pg_pos</span><span class="p">(</span><span class="s1">&#39;PA&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa_ps_neg</span><span class="p">(</span><span class="s1">&#39;PA&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2Scan.is_ps"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.is_ps">[docs]</a>    <span class="k">def</span> <span class="nf">is_ps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;pos&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa_pe_ps_pg_pos</span><span class="p">(</span><span class="s1">&#39;PS&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa_ps_neg</span><span class="p">(</span><span class="s1">&#39;PS&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2Scan.is_pg"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.is_pg">[docs]</a>    <span class="k">def</span> <span class="nf">is_pg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;pos&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pa_pe_ps_pg_pos</span><span class="p">(</span><span class="s1">&#39;PG&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pe_pc_pg_neg</span><span class="p">(</span><span class="s1">&#39;PG&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2Scan.pa_pe_ps_pg_pos"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.pa_pe_ps_pg_pos">[docs]</a>    <span class="k">def</span> <span class="nf">pa_pe_ps_pg_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hg</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_among_most_abundant</span><span class="p">(</span><span class="mf">141.0191</span><span class="p">)</span> \
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_among_most_abundant</span><span class="p">(</span><span class="s1">&#39;-O]+&#39;</span><span class="p">,</span> <span class="n">min_mass</span> <span class="o">=</span> <span class="mf">140.0</span><span class="p">)</span> \
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_ccs_agree_ms1</span><span class="p">(</span><span class="n">hg</span><span class="p">,</span> <span class="s1">&#39;-O]+&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2Scan.pa_ps_neg"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.pa_ps_neg">[docs]</a>    <span class="k">def</span> <span class="nf">pa_ps_neg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hg</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">152.9958366</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mz</span><span class="p">(</span><span class="mf">78.95905658</span><span class="p">)</span> \
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">most_abundant_fa</span><span class="p">(</span><span class="s1">&#39;-H]-&#39;</span><span class="p">)</span> \
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_ccs_agree_ms1</span><span class="p">(</span><span class="n">hg</span><span class="p">,</span> <span class="s1">&#39;-H]-&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2Scan.pe_pc_pg_neg"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.pe_pc_pg_neg">[docs]</a>    <span class="k">def</span> <span class="nf">pe_pc_pg_neg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hg</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">most_abundant_fa</span><span class="p">(</span><span class="s1">&#39;-H]-&#39;</span><span class="p">)</span> \
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_ccs_agree_ms1</span><span class="p">(</span><span class="n">hg</span><span class="p">,</span> <span class="s1">&#39;-H]-&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="MS2Scan.pc_pos"><a class="viewcode-back" href="../../source/lipyd.html#lipyd.ms2.MS2Scan.pc_pos">[docs]</a>    <span class="k">def</span> <span class="nf">pc_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hg</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz_most_abundant_fold</span><span class="p">(</span><span class="mf">184.0733</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> \
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa_ccs_agree_ms1</span><span class="p">(</span><span class="n">hg</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2018, Dénes Türei.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.7.19',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>